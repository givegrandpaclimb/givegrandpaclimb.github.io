import{p as t}from"./vendor-lezer-xml-DZqW7bKw.js";import{L as e,s as r,c as o,d as l,f as n,l as a}from"./vendor-codemirror-language-C3hkV707.js";import{E as i}from"./vendor-codemirror-state-D88w-V9V.js";import{E as s}from"./vendor-codemirror-view-DVzN21hM.js";import"./vendor-lezer-lr-CZr-wB1l.js";import"./vendor-lezer-common-QPiu6Hcj.js";import"./vendor-lezer-highlight-4-fykoed.js";import"./vendor-style-mod-tLAqh-pC.js";import"./vendor-marijn-find-cluster-break-BFVNO93u.js";import"./vendor-w3c-keyname-BorKtCV5.js";function u(t,e){let r=e&&e.getChild("TagName");return r?t.sliceString(r.from,r.to):""}function f(t,e){let r=e&&e.firstChild;return r&&"OpenTag"==r.name?u(t,r):""}function c(t){for(let e=t&&t.parent;e;e=e.parent)if("Element"==e.name)return e;return null}class m{constructor(t,e,r){this.attrs=e,this.attrValues=r,this.children=[],this.name=t.name,this.completion=Object.assign(Object.assign({type:"type"},t.completion||{}),{label:this.name}),this.openCompletion=Object.assign(Object.assign({},this.completion),{label:"<"+this.name}),this.closeCompletion=Object.assign(Object.assign({},this.completion),{label:"</"+this.name+">",boost:2}),this.closeNameCompletion=Object.assign(Object.assign({},this.completion),{label:this.name+">"}),this.text=t.textContent?t.textContent.map(t=>({label:t,type:"text"})):[]}}const p=/^[:\-\.\w\u00b7-\uffff]*$/;function g(t){return Object.assign(Object.assign({type:"property"},t.completion||{}),{label:t.name})}function d(t){return"string"==typeof t?{label:`"${t}"`,type:"constant"}:/^"/.test(t.label)?t:Object.assign(Object.assign({},t),{label:`"${t.label}"`})}function v(t,e){let o=[],l=[],n=Object.create(null);for(let r of e){let t=g(r);o.push(t),r.global&&l.push(t),r.values&&(n[r.name]=r.values.map(d))}let a=[],i=[],s=Object.create(null);for(let r of t){let t=l,e=n;r.attributes&&(t=t.concat(r.attributes.map(t=>"string"==typeof t?o.find(e=>e.label==t)||{label:t,type:"property"}:(t.values&&(e==n&&(e=Object.create(e)),e[t.name]=t.values.map(d)),g(t)))));let u=new m(r,t,e);s[u.name]=u,a.push(u),r.top&&i.push(u)}i.length||(i=a);for(let r=0;r<a.length;r++){let e=t[r],o=a[r];if(e.children)for(let t of e.children)s[t]&&o.children.push(s[t]);else o.children=a}return t=>{var e;let{doc:o}=t.state,m=function(t,e){var o;let l=r(t).resolveInner(e,-1),n=null;for(let r=l;!n&&r.parent;r=r.parent)"OpenTag"!=r.name&&"CloseTag"!=r.name&&"SelfClosingTag"!=r.name&&"MismatchedCloseTag"!=r.name||(n=r);if(n&&(n.to>e||n.lastChild.type.isError)){let t=n.parent;if("TagName"==l.name)return"CloseTag"==n.name||"MismatchedCloseTag"==n.name?{type:"closeTag",from:l.from,context:t}:{type:"openTag",from:l.from,context:c(t)};if("AttributeName"==l.name)return{type:"attrName",from:l.from,context:n};if("AttributeValue"==l.name)return{type:"attrValue",from:l.from,context:n};let r=l==n||"Attribute"==l.name?l.childBefore(e):l;return"StartTag"==(null==r?void 0:r.name)?{type:"openTag",from:e,context:c(t)}:"StartCloseTag"==(null==r?void 0:r.name)&&r.to<=e?{type:"closeTag",from:e,context:t}:"Is"==(null==r?void 0:r.name)?{type:"attrValue",from:e,context:n}:r?{type:"attrName",from:e,context:n}:null}if("StartCloseTag"==l.name)return{type:"closeTag",from:e,context:l.parent};for(;l.parent&&l.to==e&&!(null===(o=l.lastChild)||void 0===o?void 0:o.type.isError);)l=l.parent;return"Element"==l.name||"Text"==l.name||"Document"==l.name?{type:"tag",from:e,context:"Element"==l.name?l:c(l)}:null}(t.state,t.pos);if(!m||"tag"==m.type&&!t.explicit)return null;let{type:g,from:d,context:v}=m;if("openTag"==g){let t=i,e=f(o,v);if(e){let r=s[e];t=(null==r?void 0:r.children)||a}return{from:d,options:t.map(t=>t.completion),validFor:p}}if("closeTag"==g){let r=f(o,v);return r?{from:d,to:t.pos+(">"==o.sliceString(t.pos,t.pos+1)?1:0),options:[(null===(e=s[r])||void 0===e?void 0:e.closeNameCompletion)||{label:r+">",type:"type"}],validFor:p}:null}if("attrName"==g){let t=s[u(o,v)];return{from:d,options:(null==t?void 0:t.attrs)||l,validFor:p}}if("attrValue"==g){let e=function(t,e,r){let o=e&&e.getChildren("Attribute").find(t=>t.from<=r&&t.to>=r),l=o&&o.getChild("AttributeName");return l?t.sliceString(l.from,l.to):""}(o,v,d);if(!e)return null;let r=s[u(o,v)],l=((null==r?void 0:r.attrValues)||n)[e];return l&&l.length?{from:d,to:t.pos+('"'==o.sliceString(t.pos,t.pos+1)?1:0),options:l,validFor:/^"[^"]*"?$/}:null}if("tag"==g){let e=f(o,v),r=s[e],l=[],n=v&&v.lastChild;!e||n&&"CloseTag"==n.name&&u(o,n)==e||l.push(r?r.closeCompletion:{label:"</"+e+">",type:"type",boost:2});let c=l.concat(((null==r?void 0:r.children)||(v?a:i)).map(t=>t.openCompletion));if(v&&(null==r?void 0:r.text.length)){let e=v.firstChild;e.to>t.pos-20&&!/\S/.test(t.state.sliceDoc(e.to,t.pos))&&(c=c.concat(r.text))}return{from:d,options:c,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}return null}}const b=e.define({name:"xml",parser:t.configure({props:[l.add({Element(t){let e=/^\s*<\//.test(t.textAfter);return t.lineIndent(t.node.from)+(e?0:t.unit)},"OpenTag CloseTag SelfClosingTag":t=>t.column(t.node.from)+t.unit}),n.add({Element(t){let e=t.firstChild,r=t.lastChild;return e&&"OpenTag"==e.name?{from:e.to,to:"CloseTag"==r.name?r.from:t.to}:null}}),a.add({"OpenTag CloseTag":t=>t.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/$/}});function T(t={}){let e=[b.data.of({autocomplete:v(t.elements||[],t.attributes||[])})];return!1!==t.autoCloseTags&&e.push(j),new o(b,e)}function y(t,e,r=t.length){if(!e)return"";let o=e.firstChild,l=o&&o.getChild("TagName");return l?t.sliceString(l.from,Math.min(l.to,r)):""}const j=s.inputHandler.of((t,e,o,l,n)=>{if(t.composing||t.state.readOnly||e!=o||">"!=l&&"/"!=l||!b.isActiveAt(t.state,e,-1))return!1;let a=n(),{state:s}=a,u=s.changeByRange(t=>{var e,o,n;let a,{head:u}=t,f=s.doc.sliceString(u-1,u)==l,c=r(s).resolveInner(u,-1);if(f&&">"==l&&"EndTag"==c.name){let r=c.parent;if("CloseTag"!=(null===(o=null===(e=r.parent)||void 0===e?void 0:e.lastChild)||void 0===o?void 0:o.name)&&(a=y(s.doc,r.parent,u)))return{range:t,changes:{from:u,to:u+(">"===s.doc.sliceString(u,u+1)?1:0),insert:`</${a}>`}}}else if(f&&"/"==l&&"StartCloseTag"==c.name){let t=c.parent;if(c.from==u-2&&"CloseTag"!=(null===(n=t.lastChild)||void 0===n?void 0:n.name)&&(a=y(s.doc,t,u))){let t=u+(">"===s.doc.sliceString(u,u+1)?1:0),e=`${a}>`;return{range:i.cursor(u+e.length,-1),changes:{from:u,to:t,insert:e}}}}return{range:t}});return!u.changes.empty&&(t.dispatch([a,s.update(u,{userEvent:"input.complete",scrollIntoView:!0})]),!0)});export{j as autoCloseTags,v as completeFromSchema,T as xml,b as xmlLanguage};
