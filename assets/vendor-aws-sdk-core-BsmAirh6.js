import{H as e,a as t}from"./vendor-smithy-protocol-http-ZjGpQTbx.js";import{n as s,m as r,d as i,i as n,T as a,N as o,F as c,c as g,e as l,f as m,H as d,h,j as u}from"./vendor-smithy-core-BjtElWb2.js";import{S as f}from"./vendor-smithy-signature-v4-nK03PxHf.js";import{d as p,b as S}from"./vendor-smithy-smithy-client-WTndHW9r.js";import{t as w}from"./vendor-smithy-util-utf8-MtSxxKG8.js";import{f as y,t as b}from"./vendor-smithy-util-base64-BxOL2JNu.js";import{v as x}from"./vendor-smithy-uuid-CiJeYpB1.js";function N(e,t,s){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=s}const C=t=>e.isInstance(t)?t.headers?.date??t.headers?.Date:void 0,v=e=>new Date(Date.now()+e),M=(e,t)=>{const s=Date.parse(e);return((e,t)=>Math.abs(v(t).getTime()-e)>=3e5)(s,t)?s-Date.now():t},E=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t},T=async e=>{const t=E("context",e.context),s=E("config",e.config),r=t.endpointV2?.properties?.authSchemes?.[0],i=E("signer",s.signer),n=await i(r),a=e?.signingRegion,o=e?.signingRegionSet,c=e?.signingName;return{config:s,signer:n,signingRegion:a,signingRegionSet:o,signingName:c}};class k{async sign(e,s,r){if(!t.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const i=await T(r),{config:n,signer:a}=i;let{signingRegion:o,signingName:c}=i;const g=r.context;if(g?.authSchemes?.length){const[e,t]=g.authSchemes;"sigv4a"===e?.name&&"sigv4"===t?.name&&(o=t?.signingRegion??o,c=t?.signingName??c)}return await a.sign(e,{signingDate:v(n.systemClockOffset),signingRegion:o,signingService:c})}errorHandler(e){return t=>{const s=t.ServerTime??C(t.$response);if(s){const r=E("config",e.config),i=r.systemClockOffset;r.systemClockOffset=M(s,r.systemClockOffset),r.systemClockOffset!==i&&t.$metadata&&(t.$metadata.clockSkewCorrected=!0)}throw t}}successHandler(e,t){const s=C(e);if(s){const e=E("config",t.config);e.systemClockOffset=M(s,e.systemClockOffset)}}}class O extends k{async sign(e,s,r){if(!t.isInstance(e))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const{config:i,signer:n,signingRegion:a,signingRegionSet:o,signingName:c}=await T(r),g=(await(i.sigv4aSigningRegionSet?.())??o??[a]).join(",");return await n.sign(e,{signingDate:v(i.systemClockOffset),signingRegion:g,signingService:c})}}const A=e=>(e.sigv4aSigningRegionSet=s(e.sigv4aSigningRegionSet),e),D=e=>{let t,a=e.credentials,o=!!e.credentials;Object.defineProperty(e,"credentials",{set(c){c&&c!==a&&c!==t&&(o=!0),a=c;const g=function(e,{credentials:t,credentialDefaultProvider:a}){let o;return o=t?t?.memoized?t:r(t,n,i):a?s(a(Object.assign({},e,{parentClientConfig:e}))):async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},o.memoized=!0,o}(e,{credentials:a,credentialDefaultProvider:e.credentialDefaultProvider}),l=function(e,t){if(t.configBound)return t;const s=async s=>t({...s,callerClientConfig:e});return s.memoized=t.memoized,s.configBound=!0,s}(e,g);o&&!l.attributed?(t=async e=>l(e).then(e=>function(e){return e.$source||(e.$source={}),e.$source.CREDENTIALS_CODE="e",e}(e)),t.memoized=l.memoized,t.configBound=l.configBound,t.attributed=!0):t=l},get:()=>t,enumerable:!0,configurable:!0}),e.credentials=a;const{signingEscapePath:c=!0,systemClockOffset:g=e.systemClockOffset||0,sha256:l}=e;let m;return m=e.signer?s(e.signer):e.regionInfoProvider?()=>s(e.region)().then(async t=>[await e.regionInfoProvider(t,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},t]).then(([t,s])=>{const{signingRegion:r,signingService:i}=t;e.signingRegion=e.signingRegion||r||s,e.signingName=e.signingName||i||e.serviceId;const n={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:l,uriEscapePath:c};return new(e.signerConstructor||f)(n)}):async t=>{const r=(t=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await s(e.region)(),properties:{}},t)).signingRegion,i=t.signingName;e.signingRegion=e.signingRegion||r,e.signingName=e.signingName||i||e.serviceId;const n={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:l,uriEscapePath:c};return new(e.signerConstructor||f)(n)},Object.assign(e,{systemClockOffset:g,signingEscapePath:c,signer:m})};class j{queryCompat;constructor(e=!1){this.queryCompat=e}resolveRestContentType(e,t){const s=t.getMemberSchemas(),r=Object.values(s).find(e=>!!e.getMergedTraits().httpPayload);return r?r.getMergedTraits().mediaType||(r.isStringSchema()?"text/plain":r.isBlobSchema()?"application/octet-stream":e):!t.isUnitSchema()&&Object.values(s).find(e=>{const{httpQuery:t,httpQueryParams:s,httpHeader:r,httpLabel:i,httpPrefixHeaders:n}=e.getMergedTraits();return!(t||s||r||i||void 0!==n)})?e:void 0}async getErrorSchemaOrThrowBaseException(e,t,s,r,i,n){let o=t,c=e;e.includes("#")&&([o,c]=e.split("#"));const g={$metadata:i,$fault:s.statusCode<500?"client":"server"},l=a.for(o);try{return{errorSchema:n?.(l,c)??l.getSchema(e),errorMetadata:g}}catch(m){r.message=r.message??r.Message??"UnknownError";const e=a.for("smithy.ts.sdk.synthetic."+o),t=e.getBaseException();if(t){const s=e.getErrorCtor(t)??Error;throw this.decorateServiceException(Object.assign(new s({name:c}),g),r)}throw this.decorateServiceException(Object.assign(new Error(c),g),r)}}decorateServiceException(e,t={}){if(this.queryCompat){const s=e.Message??t.Message,r=p(e,t);return s&&(r.Message=s,r.message=s),r}return p(e,t)}setQueryCompatError(e,t){const s=t.headers?.["x-amzn-query-error"];if(void 0!==e&&null!=s){const[t,r]=s.split(";"),i=Object.entries(e),n={Code:t,Type:r};Object.assign(e,n);for(const[e,s]of i)n[e]=s;delete n.__type,e.Error=n}}queryCompatOutput(e,t){e.Error&&(t.Error=e.Error),e.Type&&(t.Type=e.Type),e.Code&&(t.Code=e.Code)}}class z{serdeContext;setSerdeContext(e){this.serdeContext=e}}function R(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}class B{value;constructor(e){this.value=e}toString(){return(""+this.value).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#x0D;").replace(/\n/g,"&#x0A;").replace(/\u0085/g,"&#x85;").replace(/\u2028/,"&#x2028;")}}class _{name;children;attributes={};static of(e,t,s){const r=new _(e);return void 0!==t&&r.addChildNode(new B(t)),void 0!==s&&r.withName(s),r}constructor(e,t=[]){this.name=e,this.children=t}withName(e){return this.name=e,this}addAttribute(e,t){return this.attributes[e]=t,this}addChildNode(e){return this.children.push(e),this}removeAttribute(e){return delete this.attributes[e],this}n(e){return this.name=e,this}c(e){return this.children.push(e),this}a(e,t){return null!=t&&(this.attributes[e]=t),this}cc(e,t,s=t){if(null!=e[t]){const r=_.of(t,e[t]).withName(s);this.c(r)}}l(e,t,s,r){null!=e[t]&&r().map(e=>{e.withName(s),this.c(e)})}lc(e,t,s,r){if(null!=e[t]){const e=r(),t=new _(s);e.map(e=>{t.c(e)}),this.c(t)}}toString(){const e=Boolean(this.children.length);let t=`<${this.name}`;const s=this.attributes;for(const r of Object.keys(s)){const e=s[r];null!=e&&(t+=` ${r}="${R(""+e)}"`)}return t+(e?`>${this.children.map(e=>e.toString()).join("")}</${this.name}>`:"/>")}}let $;class P extends z{settings;stringDeserializer;constructor(e){super(),this.settings=e,this.stringDeserializer=new c(e)}setSerdeContext(e){this.serdeContext=e,this.stringDeserializer.setSerdeContext(e)}read(e,t,s){const r=o.of(e),i=r.getMemberSchemas();if(r.isStructSchema()&&r.isMemberSchema()&&Object.values(i).find(e=>!!e.getMemberTraits().eventPayload)){const e={},s=Object.keys(i)[0];return i[s].isBlobSchema()?e[s]=t:e[s]=this.read(i[s],t),e}const n=(this.serdeContext?.utf8Encoder??w)(t),a=this.parseXml(n);return this.readSchema(e,s?a[s]:a)}readSchema(e,t){const s=o.of(e);if(s.isUnitSchema())return;const r=s.getMergedTraits();if(s.isListSchema()&&!Array.isArray(t))return this.readSchema(s,[t]);if(null==t)return t;if("object"==typeof t){const e=!!r.sparse,i=!!r.xmlFlattened;if(s.isListSchema()){const r=s.getValueSchema(),n=[],a=r.getMergedTraits().xmlName??"member",o=i?t:(t[0]??t)[a],c=Array.isArray(o)?o:[o];for(const t of c)(null!=t||e)&&n.push(this.readSchema(r,t));return n}const n={};if(s.isMapSchema()){const r=s.getKeySchema(),a=s.getValueSchema();let o;o=i?Array.isArray(t)?t:[t]:Array.isArray(t.entry)?t.entry:[t.entry];const c=r.getMergedTraits().xmlName??"key",g=a.getMergedTraits().xmlName??"value";for(const t of o){const s=t[c],r=t[g];(null!=r||e)&&(n[s]=this.readSchema(a,r))}return n}if(s.isStructSchema()){for(const[e,r]of s.structIterator()){const s=r.getMergedTraits(),i=s.httpPayload?s.xmlName??r.getName():r.getMemberTraits().xmlName??e;null!=t[i]&&(n[e]=this.readSchema(r,t[i]))}return n}if(s.isDocumentSchema())return t;throw new Error(`@aws-sdk/core/protocols - xml deserializer unhandled schema type for ${s.getName(!0)}`)}return s.isListSchema()?[]:s.isMapSchema()||s.isStructSchema()?{}:this.stringDeserializer.read(s,t)}parseXml(e){if(e.length){let s;try{s=function(e){$||($=new DOMParser);const t=$.parseFromString(e,"application/xml");if(t.getElementsByTagName("parsererror").length>0)throw new Error("DOMParser XML parsing error.");const s=e=>{if(e.nodeType===Node.TEXT_NODE&&e.textContent?.trim())return e.textContent;if(e.nodeType===Node.ELEMENT_NODE){const t=e;if(0===t.attributes.length&&0===t.childNodes.length)return"";const r={},i=Array.from(t.attributes);for(const e of i)r[`${e.name}`]=e.value;const n=Array.from(t.childNodes);for(const e of n){const a=s(e);if(null!=a){const t=e.nodeName;if(1===n.length&&0===i.length&&"#text"===t)return a;r[t]?Array.isArray(r[t])?r[t].push(a):r[t]=[r[t],a]:r[t]=a}else if(1===n.length&&0===i.length)return t.textContent}return r}return null};return{[t.documentElement.nodeName]:s(t.documentElement)}}(e)}catch(t){throw t&&"object"==typeof t&&Object.defineProperty(t,"$responseBodyText",{value:e}),t}const r="#text",i=Object.keys(s)[0],n=s[i];return n[r]&&(n[i]=n[r],delete n[r]),S(n)}return{}}}class I extends z{settings;stringBuffer;byteBuffer;buffer;constructor(e){super(),this.settings=e}write(e,t){const s=o.of(e);if(s.isStringSchema()&&"string"==typeof t)this.stringBuffer=t;else if(s.isBlobSchema())this.byteBuffer="byteLength"in t?t:(this.serdeContext?.base64Decoder??y)(t);else{this.buffer=this.writeStruct(s,t,void 0);const e=s.getMergedTraits();e.httpPayload&&!e.xmlName&&this.buffer.withName(s.getName())}}flush(){if(void 0!==this.byteBuffer){const e=this.byteBuffer;return delete this.byteBuffer,e}if(void 0!==this.stringBuffer){const e=this.stringBuffer;return delete this.stringBuffer,e}const e=this.buffer;return this.settings.xmlNamespace&&(e?.attributes?.xmlns||e.addAttribute("xmlns",this.settings.xmlNamespace)),delete this.buffer,e.toString()}writeStruct(e,t,s){const r=e.getMergedTraits(),i=e.isMemberSchema()&&!r.httpPayload?e.getMemberTraits().xmlName??e.getMemberName():r.xmlName??e.getName();if(!i||!e.isStructSchema())throw new Error(`@aws-sdk/core/protocols - xml serializer, cannot write struct with empty name or non-struct, schema=${e.getName(!0)}.`);const n=_.of(i),[a,c]=this.getXmlnsAttribute(e,s);for(const[g,l]of function*(e,t){if(e.isUnitSchema())return;const s=e.getSchema();for(let r=0;r<s[4].length;++r){const e=s[4][r],i=s[5][r],n=new o([i,0],e);(e in t||n.isIdempotencyToken())&&(yield[e,n])}}(e,t)){const e=t[g];if(null!=e||l.isIdempotencyToken()){if(l.getMergedTraits().xmlAttribute){n.addAttribute(l.getMergedTraits().xmlName??g,this.writeSimple(l,e));continue}if(l.isListSchema())this.writeList(l,e,n,c);else if(l.isMapSchema())this.writeMap(l,e,n,c);else if(l.isStructSchema())n.addChildNode(this.writeStruct(l,e,c));else{const t=_.of(l.getMergedTraits().xmlName??l.getMemberName());this.writeSimpleInto(l,e,t,c),n.addChildNode(t)}}}return c&&n.addAttribute(a,c),n}writeList(e,t,s,r){if(!e.isMemberSchema())throw new Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member list: ${e.getName(!0)}`);const i=e.getMergedTraits(),n=e.getValueSchema(),a=n.getMergedTraits(),o=!!a.sparse,c=!!i.xmlFlattened,[g,l]=this.getXmlnsAttribute(e,r),m=(t,s)=>{if(n.isListSchema())this.writeList(n,Array.isArray(s)?s:[s],t,l);else if(n.isMapSchema())this.writeMap(n,s,t,l);else if(n.isStructSchema()){const r=this.writeStruct(n,s,l);t.addChildNode(r.withName(c?i.xmlName??e.getMemberName():a.xmlName??"member"))}else{const r=_.of(c?i.xmlName??e.getMemberName():a.xmlName??"member");this.writeSimpleInto(n,s,r,l),t.addChildNode(r)}};if(c)for(const d of t)(o||null!=d)&&m(s,d);else{const r=_.of(i.xmlName??e.getMemberName());l&&r.addAttribute(g,l);for(const e of t)(o||null!=e)&&m(r,e);s.addChildNode(r)}}writeMap(e,t,s,r,i=!1){if(!e.isMemberSchema())throw new Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member map: ${e.getName(!0)}`);const n=e.getMergedTraits(),a=e.getKeySchema(),o=a.getMergedTraits().xmlName??"key",c=e.getValueSchema(),g=c.getMergedTraits(),l=g.xmlName??"value",m=!!g.sparse,d=!!n.xmlFlattened,[h,u]=this.getXmlnsAttribute(e,r),f=(e,t,s)=>{const r=_.of(o,t),[i,n]=this.getXmlnsAttribute(a,u);n&&r.addAttribute(i,n),e.addChildNode(r);let g=_.of(l);c.isListSchema()?this.writeList(c,s,g,u):c.isMapSchema()?this.writeMap(c,s,g,u,!0):c.isStructSchema()?g=this.writeStruct(c,s,u):this.writeSimpleInto(c,s,g,u),e.addChildNode(g)};if(d){for(const[p,S]of Object.entries(t))if(m||null!=S){const t=_.of(n.xmlName??e.getMemberName());f(t,p,S),s.addChildNode(t)}}else{let r;i||(r=_.of(n.xmlName??e.getMemberName()),u&&r.addAttribute(h,u),s.addChildNode(r));for(const[e,n]of Object.entries(t))if(m||null!=n){const t=_.of("entry");f(t,e,n),(i?s:r).addChildNode(t)}}}writeSimple(e,t){if(null===t)throw new Error("@aws-sdk/core/protocols - (XML serializer) cannot write null value.");const s=o.of(e);let r=null;if(t&&"object"==typeof t)if(s.isBlobSchema())r=(this.serdeContext?.base64Encoder??b)(t);else{if(!(s.isTimestampSchema()&&t instanceof Date)){if(s.isBigDecimalSchema()&&t)return t instanceof m?t.string:String(t);throw s.isMapSchema()||s.isListSchema()?new Error("@aws-sdk/core/protocols - xml serializer, cannot call _write() on List/Map schema, call writeList or writeMap() instead."):new Error(`@aws-sdk/core/protocols - xml serializer, unhandled schema type for object value and schema: ${s.getName(!0)}`)}switch(g(s,this.settings)){case 5:r=t.toISOString().replace(".000Z","Z");break;case 6:default:r=l(t);break;case 7:r=String(t.getTime()/1e3)}}if((s.isBooleanSchema()||s.isNumericSchema()||s.isBigIntegerSchema()||s.isBigDecimalSchema())&&(r=String(t)),s.isStringSchema()&&(r=void 0===t&&s.isIdempotencyToken()?x():String(t)),null===r)throw new Error(`Unhandled schema-value pair ${s.getName(!0)}=${t}`);return r}writeSimpleInto(e,t,s,r){const i=this.writeSimple(e,t),n=o.of(e),a=new B(i),[c,g]=this.getXmlnsAttribute(n,r);g&&s.addAttribute(c,g),s.addChildNode(a)}getXmlnsAttribute(e,t){const s=e.getMergedTraits(),[r,i]=s.xmlNamespace??[];return i&&i!==t?[r?`xmlns:${r}`:"xmlns",i]:[void 0,void 0]}}class L extends z{settings;constructor(e){super(),this.settings=e}createSerializer(){const e=new I(this.settings);return e.setSerdeContext(this.serdeContext),e}createDeserializer(){const e=new P(this.settings);return e.setSerdeContext(this.serdeContext),e}}class q extends d{codec;serializer;deserializer;mixin=new j;constructor(e){super(e);const t={timestampFormat:{useTrait:!0,default:5},httpBindings:!0,xmlNamespace:e.xmlNamespace,serviceNamespace:e.defaultNamespace};this.codec=new L(t),this.serializer=new h(this.codec.createSerializer(),t),this.deserializer=new u(this.codec.createDeserializer(),t)}getPayloadCodec(){return this.codec}getShapeId(){return"aws.protocols#restXml"}async serializeRequest(e,t,s){const r=await super.serializeRequest(e,t,s),i=o.of(e.input);if(!r.headers["content-type"]){const e=this.mixin.resolveRestContentType(this.getDefaultContentType(),i);e&&(r.headers["content-type"]=e)}return r.headers["content-type"]===this.getDefaultContentType()&&"string"==typeof r.body&&(r.body='<?xml version="1.0" encoding="UTF-8"?>'+r.body),r}async deserializeResponse(e,t,s){return super.deserializeResponse(e,t,s)}async handleError(e,t,s,r,i){const n=((e,t)=>void 0!==t?.Error?.Code?t.Error.Code:void 0!==t?.Code?t.Code:404==e.statusCode?"NotFound":void 0)(s,r)??"Unknown",{errorSchema:c,errorMetadata:g}=await this.mixin.getErrorSchemaOrThrowBaseException(n,this.options.defaultNamespace,s,r,i),l=o.of(c),m=r.Error?.message??r.Error?.Message??r.message??r.Message??"Unknown",d=new(a.for(c[1]).getErrorCtor(c)??Error)(m);await this.deserializeHttpMessage(c,t,s,r);const h={};for(const[a,o]of l.structIterator()){const e=o.getMergedTraits().xmlName??a,t=r.Error?.[e]??r[e];h[a]=this.codec.createDeserializer().readSchema(o,t)}throw this.mixin.decorateServiceException(Object.assign(d,g,{$fault:l.getMergedTraits().error,message:m},h),r)}getDefaultContentType(){return"application/xml"}}export{q as A,A as a,k as b,O as c,D as r,N as s};
