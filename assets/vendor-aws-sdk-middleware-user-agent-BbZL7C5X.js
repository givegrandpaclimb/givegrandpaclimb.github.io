import{n as t}from"./vendor-smithy-core-CFTV9i4d.js";import"./vendor-aws-sdk-util-endpoints-DjZFPGID.js";import{s as e}from"./vendor-aws-sdk-core-DSuZb7Cq.js";import{a as r}from"./vendor-smithy-protocol-http-BM_qqgGS.js";function s(e){const r=t(e.userAgentAppId??void 0),{customUserAgent:s}=e;return Object.assign(e,{customUserAgent:"string"==typeof s?[[s]]:s,userAgentAppId:async()=>{const t=await r();if(!function(t){return void 0===t||"string"==typeof t&&t.length<=50}(t)){const r="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger:console;"string"!=typeof t?r?.warn("userAgentAppId must be a string or undefined."):t.length>50&&r?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return t}})}const n=/\d{12}\.ddb/,o="user-agent",a="x-amz-user-agent",c=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,i=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,d=t=>{const e=t[0].split("/").map(t=>t.replace(c,"-")).join("/"),r=t[1]?.replace(i,"-"),s=e.indexOf("/"),n=e.substring(0,s);let o=e.substring(s+1);return"api"===n&&(o=o.toLowerCase()),[n,o,r].filter(t=>t&&t.length>0).reduce((t,e,r)=>{switch(r){case 0:return e;case 1:return`${t}/${e}`;default:return`${t}#${e}`}},"")},u={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},p=t=>({applyToStack:s=>{var c;s.add((c=t,(t,s)=>async i=>{const{request:u}=i;if(!r.isInstance(u))return t(i);const{headers:p}=u,f=s?.userAgent?.map(d)||[],_=(await c.defaultUserAgentProvider()).map(d);await async function(t,r,s){const o=s.request;if("rpc-v2-cbor"===o?.headers?.["smithy-protocol"]&&e(t,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof r.retryStrategy){const s=await r.retryStrategy();"function"==typeof s.acquireInitialRetryToken?s.constructor?.name?.includes("Adaptive")?e(t,"RETRY_MODE_ADAPTIVE","F"):e(t,"RETRY_MODE_STANDARD","E"):e(t,"RETRY_MODE_LEGACY","D")}if("function"==typeof r.accountIdEndpointMode){const s=t.endpointV2;switch(String(s?.url?.hostname).match(n)&&e(t,"ACCOUNT_ID_ENDPOINT","O"),await(r.accountIdEndpointMode?.())){case"disabled":e(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":e(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":e(t,"ACCOUNT_ID_MODE_REQUIRED","R")}}const a=t.t?.selectedHttpAuthScheme?.identity;if(a?.$source){const r=a;r.accountId&&e(t,"RESOLVED_ACCOUNT_ID","T");for(const[s,n]of Object.entries(r.$source??{}))e(t,s,n)}}(s,c,i);const E=s;_.push(`m/${function(t){let e="";for(const r in t){const s=t[r];if(!(e.length+s.length+1<=1024))break;e.length?e+=","+s:e+=s}return e}(Object.assign({},s.t?.features,E.o?.features))}`);const A=c?.customUserAgent?.map(d)||[],g=await c.userAgentAppId();g&&_.push(d([`app/${g}`]));const O=[].concat([..._,...f,...A]).join(" "),D=[..._.filter(t=>t.startsWith("aws-sdk-")),...A].join(" ");return"browser"!==c.runtime?(D&&(p[a]=p[a]?`${p[o]} ${D}`:D),p[o]=O):p[a]=O,t({...i,request:u})}),u)}});export{p as g,s as r};
