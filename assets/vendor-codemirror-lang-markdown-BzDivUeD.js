import{P as e,E as t,g as r,j as n}from"./vendor-codemirror-state-d-AKQu11.js";import{k as o,E as s}from"./vendor-codemirror-view-C93cYDIg.js";import{p as i,c as l,q as a,o as m,s as f,i as c,f as u,d,r as p,t as g,P as h}from"./vendor-codemirror-language-C0HOxLdp.js";import{C as v}from"./vendor-codemirror-autocomplete-DZ5XmfvM.js";import{M as x,p as k,a as L,G as A,S as w,b as B,E as j}from"./vendor-lezer-markdown-Bwszo2Sf.js";import{html as b,htmlCompletionSource as y}from"./vendor-codemirror-lang-html-DflQ6gel.js";import{N as I}from"./vendor-lezer-common-tIrRRnFP.js";import"./vendor-marijn-find-cluster-break-Dub_CRYN.js";import"./vendor-style-mod-_NPnILvn.js";import"./vendor-w3c-keyname-f-y9tSbI.js";import"./vendor-lezer-highlight-C9TlP_Gx.js";import"./vendor-lezer-html-Cs4PFFZK.js";import"./vendor-lezer-lr-DIIk5jxX.js";import"./vendor-codemirror-lang-css-Cwrg7pmo.js";import"./vendor-lezer-css-EIQBZjst.js";import"./vendor-codemirror-lang-javascript-DaSMFd0y.js";import"./vendor-lezer-javascript-a4UPq40Y.js";const S=m({commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}}}),C=new I,E=L.configure({props:[u.add(e=>!e.is("Block")||e.is("Document")||null!=T(e)||function(e){return"OrderedList"==e.name||"BulletList"==e.name}(e)?void 0:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})),C.add(T),d.add({Document:()=>null}),p.add({Document:S})]});function T(e){let t=/^(?:ATX|Setext)Heading(\d)$/.exec(e.name);return t?+t[1]:void 0}function z(e,t){let r=e;for(;;){let e,n=r.nextSibling;if(!n||null!=(e=T(n.type))&&e<=t)break;r=n}return r.to}const O=i.of((e,t,r)=>{for(let n=f(e).resolveInner(r,-1);n&&!(n.from<t);n=n.parent){let e=n.type.prop(C);if(null==e)continue;let t=z(n,e);if(t>r)return{from:r,to:t}}return null});function P(e){return new a(S,e,[],"markdown")}const $=P(E),D=P(E.configure([A,w,B,j,{props:[u.add({Table:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})})]}]));class q{constructor(e,t,r,n,o,s,i){this.node=e,this.from=t,this.to=r,this.spaceBefore=n,this.spaceAfter=o,this.type=s,this.item=i}blank(e,t=!0){let r=this.spaceBefore+("Blockquote"==this.node.name?">":"");if(null!=e){for(;r.length<e;)r+=" ";return r}for(let n=this.to-this.from-r.length-this.spaceAfter.length;n>0;n--)r+=" ";return r+(t?this.spaceAfter:"")}marker(e,t){let r="OrderedList"==this.node.name?String(+R(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter}}function M(e,t){let r=[],n=[];for(let o=e;o;o=o.parent){if("FencedCode"==o.name)return n;"ListItem"!=o.name&&"Blockquote"!=o.name||r.push(o)}for(let o=r.length-1;o>=0;o--){let e,s=r[o],i=t.lineAt(s.from),l=s.from-i.from;if("Blockquote"==s.name&&(e=/^ *>( ?)/.exec(i.text.slice(l))))n.push(new q(s,l,l+e[0].length,"",e[1],">",null));else if("ListItem"==s.name&&"OrderedList"==s.parent.name&&(e=/^( *)\d+([.)])( *)/.exec(i.text.slice(l)))){let t=e[3],r=e[0].length;t.length>=4&&(t=t.slice(0,t.length-4),r-=4),n.push(new q(s.parent,l,l+r,e[1],t,e[2],s))}else if("ListItem"==s.name&&"BulletList"==s.parent.name&&(e=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(i.text.slice(l)))){let t=e[4],r=e[0].length;t.length>4&&(t=t.slice(0,t.length-4),r-=4);let o=e[2];e[3]&&(o+=e[3].replace(/[xX]/," ")),n.push(new q(s.parent,l,l+r,e[1],t,o,s))}}return n}function R(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function X(e,t,r,n=0){for(let o=-1,s=e;;){if("ListItem"==s.name){let e=R(s,t),i=+e[2];if(o>=0){if(i!=o+1)return;r.push({from:s.from+e[1].length,to:s.from+e[0].length,insert:String(o+2+n)})}o=i}let e=s.nextSibling;if(!e)break;s=e}}function F(e,t){let n=/^[ \t]*/.exec(e)[0].length;if(!n||"\t"!=t.facet(c))return e;let o="";for(let s=r(e,4,n);s>0;)s>=4?(o+="\t",s-=4):(o+=" ",s--);return o+e.slice(n)}const H=(e={})=>({state:n,dispatch:o})=>{let s=f(n),{doc:i}=n,l=null,a=n.changeByRange(o=>{if(!o.empty||!D.isActiveAt(n,o.from,-1)&&!D.isActiveAt(n,o.from,1))return l={range:o};let a=o.from,m=i.lineAt(a),f=M(s.resolveInner(a,-1),i);for(;f.length&&f[f.length-1].from>a-m.from;)f.pop();if(!f.length)return l={range:o};let c=f[f.length-1];if(c.to-c.spaceAfter.length>a-m.from)return l={range:o};let u=a>=c.to-c.spaceAfter.length&&!/\S/.test(m.text.slice(c.to));if(c.item&&u){let r=c.node.firstChild,o=c.node.getChild("ListItem","ListItem");if(r.to>=a||o&&o.to<a||m.from>0&&!/[^\s>]/.test(i.lineAt(m.from-1).text)||!1===e.nonTightLists){let e,r=f.length>1?f[f.length-2]:null,n="";r&&r.item?(e=m.from+r.from,n=r.marker(i,1)):e=m.from+(r?r.to:0);let o=[{from:e,to:a,insert:n}];return"OrderedList"==c.node.name&&X(c.item,i,o,-2),r&&"OrderedList"==r.node.name&&X(r.item,i,o),{range:t.cursor(e+n.length),changes:o}}{let e=Q(f,n,m);return{range:t.cursor(a+e.length+1),changes:{from:m.from,insert:e+n.lineBreak}}}}if("Blockquote"==c.node.name&&u&&m.from){let e=i.lineAt(m.from-1),t=/>\s*$/.exec(e.text);if(t&&t.index==c.from){let r=n.changes([{from:e.from+t.index,to:e.to},{from:m.from+c.from,to:m.to}]);return{range:o.map(r),changes:r}}}let d=[];"OrderedList"==c.node.name&&X(c.item,i,d);let p=c.item&&c.item.from<m.from,g="";if(!p||/^[\s\d.)\-+*>]*/.exec(m.text)[0].length>=c.to)for(let e=0,t=f.length-1;e<=t;e++)g+=e!=t||p?f[e].blank(e<t?r(m.text,4,f[e+1].from)-g.length:null):f[e].marker(i,1);let h=a;for(;h>m.from&&/\s/.test(m.text.charAt(h-m.from-1));)h--;return g=F(g,n),function(e,t){if("OrderedList"!=e.name&&"BulletList"!=e.name)return!1;let r=e.firstChild,n=e.getChild("ListItem","ListItem");if(!n)return!1;let o=t.lineAt(r.to),s=t.lineAt(n.from),i=/^[\s>]*$/.test(o.text);return o.number+(i?0:1)<s.number}(c.node,n.doc)&&(g=Q(f,n,m)+n.lineBreak+g),d.push({from:h,to:a,insert:n.lineBreak+g}),{range:t.cursor(h+g.length+1),changes:d}});return!l&&(o(n.update(a,{scrollIntoView:!0,userEvent:"input"})),!0)},V=H();function N(e){return"QuoteMark"==e.name||"ListMark"==e.name}function Q(e,t,n){let o="";for(let s=0,i=e.length-2;s<=i;s++)o+=e[s].blank(s<i?r(n.text,4,e[s+1].from)-o.length:null,s<i);return F(o,t)}const U=({state:e,dispatch:n})=>{let o=f(e),s=null,i=e.changeByRange(n=>{let i=n.from,{doc:l}=e;if(n.empty&&D.isActiveAt(e,n.from)){let n=l.lineAt(i),s=M(function(e,t){let r=e.resolveInner(t,-1),n=t;N(r)&&(n=r.from,r=r.parent);for(let o;o=r.childBefore(n);)if(N(o))n=o.from;else{if("OrderedList"!=o.name&&"BulletList"!=o.name)break;r=o.lastChild,n=r.to}return r}(o,i),l);if(s.length){let o=s[s.length-1],l=o.to-o.spaceAfter.length+(o.spaceAfter?1:0);if(i-n.from>l&&!/\S/.test(n.text.slice(l,i-n.from)))return{range:t.cursor(n.from+l),changes:{from:n.from+l,to:i}};if(i-n.from==l&&(!o.item||n.from<=o.item.from||!/\S/.test(n.text.slice(0,o.to)))){let s=n.from+o.from;if(o.item&&o.node.from<o.item.from&&/\S/.test(n.text.slice(o.from,o.to))){let i=o.blank(r(n.text,4,o.to)-r(n.text,4,o.from));return s==n.from&&(i=F(i,e)),{range:t.cursor(s+i.length),changes:{from:s,to:n.from+o.to,insert:i}}}if(s<i)return{range:t.cursor(s),changes:{from:s,to:i}}}}}return s={range:n}});return!s&&(n(e.update(i,{scrollIntoView:!0,userEvent:"delete"})),!0)},G=[{key:"Enter",run:V},{key:"Backspace",run:U}],K=b({matchClosingTags:!1});function W(t={}){let{codeLanguages:r,defaultCodeLanguage:n,addKeymap:s=!0,base:{parser:i}=$,completeHTMLTags:a=!0,pasteURLAsLink:m=!0,htmlTagLanguage:f=K}=t;if(!(i instanceof x))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let c,u=t.extensions?[t.extensions]:[],d=[f.support,O];m&&d.push(ee),n instanceof l?(d.push(n.support),c=n.language):n&&(c=n);let p=r||c?(v=r,L=c,e=>{if(e&&v){let t=null;if(e=/\S*/.exec(e)[0],t="function"==typeof v?v(e):g.matchLanguageName(v,e,!0),t instanceof g)return t.support?t.support.language.parser:h.getSkippingParser(t.load());if(t)return t.parser}return L?L.parser:null}):void 0;var v,L;u.push(k({codeParser:p,htmlParser:f.language.parser})),s&&d.push(e.high(o.of(G)));let A=P(i.configure(u));return a&&d.push(A.data.of({autocomplete:Y})),new l(A,d)}function Y(e){let{state:t,pos:r}=e,n=/<[:\-\.\w\u00b7-\uffff]*$/.exec(t.sliceDoc(r-25,r));if(!n)return null;let o=f(t).resolveInner(r,-1);for(;o&&!o.type.isTop;){if("CodeBlock"==o.name||"FencedCode"==o.name||"ProcessingInstructionBlock"==o.name||"CommentBlock"==o.name||"Link"==o.name||"Image"==o.name)return null;o=o.parent}return{from:r-n[0].length,to:r,options:_(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}let Z=null;function _(){if(Z)return Z;let e=y(new v(n.create({extensions:K}),0,!0));return Z=e?e.options:[]}const J=/code|horizontalrule|html|link|comment|processing|escape|entity|image|mark|url/i,ee=s.domEventHandlers({paste:(e,t)=>{var r;let{main:n}=t.state.selection;if(n.empty)return!1;let o=null===(r=e.clipboardData)||void 0===r?void 0:r.getData("text/plain");if(!o||!/^(https?:\/\/|mailto:|xmpp:|www\.)/.test(o))return!1;if(/^www\./.test(o)&&(o="https://"+o),!D.isActiveAt(t.state,n.from,1))return!1;let s=f(t.state),i=!1;return s.iterate({from:n.from,to:n.to,enter:e=>{(e.from>n.from||J.test(e.name))&&(i=!0)},leave:e=>{e.to<n.to&&(i=!0)}}),!i&&(t.dispatch({changes:[{from:n.from,insert:"["},{from:n.to,insert:`](${o})`}],userEvent:"input.paste",scrollIntoView:!0}),!0)}});export{$ as commonmarkLanguage,U as deleteMarkupBackward,V as insertNewlineContinueMarkup,H as insertNewlineContinueMarkupCommand,W as markdown,G as markdownKeymap,D as markdownLanguage,ee as pasteURLAsLink};
