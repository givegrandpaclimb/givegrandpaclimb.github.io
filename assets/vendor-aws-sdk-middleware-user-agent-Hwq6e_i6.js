import{n as t}from"./vendor-smithy-core-Eai9z2ch.js";import"./vendor-aws-sdk-util-endpoints-CrZvh47w.js";import{s as e}from"./vendor-aws-sdk-core-B17qvS2b.js";import{a as r}from"./vendor-smithy-protocol-http-D-24QeOr.js";function n(e){const r=t(e.userAgentAppId??void 0),{customUserAgent:n}=e;return Object.assign(e,{customUserAgent:"string"==typeof n?[[n]]:n,userAgentAppId:async()=>{const t=await r();if(!function(t){return void 0===t||"string"==typeof t&&t.length<=50}(t)){const r="NoOpLogger"!==e.logger?.constructor?.name&&e.logger?e.logger:console;"string"!=typeof t?r?.warn("userAgentAppId must be a string or undefined."):t.length>50&&r?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return t}})}const s=/\d{12}\.ddb/,o="user-agent",a="x-amz-user-agent",c=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w]/g,i=/[^\!\$\%\&\'\*\+\-\.\^\_\`\|\~\d\w\#]/g,u=t=>{const e=t[0].split("/").map(t=>t.replace(c,"-")).join("/"),r=t[1]?.replace(i,"-"),n=e.indexOf("/"),s=e.substring(0,n);let o=e.substring(n+1);return"api"===s&&(o=o.toLowerCase()),[s,o,r].filter(t=>t&&t.length>0).reduce((t,e,r)=>{switch(r){case 0:return e;case 1:return`${t}/${e}`;default:return`${t}#${e}`}},"")},d={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},p=t=>({applyToStack:n=>{var c;n.add((c=t,(t,n)=>async i=>{const{request:d}=i;if(!r.isInstance(d))return t(i);const{headers:p}=d,g=n?.userAgent?.map(u)||[],_=(await c.defaultUserAgentProvider()).map(u);await async function(t,r,n){const o=n.request;if("rpc-v2-cbor"===o?.headers?.["smithy-protocol"]&&e(t,"PROTOCOL_RPC_V2_CBOR","M"),"function"==typeof r.retryStrategy){const n=await r.retryStrategy();"function"==typeof n.acquireInitialRetryToken?n.constructor?.name?.includes("Adaptive")?e(t,"RETRY_MODE_ADAPTIVE","F"):e(t,"RETRY_MODE_STANDARD","E"):e(t,"RETRY_MODE_LEGACY","D")}if("function"==typeof r.accountIdEndpointMode){const n=t.endpointV2;switch(String(n?.url?.hostname).match(s)&&e(t,"ACCOUNT_ID_ENDPOINT","O"),await(r.accountIdEndpointMode?.())){case"disabled":e(t,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":e(t,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":e(t,"ACCOUNT_ID_MODE_REQUIRED","R")}}const a=t.__smithy_context?.selectedHttpAuthScheme?.identity;if(a?.$source){const r=a;r.accountId&&e(t,"RESOLVED_ACCOUNT_ID","T");for(const[n,s]of Object.entries(r.$source??{}))e(t,n,s)}}(n,c,i);const f=n;_.push(`m/${function(t){let e="";for(const r in t){const n=t[r];if(!(e.length+n.length+1<=1024))break;e.length?e+=","+n:e+=n}return e}(Object.assign({},n.__smithy_context?.features,f.__aws_sdk_context?.features))}`);const l=c?.customUserAgent?.map(u)||[],m=await c.userAgentAppId();m&&_.push(u([`app/${m}`]));const A=[].concat([..._,...g,...l]).join(" "),E=[..._.filter(t=>t.startsWith("aws-sdk-")),...l].join(" ");return"browser"!==c.runtime?(E&&(p[a]=p[a]?`${p[o]} ${E}`:E),p[o]=A):p[a]=A,t({...i,request:d})}),d)}});export{p as g,n as r};
