import{g as e}from"./vendor-smithy-util-middleware-I6Z6a_gz.js";import{a as t,H as r}from"./vendor-smithy-protocol-http-ZjGpQTbx.js";import{U as s,s as i}from"./vendor-smithy-util-stream-DKZ_l2vo.js";import{_ as n}from"./vendor-aws-sdk-util-user-agent-browser-mg8iBncM.js";import{f as a,t as o}from"./vendor-smithy-util-base64-BxOL2JNu.js";import{t as c,f as h}from"./vendor-smithy-util-utf8-MtSxxKG8.js";import{v as u}from"./vendor-smithy-uuid-CiJeYpB1.js";const d={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},m=(t,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:s})=>({applyToStack:i=>{i.addRelativeTo(((t,r)=>(s,i)=>async n=>{const a=((e,t)=>{if(!t||0===t.length)return e;const r=[];for(const s of t)for(const t of e)t.schemeId.split("#")[1]===s&&r.push(t);for(const s of e)r.find(({schemeId:e})=>e===s.schemeId)||r.push(s);return r})(t.httpAuthSchemeProvider(await r.httpAuthSchemeParametersProvider(t,i,n.input)),t.authSchemePreference?await t.authSchemePreference():[]),o=function(e){const t=new Map;for(const r of e)t.set(r.schemeId,r);return t}(t.httpAuthSchemes),c=e(i),h=[];for(const e of a){const s=o.get(e.schemeId);if(!s){h.push(`HttpAuthScheme \`${e.schemeId}\` was not enabled for this service.`);continue}const n=s.identityProvider(await r.identityProviderConfigProvider(t));if(!n){h.push(`HttpAuthScheme \`${e.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:a={},signingProperties:u={}}=e.propertiesExtractor?.(t,i)||{};e.identityProperties=Object.assign(e.identityProperties||{},a),e.signingProperties=Object.assign(e.signingProperties||{},u),c.selectedHttpAuthScheme={httpAuthOption:e,identity:await n(e.identityProperties),signer:s.signer};break}if(!c.selectedHttpAuthScheme)throw new Error(h.join("\n"));return s(n)})(t,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:s}),d)}}),l=e=>e=>{throw e},p=(e,t)=>{},f={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},g=r=>({applyToStack:r=>{r.addRelativeTo((r,s)=>async i=>{if(!t.isInstance(i.request))return r(i);const n=e(s).selectedHttpAuthScheme;if(!n)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:a={}},identity:o,signer:c}=n,h=await r({...i,request:await c.sign(i.request,o,a)}).catch((c.errorHandler||l)(a));return(c.successHandler||p)(h.response,a),h},f)}}),y=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},S=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return s.mutate(e);if(!e)return s.mutate(new Uint8Array);const r=t.streamCollector(e);return s.mutate(await r)};function b(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}const w=e=>"function"==typeof e?e():e,v=(e,t,r,s,i)=>({name:t,namespace:e,traits:r,input:s,output:i}),T=(e,t)=>(t.find(([t])=>t.match(e))||[void 0,void 0])[1],M={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},x={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function C(t){return{applyToStack:s=>{s.add((t=>(r,s)=>async i=>{const{operationSchema:n}=e(s),[,a,o,c,h,u]=n??[],d=s.endpointV2?.url&&t.urlParser?async()=>t.urlParser(s.endpointV2.url):t.endpoint,m=await t.protocol.serializeRequest(v(a,o,c,h,u),i.input,{...t,...s,endpoint:d});return r({...i,request:m})})(t),x),s.add((t=>(s,i)=>async n=>{const{response:a}=await s(n),{operationSchema:o}=e(i),[,c,h,u,d,m]=o??[];try{return{response:a,output:await t.protocol.deserializeResponse(v(c,h,u,d,m),{...t,...i},a)}}catch(l){if(Object.defineProperty(l,"$response",{value:a,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in l)){const e="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{l.message+="\n  "+e}catch(p){i.logger&&"NoOpLogger"!==i.logger?.constructor?.name&&i.logger?.warn?.(e)}void 0!==l.$responseBodyText&&l.$response&&(l.$response.body=l.$responseBodyText);try{if(r.isInstance(a)){const{headers:e={}}=a,t=Object.entries(e);l.$metadata={httpStatusCode:a.statusCode,requestId:T(/^x-[\w-]+-request-?id$/,t),extendedRequestId:T(/^x-[\w-]+-id-2$/,t),cfId:T(/^x-[\w-]+-cf-id$/,t)}}}catch(p){}}throw l}})(t),M),t.protocol.setSerdeContext(t)}}}function E(e){if("object"==typeof e)return e;e|=0;const t={};let r=0;for(const s of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])1==(e>>r++&1)&&(t[s]=1);return t}class ${ref;memberName;static symbol=Symbol.for("@smithy/nor");symbol=$.symbol;name;schema;_isMemberSchema;traits;memberTraits;normalizedTraits;constructor(e,t){this.ref=e,this.memberName=t;const r=[];let s=e,i=e;for(this._isMemberSchema=!1;N(s);)r.push(s[1]),s=s[0],i=w(s),this._isMemberSchema=!0;if(r.length>0){this.memberTraits={};for(let e=r.length-1;e>=0;--e){const t=r[e];Object.assign(this.memberTraits,E(t))}}else this.memberTraits=0;if(i instanceof $){const e=this.memberTraits;return Object.assign(this,i),this.memberTraits=Object.assign({},e,i.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,void(this.memberName=t??i.memberName)}if(this.schema=w(i),P(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=this.memberName??String(i),this.traits=0),this._isMemberSchema&&!t)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](e){const t=this.prototype.isPrototypeOf(e);return t||"object"!=typeof e||null===e?t:e.symbol===this.symbol}static of(e){const t=w(e);if(t instanceof $)return t;if(N(t)){const[r,s]=t;if(r instanceof $)return Object.assign(r.getMergedTraits(),E(s)),r;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(e,null,2)}.`)}return new $(t)}getSchema(){const e=this.schema;return 0===e[0]?e[4]:e}getName(e=!1){const{name:t}=this;return!e&&t&&t.includes("#")?t.split("#")[1]:t||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){const e=this.getSchema();return"number"==typeof e?e>=64&&e<128:1===e[0]}isMapSchema(){const e=this.getSchema();return"number"==typeof e?e>=128&&e<=255:2===e[0]}isStructSchema(){const e=this.getSchema();return 3===e[0]||-3===e[0]}isBlobSchema(){const e=this.getSchema();return 21===e||42===e}isTimestampSchema(){const e=this.getSchema();return"number"==typeof e&&e>=4&&e<=7}isUnitSchema(){return"unit"===this.getSchema()}isDocumentSchema(){return 15===this.getSchema()}isStringSchema(){return 0===this.getSchema()}isBooleanSchema(){return 2===this.getSchema()}isNumericSchema(){return 1===this.getSchema()}isBigIntegerSchema(){return 17===this.getSchema()}isBigDecimalSchema(){return 19===this.getSchema()}isStreaming(){const{streaming:e}=this.getMergedTraits();return!!e||42===this.getSchema()}isIdempotencyToken(){const e=e=>!(4&~e&&!e?.idempotencyToken),{normalizedTraits:t,traits:r,memberTraits:s}=this;return e(t)||e(r)||e(s)}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return E(this.memberTraits)}getOwnTraits(){return E(this.traits)}getKeySchema(){const[e,t]=[this.isDocumentSchema(),this.isMapSchema()];if(!e&&!t)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const r=this.getSchema();return z([e?15:r[4]??0,0],"key")}getValueSchema(){const e=this.getSchema(),[t,r,s]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],i="number"==typeof e?63&e:e&&"object"==typeof e&&(r||s)?e[3+e[0]]:t?15:void 0;if(null!=i)return z([i,0],r?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(e){const t=this.getSchema();if(this.isStructSchema()&&t[4].includes(e)){const r=t[4].indexOf(e),s=t[5][r];return z(N(s)?s:[s,0],e)}if(this.isDocumentSchema())return z([15,0],e);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${e}.`)}getMemberSchemas(){const e={};try{for(const[t,r]of this.structIterator())e[t]=r}catch(t){}return e}getEventStreamMember(){if(this.isStructSchema())for(const[e,t]of this.structIterator())if(t.isStreaming()&&t.isStructSchema())return e;return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const e=this.getSchema();for(let t=0;t<e[4].length;++t)yield[e[4][t],z([e[5][t],0],e[4][t])]}}function z(e,t){return e instanceof $?Object.assign(e,{memberName:t,_isMemberSchema:!0}):new $(e,t)}const N=e=>Array.isArray(e)&&2===e.length,P=e=>Array.isArray(e)&&e.length>=5;class I{namespace;schemas;exceptions;static registries=new Map;constructor(e,t=new Map,r=new Map){this.namespace=e,this.schemas=t,this.exceptions=r}static for(e){return I.registries.has(e)||I.registries.set(e,new I(e)),I.registries.get(e)}register(e,t){const r=this.normalizeShapeId(e);I.for(r.split("#")[0]).schemas.set(r,t)}getSchema(e){const t=this.normalizeShapeId(e);if(!this.schemas.has(t))throw new Error(`@smithy/core/schema - schema not found for ${t}`);return this.schemas.get(t)}registerError(e,t){const r=e,s=I.for(r[1]);s.schemas.set(r[1]+"#"+r[2],r),s.exceptions.set(r,t)}getErrorCtor(e){const t=e;return I.for(t[1]).exceptions.get(t)}getBaseException(){for(const e of this.exceptions.keys())if(Array.isArray(e)){const[,t,r]=e,s=t+"#"+r;if(s.startsWith("smithy.ts.sdk.synthetic.")&&s.endsWith("ServiceException"))return e}}find(e){return[...this.schemas.values()].find(e)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId(e){return e.includes("#")?e:this.namespace+"#"+e}}const D=Math.ceil(2**127*(2-2**-23)),O=(e,t)=>{const r=(e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}})(e);if(void 0!==r&&j(r,t)!==r)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return r},j=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},A=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,R=e=>{const t=e.match(A);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},H=e=>(e=>O(e,16))("string"==typeof e?R(e):e),B={warn:console.warn},_=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function U(e){const t=e.getUTCFullYear(),r=e.getUTCMonth(),s=e.getUTCDay(),i=e.getUTCDate(),n=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds(),c=n<10?`0${n}`:`${n}`,h=a<10?`0${a}`:`${a}`,u=o<10?`0${o}`:`${o}`;return`${_[s]}, ${i<10?`0${i}`:`${i}`} ${q[r]} ${t} ${c}:${h}:${u} GMT`}const F=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),k=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),L=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),J=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-7231 date-times must be expressed as strings");let t=F.exec(e);if(t){const[e,r,s,i,n,a,o,c]=t;return V(H(te(i)),G(s),X(r,"day",1,31),{hours:n,minutes:a,seconds:o,fractionalMilliseconds:c})}if(t=k.exec(e),t){const[e,r,s,i,n,a,o,c]=t;return W(V(Q(i),G(s),X(r,"day",1,31),{hours:n,minutes:a,seconds:o,fractionalMilliseconds:c}))}if(t=L.exec(e),t){const[e,r,s,i,n,a,o,c]=t;return V(H(te(c)),G(r),X(s.trimLeft(),"day",1,31),{hours:i,minutes:n,seconds:a,fractionalMilliseconds:o})}throw new TypeError("Invalid RFC-7231 date-time value")},V=(e,t,r,s)=>{const i=t-1;return Y(e,i,r),new Date(Date.UTC(e,i,r,X(s.hours,"hour",0,23),X(s.minutes,"minute",0,59),X(s.seconds,"seconds",0,60),ee(s.fractionalMilliseconds)))},Q=e=>{const t=(new Date).getUTCFullYear(),r=100*Math.floor(t/100)+H(te(e));return r<t?r+100:r},W=e=>e.getTime()-(new Date).getTime()>15768e8?new Date(Date.UTC(e.getUTCFullYear()-100,e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())):e,G=e=>{const t=q.indexOf(e);if(t<0)throw new TypeError(`Invalid month: ${e}`);return t+1},Z=[31,28,31,30,31,30,31,31,30,31,30,31],Y=(e,t,r)=>{let s=Z[t];if(1===t&&K(e)&&(s=29),r>s)throw new TypeError(`Invalid day for ${q[t]} in ${e}: ${r}`)},K=e=>e%4==0&&(e%100!=0||e%400==0),X=(e,t,r,s)=>{const i=(e=>(e=>O(e,8))("string"==typeof e?R(e):e))(te(e));if(i<r||i>s)throw new TypeError(`${t} must be between ${r} and ${s}, inclusive`);return i},ee=e=>null==e?0:1e3*(e=>(e=>{const t=(e=>{if(null!=e){if("string"==typeof e){const r=parseFloat(e);if(!Number.isNaN(r))return String(r)!==String(e)&&B.warn((t=`Expected number but observed string: ${e}`,String(new TypeError(t).stack||t).split("\n").slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join("\n"))),r}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}var t})(e);if(void 0!==t&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>D)throw new TypeError(`Expected 32-bit float, got ${e}`);return t})("string"==typeof e?R(e):e))("0."+e),te=e=>{let t=0;for(;t<e.length-1&&"0"===e.charAt(t);)t++;return 0===t?e:e.slice(t)},re=function(e){return Object.assign(new String(e),{deserializeJSON:()=>JSON.parse(String(e)),toString:()=>String(e),toJSON:()=>String(e)})};function se(e){return(e.includes(",")||e.includes('"'))&&(e=`"${e.replace(/"/g,'\\"')}"`),e}re.from=e=>e&&"object"==typeof e&&(e instanceof re||"deserializeJSON"in e)?e:"string"==typeof e||Object.getPrototypeOf(e)===String.prototype?re(String(e)):re(JSON.stringify(e)),re.fromObject=re.from;const ie="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",ne="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",ae="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",oe="(\\d?\\d)",ce="(\\d{4})",he=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),ue=new RegExp(`^${ie}, ${oe} ${ne} ${ce} ${ae} GMT$`),de=new RegExp(`^${ie}, ${oe}-${ne}-(\\d\\d) ${ae} GMT$`),me=new RegExp(`^${ie} ${ne} ( [1-9]|\\d\\d) ${ae} ${ce}$`),le=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function pe(e,t,r){const s=Number(e);if(s<t||s>r)throw new Error(`Value ${s} out of range [${t}, ${r}]`)}function fe(e,t,r){if(!Number.isInteger(r))throw new Error("Invalid number of delimiters ("+r+") for splitEvery.");const s=e.split(t),i=[];let n="";for(let a=0;a<s.length;a++)""===n?n=s[a]:n+=t+s[a],(a+1)%r===0&&(i.push(n),n="");return""!==n&&i.push(n),i}const ge=e=>{const t=e.length,r=[];let s,i=!1,n=0;for(let a=0;a<t;++a){const t=e[a];switch(t){case'"':"\\"!==s&&(i=!i);break;case",":i||(r.push(e.slice(n,a)),n=a+1)}s=t}return r.push(e.slice(n)),r.map(e=>{const t=(e=e.trim()).length;return t<2?e:('"'===e[0]&&'"'===e[t-1]&&(e=e.slice(1,t-1)),e.replace(/\\"/g,'"'))})},ye=/^-?\d*(\.\d+)?$/;class Se{string;type;constructor(e,t){if(this.string=e,this.type=t,!ye.test(e))throw new Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance](e){if(!e||"object"!=typeof e)return!1;const t=e;return Se.prototype.isPrototypeOf(e)||"bigDecimal"===t.type&&ye.test(t.string)}}class be{serdeContext;setSerdeContext(e){this.serdeContext=e}}class we extends be{options;constructor(e){super(),this.options=e}getRequestType(){return t}getResponseType(){return r}setSerdeContext(e){this.serdeContext=e,this.serializer.setSerdeContext(e),this.deserializer.setSerdeContext(e),this.getPayloadCodec()&&this.getPayloadCodec().setSerdeContext(e)}updateServiceEndpoint(e,t){if("url"in t){e.protocol=t.url.protocol,e.hostname=t.url.hostname,e.port=t.url.port?Number(t.url.port):void 0,e.path=t.url.pathname,e.fragment=t.url.hash||void 0,e.username=t.url.username||void 0,e.password=t.url.password||void 0,e.query||(e.query={});for(const[r,s]of t.url.searchParams.entries())e.query[r]=s;return e}return e.protocol=t.protocol,e.hostname=t.hostname,e.port=t.port?Number(t.port):void 0,e.path=t.path,e.query={...t.query},e}setHostPrefix(e,t,r){const s=$.of(t.input),i=E(t.traits??{});if(i.endpoint){let t=i.endpoint?.[0];if("string"==typeof t){const i=[...s.structIterator()].filter(([,e])=>e.getMergedTraits().hostLabel);for(const[e]of i){const s=r[e];if("string"!=typeof s)throw new Error(`@smithy/core/schema - ${e} in input must be a string as hostLabel.`);t=t.replace(`{${e}}`,s)}e.hostname=t+e.hostname}}}deserializeMetadata(e){return{httpStatusCode:e.statusCode,requestId:e.headers["x-amzn-requestid"]??e.headers["x-amzn-request-id"]??e.headers["x-amz-request-id"],extendedRequestId:e.headers["x-amz-id-2"],cfId:e.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:r}){return(await this.loadEventStreamCapability()).deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:r})}async loadEventStreamCapability(){const{EventStreamSerde:e}=await n(async()=>{const{EventStreamSerde:e}=await Promise.resolve().then(()=>De);return{EventStreamSerde:e}},void 0);return new e({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw new Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(e,t,r,s,i){return[]}getEventStreamMarshaller(){const e=this.serdeContext;if(!e.eventStreamMarshaller)throw new Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return e.eventStreamMarshaller}}class ve extends we{async serializeRequest(e,r,s){const i={...r??{}},n=this.serializer,a={},o={},c=await s.endpoint(),h=$.of(e?.input),u=h.getSchema();let d,m=!1;const l=new t({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query:a,headers:o,body:void 0});if(c){this.updateServiceEndpoint(l,c),this.setHostPrefix(l,e,i);const t=E(e.traits);if(t.http){l.method=t.http[0];const[e,r]=t.http[1].split("?");"/"==l.path?l.path=e:l.path+=e;const s=new URLSearchParams(r??"");Object.assign(a,Object.fromEntries(s))}}for(const[t,p]of h.structIterator()){const e=p.getMergedTraits()??{},r=i[t];if(null!=r||p.isIdempotencyToken())if(e.httpPayload)p.isStreaming()?p.isStructSchema()?i[t]&&(d=await this.serializeEventStream({eventStream:i[t],requestSchema:h})):d=r:(n.write(p,r),d=n.flush()),delete i[t];else if(e.httpLabel){n.write(p,r);const e=n.flush();l.path.includes(`{${t}+}`)?l.path=l.path.replace(`{${t}+}`,e.split("/").map(b).join("/")):l.path.includes(`{${t}}`)&&(l.path=l.path.replace(`{${t}}`,b(e))),delete i[t]}else if(e.httpHeader)n.write(p,r),o[e.httpHeader.toLowerCase()]=String(n.flush()),delete i[t];else if("string"==typeof e.httpPrefixHeaders){for(const[t,s]of Object.entries(r)){const r=e.httpPrefixHeaders+t;n.write([p.getValueSchema(),{httpHeader:r}],s),o[r.toLowerCase()]=n.flush()}delete i[t]}else e.httpQuery||e.httpQueryParams?(this.serializeQuery(p,r,a),delete i[t]):m=!0}return m&&i&&(n.write(u,i),d=n.flush()),l.headers=o,l.query=a,l.body=d,l}serializeQuery(e,t,r){const s=this.serializer,i=e.getMergedTraits();if(i.httpQueryParams){for(const[n,a]of Object.entries(t))if(!(n in r)){const t=e.getValueSchema();Object.assign(t.getMergedTraits(),{...i,httpQuery:n,httpQueryParams:void 0}),this.serializeQuery(t,a,r)}}else if(e.isListSchema()){const n=!!e.getMergedTraits().sparse,a=[];for(const r of t){s.write([e.getValueSchema(),i],r);const t=s.flush();(n||void 0!==t)&&a.push(t)}r[i.httpQuery]=a}else s.write([e,i],t),r[i.httpQuery]=s.flush()}async deserializeResponse(e,t,r){const s=this.deserializer,i=$.of(e.output),n={};if(r.statusCode>=300){const i=await S(r.body,t);throw i.byteLength>0&&Object.assign(n,await s.read(15,i)),await this.handleError(e,t,r,n,this.deserializeMetadata(r)),new Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(const o in r.headers){const e=r.headers[o];delete r.headers[o],r.headers[o.toLowerCase()]=e}const a=await this.deserializeHttpMessage(i,t,r,n);if(a.length){const e=await S(r.body,t);if(e.byteLength>0){const t=await s.read(i,e);for(const e of a)n[e]=t[e]}}else a.discardResponseBody&&await S(r.body,t);return n.$metadata=this.deserializeMetadata(r),n}async deserializeHttpMessage(e,t,r,s,n){let a;a=s instanceof Set?n:s;let o=!0;const c=this.deserializer,h=$.of(e),u=[];for(const[d,m]of h.structIterator()){const e=m.getMemberTraits();if(e.httpPayload){if(o=!1,m.isStreaming()){const e=m.isStructSchema();a[d]=e?await this.deserializeEventStream({response:r,responseSchema:h}):i(r.body)}else if(r.body){const e=await S(r.body,t);e.byteLength>0&&(a[d]=await c.read(m,e))}}else if(e.httpHeader){const t=String(e.httpHeader).toLowerCase(),s=r.headers[t];if(null!=s)if(m.isListSchema()){const e=m.getValueSchema();let r;e.getMergedTraits().httpHeader=t,r=e.isTimestampSchema()&&4===e.getSchema()?fe(s,",",2):ge(s);const i=[];for(const t of r)i.push(await c.read(e,t.trim()));a[d]=i}else a[d]=await c.read(m,s)}else if(void 0!==e.httpPrefixHeaders){a[d]={};for(const[t,s]of Object.entries(r.headers))if(t.startsWith(e.httpPrefixHeaders)){const r=m.getValueSchema();r.getMergedTraits().httpHeader=t,a[d][t.slice(e.httpPrefixHeaders.length)]=await c.read(r,s)}}else e.httpResponseCode?a[d]=r.statusCode:u.push(d)}return u.discardResponseBody=o,u}}function Te(e,t){if(t.timestampFormat.useTrait&&e.isTimestampSchema()&&(5===e.getSchema()||6===e.getSchema()||7===e.getSchema()))return e.getSchema();const{httpLabel:r,httpPrefixHeaders:s,httpHeader:i,httpQuery:n}=e.getMergedTraits();return(t.httpBindings?"string"==typeof s||Boolean(i)?6:Boolean(n)||Boolean(r)?5:void 0:void 0)??t.timestampFormat.default}class Me extends be{settings;constructor(e){super(),this.settings=e}read(e,t){const r=$.of(e);if(r.isListSchema())return ge(t).map(e=>this.read(r.getValueSchema(),e));if(r.isBlobSchema())return(this.serdeContext?.base64Decoder??a)(t);if(r.isTimestampSchema())switch(Te(r,this.settings)){case 5:return(e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC3339 timestamps must be strings");const t=he.exec(e);if(!t)throw new TypeError(`Invalid RFC3339 timestamp format ${e}`);const[,r,s,i,n,a,o,,c,h]=t;pe(s,1,12),pe(i,1,31),pe(n,0,23),pe(a,0,59),pe(o,0,60);const u=new Date(Date.UTC(Number(r),Number(s)-1,Number(i),Number(n),Number(a),Number(o),Number(c)?Math.round(1e3*parseFloat(`0.${c}`)):0));if(u.setUTCFullYear(Number(r)),"Z"!=h.toUpperCase()){const[,e,t,r]=/([+-])(\d\d):(\d\d)/.exec(h)||[void 0,"+",0,0],s="-"===e?1:-1;u.setTime(u.getTime()+s*(60*Number(t)*60*1e3+60*Number(r)*1e3))}return u})(t);case 6:return(e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC7231 timestamps must be strings.");let t,r,s,i,n,a,o,c;if((c=ue.exec(e))?[,t,r,s,i,n,a,o]=c:(c=de.exec(e))?([,t,r,s,i,n,a,o]=c,s=(Number(s)+1900).toString()):(c=me.exec(e))&&([,r,t,i,n,a,o,s]=c),s&&a){const e=Date.UTC(Number(s),le.indexOf(r),Number(t),Number(i),Number(n),Number(a),o?Math.round(1e3*parseFloat(`0.${o}`)):0);pe(t,1,31),pe(i,0,23),pe(n,0,59),pe(a,0,60);const c=new Date(e);return c.setUTCFullYear(Number(s)),c}throw new TypeError(`Invalid RFC7231 date-time value ${e}.`)})(t);case 7:return(e=>{if(null==e)return;let t=NaN;if("number"==typeof e)t=e;else if("string"==typeof e){if(!/^-?\d*\.?\d+$/.test(e))throw new TypeError("parseEpochTimestamp - numeric string invalid.");t=Number.parseFloat(e)}else"object"==typeof e&&1===e.tag&&(t=e.value);if(isNaN(t)||Math.abs(t)===1/0)throw new TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round(1e3*t))})(t);default:return new Date(t)}if(r.isStringSchema()){const e=r.getMergedTraits().mediaType;let s=t;if(e)return r.getMergedTraits().httpHeader&&(s=this.base64ToUtf8(s)),("application/json"===e||e.endsWith("+json"))&&(s=re.from(s)),s}return r.isNumericSchema()?Number(t):r.isBigIntegerSchema()?BigInt(t):r.isBigDecimalSchema()?new Se(t,"bigDecimal"):r.isBooleanSchema()?"true"===String(t).toLowerCase():t}base64ToUtf8(e){return(this.serdeContext?.utf8Encoder??c)((this.serdeContext?.base64Decoder??a)(e))}}class xe extends be{codecDeserializer;stringDeserializer;constructor(e,t){super(),this.codecDeserializer=e,this.stringDeserializer=new Me(t)}setSerdeContext(e){this.stringDeserializer.setSerdeContext(e),this.codecDeserializer.setSerdeContext(e),this.serdeContext=e}read(e,t){const r=$.of(e),s=r.getMergedTraits(),i=this.serdeContext?.utf8Encoder??c;if(s.httpHeader||s.httpResponseCode)return this.stringDeserializer.read(r,i(t));if(s.httpPayload){if(r.isBlobSchema()){const e=this.serdeContext?.utf8Decoder??h;return"string"==typeof t?e(t):t}if(r.isStringSchema())return"byteLength"in t?i(t):t}return this.codecDeserializer.read(r,t)}}class Ce extends be{settings;stringBuffer="";constructor(e){super(),this.settings=e}write(e,t){const r=$.of(e);switch(typeof t){case"object":if(null===t)return void(this.stringBuffer="null");if(r.isTimestampSchema()){if(!(t instanceof Date))throw new Error(`@smithy/core/protocols - received non-Date value ${t} when schema expected Date in ${r.getName(!0)}`);switch(Te(r,this.settings)){case 5:this.stringBuffer=t.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=U(t);break;default:this.stringBuffer=String(t.getTime()/1e3)}return}if(r.isBlobSchema()&&"byteLength"in t)return void(this.stringBuffer=(this.serdeContext?.base64Encoder??o)(t));if(r.isListSchema()&&Array.isArray(t)){let e="";for(const s of t){this.write([r.getValueSchema(),r.getMergedTraits()],s);const t=this.flush();""!==e&&(e+=", "),e+=r.getValueSchema().isTimestampSchema()?t:se(t)}return void(this.stringBuffer=e)}this.stringBuffer=JSON.stringify(t,null,2);break;case"string":const e=r.getMergedTraits().mediaType;let s=t;if(e&&(("application/json"===e||e.endsWith("+json"))&&(s=re.from(s)),r.getMergedTraits().httpHeader))return void(this.stringBuffer=(this.serdeContext?.base64Encoder??o)(s.toString()));this.stringBuffer=t;break;default:r.isIdempotencyToken()?this.stringBuffer=u():this.stringBuffer=String(t)}}flush(){const e=this.stringBuffer;return this.stringBuffer="",e}}class Ee{codecSerializer;stringSerializer;buffer;constructor(e,t,r=new Ce(t)){this.codecSerializer=e,this.stringSerializer=r}setSerdeContext(e){this.codecSerializer.setSerdeContext(e),this.stringSerializer.setSerdeContext(e)}write(e,t){const r=$.of(e),s=r.getMergedTraits();return s.httpHeader||s.httpLabel||s.httpQuery?(this.stringSerializer.write(r,t),void(this.buffer=this.stringSerializer.flush())):this.codecSerializer.write(r,t)}flush(){if(void 0!==this.buffer){const e=this.buffer;return this.buffer=void 0,e}return this.codecSerializer.flush()}}function $e(e,t,r){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=r}class ze{authSchemes=new Map;constructor(e){for(const[t,r]of Object.entries(e))void 0!==r&&this.authSchemes.set(t,r)}getIdentityProvider(e){return this.authSchemes.get(e)}}const Ne=function(e){return Pe(e)&&e.expiration.getTime()-Date.now()<3e5},Pe=e=>void 0!==e.expiration,Ie=(e,t,r)=>{if(void 0===e)return;const s="function"!=typeof e?async()=>Promise.resolve(e):e;let i,n,a,o=!1;const c=async e=>{n||(n=s(e));try{i=await n,a=!0,o=!1}finally{n=void 0}return i};return void 0===t?async e=>(a&&!e?.forceRefresh||(i=await c(e)),i):async e=>(a&&!e?.forceRefresh||(i=await c(e)),o?i:r(i)?t(i)?(await c(e),i):i:(o=!0,i))},De=Object.freeze(Object.defineProperty({__proto__:null,EventStreamSerde:class{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller:e,serializer:t,deserializer:r,serdeContext:s,defaultContentType:i}){this.marshaller=e,this.serializer=t,this.deserializer=r,this.serdeContext=s,this.defaultContentType=i}async serializeEventStream({eventStream:e,requestSchema:t,initialRequest:r}){const s=this.marshaller,i=t.getEventStreamMember(),n=t.getMemberSchema(i),a=this.serializer,o=this.defaultContentType,c=Symbol("initialRequestMarker"),h={async*[Symbol.asyncIterator](){if(r){const e={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:o}};a.write(t,r);const s=a.flush();yield{[c]:!0,headers:e,body:s}}for await(const t of e)yield t}};return s.serialize(h,e=>{if(e[c])return{headers:e.headers,body:e.body};const t=Object.keys(e).find(e=>"__type"!==e)??"",{additionalHeaders:r,body:s,eventType:i,explicitPayloadContentType:a}=this.writeEventBody(t,n,e);return{headers:{":event-type":{type:"string",value:i},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:a??o},...r},body:s}})}async deserializeEventStream({response:e,responseSchema:t,initialResponseContainer:r}){const s=this.marshaller,i=t.getEventStreamMember(),n=t.getMemberSchema(i).getMemberSchemas(),a=Symbol("initialResponseMarker"),o=s.deserialize(e.body,async e=>{const r=Object.keys(e).find(e=>"__type"!==e)??"",s=e[r].body;if("initial-response"===r){const e=await this.deserializer.read(t,s);return delete e[i],{[a]:!0,...e}}if(r in n){const t=n[r];if(t.isStructSchema()){const i={};let n=!1;for(const[a,o]of t.structIterator()){const{eventHeader:t,eventPayload:h}=o.getMergedTraits();if(n=n||Boolean(t||h),h)o.isBlobSchema()?i[a]=s:o.isStringSchema()?i[a]=(this.serdeContext?.utf8Encoder??c)(s):o.isStructSchema()&&(i[a]=await this.deserializer.read(o,s));else if(t){const t=e[r].headers[a]?.value;null!=t&&(o.isNumericSchema()?i[a]=t&&"object"==typeof t&&"bytes"in t?BigInt(t.toString()):Number(t):i[a]=t)}}if(n)return{[r]:i}}return{[r]:await this.deserializer.read(t,s)}}return{$unknown:e}}),h=o[Symbol.asyncIterator](),u=await h.next();if(u.done)return o;if(u.value?.[a]){if(!t)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[e,t]of Object.entries(u.value))r[e]=t}return{async*[Symbol.asyncIterator](){for(u?.value?.[a]||(yield u.value);;){const{done:e,value:t}=await h.next();if(e)break;yield t}}}}writeEventBody(e,t,r){const s=this.serializer;let i,n=e,a=null;const o={};if(t.getSchema()[4].includes(e)){const n=t.getMemberSchema(e);if(!n.isStructSchema())throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.");for(const[t,s]of n.structIterator()){const{eventHeader:i,eventPayload:n}=s.getMergedTraits();if(n)a=t;else if(i){const i=r[e][t];let n="binary";s.isNumericSchema()?n=(-2)**31<=i&&i<=2**31-1?"integer":"long":s.isTimestampSchema()?n="timestamp":s.isStringSchema()?n="string":s.isBooleanSchema()&&(n="boolean"),null!=i&&(o[t]={type:n,value:i},delete r[e][t])}}if(null!==a){const t=n.getMemberSchema(a);t.isBlobSchema()?i="application/octet-stream":t.isStringSchema()&&(i="text/plain"),s.write(t,r[e][a])}else s.write(n,r[e])}else{const[t,i]=r[e];n=t,s.write(15,i)}const c=s.flush();return{body:"string"==typeof c?(this.serdeContext?.utf8Decoder??h)(c):c,eventType:n,explicitPayloadContentType:i,additionalHeaders:o}}}},Symbol.toStringTag,{value:"Module"}));export{ze as D,Me as F,ve as H,$ as N,I as T,m as a,g as b,Te as c,Pe as d,U as e,Se as f,C as g,Ee as h,Ne as i,xe as j,f as k,Ie as m,y as n,J as p,$e as s};
