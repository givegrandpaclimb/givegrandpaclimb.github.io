import{f as t}from"./vendor-marijn-find-cluster-break-BFVNO93u.js";class e{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){[t,e]=u(this,t,e);let r=[];return this.decompose(0,t,r,2),i.length&&i.decompose(0,i.length,r,3),this.decompose(e,this.length,r,1),s.from(r,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=u(this,t,e);let i=[];return this.decompose(t,e,i,0),s.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new h(this),r=new h(t);for(let n=e,h=e;;){if(s.next(n),r.next(n),n=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(h+=s.value.length,s.done||h>=i)return!0}}iter(t=1){return new h(this,t)}iterRange(t,e=this.length){return new l(this,t,e)}iterLines(t,e){let i;if(null==t)i=this.iter();else{null==e&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new o(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(0==t.length)throw new RangeError("A document must have at least one line");return 1!=t.length||t[0]?t.length<=32?new i(t):s.from(i.split(t,[])):e.empty}}class i extends e{constructor(t,e=function(t){let e=-1;for(let i of t)e+=i.length+1;return e}(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let r=0;;r++){let n=this.text[r],h=s+n.length;if((e?i:h)>=t)return new f(s,h,i,n);s=h+1,i++}}decompose(t,e,s,h){let l=t<=0&&e>=this.length?this:new i(n(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(1&h){let t=s.pop(),e=r(l.text,t.text.slice(),0,l.length);if(e.length<=32)s.push(new i(e,t.length+l.length));else{let t=e.length>>1;s.push(new i(e.slice(0,t)),new i(e.slice(t)))}}else s.push(l)}replace(t,e,h){if(!(h instanceof i))return super.replace(t,e,h);[t,e]=u(this,t,e);let l=r(this.text,r(h.text,n(this.text,0,t)),e),o=this.length+h.length-(e-t);return l.length<=32?new i(l,o):s.from(i.split(l,[]),o)}sliceString(t,e=this.length,i="\n"){[t,e]=u(this,t,e);let s="";for(let r=0,n=0;r<=e&&n<this.text.length;n++){let h=this.text[n],l=r+h.length;r>t&&n&&(s+=i),t<l&&e>r&&(s+=h.slice(Math.max(0,t-r),e-r)),r=l+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let s=[],r=-1;for(let n of t)s.push(n),r+=n.length+1,32==s.length&&(e.push(new i(s,r)),s=[],r=-1);return r>-1&&e.push(new i(s,r)),e}}class s extends e{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,s){for(let r=0;;r++){let n=this.children[r],h=s+n.length,l=i+n.lines-1;if((e?l:h)>=t)return n.lineInner(t,e,i,s);s=h+1,i=l+1}}decompose(t,e,i,s){for(let r=0,n=0;n<=e&&r<this.children.length;r++){let h=this.children[r],l=n+h.length;if(t<=l&&e>=n){let r=s&((n<=t?1:0)|(l>=e?2:0));n>=t&&l<=e&&!r?i.push(h):h.decompose(t-n,e-n,i,r)}n=l+1}}replace(t,e,i){if([t,e]=u(this,t,e),i.lines<this.lines)for(let r=0,n=0;r<this.children.length;r++){let h=this.children[r],l=n+h.length;if(t>=n&&e<=l){let o=h.replace(t-n,e-n,i),f=this.lines-h.lines+o.lines;if(o.lines<f>>4&&o.lines>f>>6){let n=this.children.slice();return n[r]=o,new s(n,this.length-(e-t)+i.length)}return super.replace(n,l,o)}n=l+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i="\n"){[t,e]=u(this,t,e);let s="";for(let r=0,n=0;r<this.children.length&&n<=e;r++){let h=this.children[r],l=n+h.length;n>t&&r&&(s+=i),t<l&&e>n&&(s+=h.sliceString(t-n,e-n,i)),n=l+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof s))return 0;let i=0,[r,n,h,l]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;r+=e,n+=e){if(r==h||n==l)return i;let s=this.children[r],o=t.children[n];if(s!=o)return i+s.scanIdentical(o,e);i+=s.length+1}}static from(t,e=t.reduce((t,e)=>t+e.length+1,-1)){let r=0;for(let i of t)r+=i.lines;if(r<32){let s=[];for(let e of t)e.flatten(s);return new i(s,e)}let n=Math.max(32,r>>5),h=n<<1,l=n>>1,o=[],f=0,u=-1,a=[];function c(t){let e;if(t.lines>h&&t instanceof s)for(let i of t.children)c(i);else t.lines>l&&(f>l||!f)?(w(),o.push(t)):t instanceof i&&f&&(e=a[a.length-1])instanceof i&&t.lines+e.lines<=32?(f+=t.lines,u+=t.length+1,a[a.length-1]=new i(e.text.concat(t.text),e.length+1+t.length)):(f+t.lines>n&&w(),f+=t.lines,u+=t.length+1,a.push(t))}function w(){0!=f&&(o.push(1==a.length?a[0]:s.from(a,u)),u=-1,f=a.length=0)}for(let i of t)c(i);return w(),1==o.length?o[0]:new s(o,e)}}function r(t,e,i=0,s=1e9){for(let r=0,n=0,h=!0;n<t.length&&r<=s;n++){let l=t[n],o=r+l.length;o>=i&&(o>s&&(l=l.slice(0,s-r)),r<i&&(l=l.slice(i-r)),h?(e[e.length-1]+=l,h=!1):e.push(l)),r=o+1}return e}function n(t,e,i){return r(t,[""],e,i)}e.empty=new i([""],0);class h{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof i?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let s=this.nodes.length-1,r=this.nodes[s],n=this.offsets[s],h=n>>1,l=r instanceof i?r.text.length:r.children.length;if(h==(e>0?l:0)){if(0==s)return this.done=!0,this.value="",this;e>0&&this.offsets[s-1]++,this.nodes.pop(),this.offsets.pop()}else if((1&n)==(e>0?0:1)){if(this.offsets[s]+=e,0==t)return this.lineBreak=!0,this.value="\n",this;t--}else if(r instanceof i){let i=r.text[h+(e<0?-1:0)];if(this.offsets[s]+=e,i.length>Math.max(0,t))return this.value=0==t?i:e>0?i.slice(t):i.slice(0,i.length-t),this;t-=i.length}else{let n=r.children[h+(e<0?-1:0)];t>n.length?(t-=n.length,this.offsets[s]+=e):(e<0&&this.offsets[s]--,this.nodes.push(n),this.offsets.push(e>0?1:(n instanceof i?n.text.length:n.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class l{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new h(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&""!=this.value}}class o{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}"undefined"!=typeof Symbol&&(e.prototype[Symbol.iterator]=function(){return this.iter()},h.prototype[Symbol.iterator]=l.prototype[Symbol.iterator]=o.prototype[Symbol.iterator]=function(){return this});class f{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}function u(t,e,i){return[e=Math.max(0,Math.min(t.length,e)),Math.max(e,Math.min(t.length,i))]}function a(e,i,s=!0,r=!0){return t(e,i,s,r)}function c(t,e){let i=t.charCodeAt(e);if(!((s=i)>=55296&&s<56320&&e+1!=t.length))return i;var s;let r=t.charCodeAt(e+1);return function(t){return t>=56320&&t<57344}(r)?r-56320+(i-55296<<10)+65536:i}function w(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function g(t){return t<65536?1:2}const d=/\r\n?|\n/;var p=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(p||(p={}));class m{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return 0==this.sections.length||2==this.sections.length&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let r=this.sections[e++],n=this.sections[e++];n<0?(t(i,s,r),s+=r):s+=n,i+=r}}iterChangedRanges(t,e=!1){v(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new m(t)}composeDesc(t){return this.empty?t:t.empty?this:E(this,t)}mapDesc(t,e=!1){return t.empty?this:y(this,t,e)}mapPos(t,e=-1,i=p.Simple){let s=0,r=0;for(let n=0;n<this.sections.length;){let h=this.sections[n++],l=this.sections[n++],o=s+h;if(l<0){if(o>t)return r+(t-s);r+=h}else{if(i!=p.Simple&&o>=t&&(i==p.TrackDel&&s<t&&o>t||i==p.TrackBefore&&s<t||i==p.TrackAfter&&o>t))return null;if(o>t||o==t&&e<0&&!h)return t==s||e<0?r:r+l;r+=l}s=o}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return r}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let r=s+this.sections[i++];if(this.sections[i++]>=0&&s<=e&&r>=t)return!(s<t&&r>e)||"cover";s=r}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(t=>"number"!=typeof t))throw new RangeError("Invalid JSON representation of ChangeDesc");return new m(t)}static create(t){return new m(t)}}class b extends m{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return v(this,(e,i,s,r,n)=>t=t.replace(s,s+(i-e),n),!1),t}mapDesc(t,e=!1){return y(this,t,e,!0)}invert(t){let i=this.sections.slice(),s=[];for(let r=0,n=0;r<i.length;r+=2){let h=i[r],l=i[r+1];if(l>=0){i[r]=l,i[r+1]=h;let o=r>>1;for(;s.length<o;)s.push(e.empty);s.push(h?t.slice(n,n+h):e.empty)}n+=h}return new b(i,s)}compose(t){return this.empty?t:t.empty?this:E(this,t,!0)}map(t,e=!1){return t.empty?this:y(this,t,e,!0)}iterChanges(t,e=!1){v(this,t,e)}get desc(){return m.create(this.sections)}filter(t){let e=[],i=[],s=[],r=new k(this);t:for(let n=0,h=0;;){let l=n==t.length?1e9:t[n++];for(;h<l||h==l&&0==r.len;){if(r.done)break t;let t=Math.min(r.len,l-h);S(s,t,-1);let n=-1==r.ins?-1:0==r.off?r.ins:0;S(e,t,n),n>0&&M(i,e,r.text),r.forward(t),h+=t}let o=t[n++];for(;h<o;){if(r.done)break t;let t=Math.min(r.len,o-h);S(e,t,-1),S(s,t,-1==r.ins?-1:0==r.off?r.ins:0),r.forward(t),h+=t}}return{changes:new b(e,i),filtered:m.create(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):0==s?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,i,s){let r=[],n=[],h=0,l=null;function o(t=!1){if(!t&&!r.length)return;h<i&&S(r,i-h,-1);let e=new b(r,n);l=l?l.compose(e.map(l)):e,r=[],n=[],h=0}return function t(f){if(Array.isArray(f))for(let e of f)t(e);else if(f instanceof b){if(f.length!=i)throw new RangeError(`Mismatched change set length (got ${f.length}, expected ${i})`);o(),l=l?l.compose(f.map(l)):f}else{let{from:t,to:l=t,insert:u}=f;if(t>l||t<0||l>i)throw new RangeError(`Invalid change range ${t} to ${l} (in doc of length ${i})`);let a=u?"string"==typeof u?e.of(u.split(s||d)):u:e.empty,c=a.length;if(t==l&&0==c)return;t<h&&o(),t>h&&S(r,t-h,-1),S(r,l-t,c),M(n,r,a),h=l}}(t),o(!l),l}static empty(t){return new b(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let i=[],s=[];for(let r=0;r<t.length;r++){let n=t[r];if("number"==typeof n)i.push(n,-1);else{if(!Array.isArray(n)||"number"!=typeof n[0]||n.some((t,e)=>e&&"string"!=typeof t))throw new RangeError("Invalid JSON representation of ChangeSet");if(1==n.length)i.push(n[0],0);else{for(;s.length<r;)s.push(e.empty);s[r]=e.of(n.slice(1)),i.push(n[0],s[r].length)}}}return new b(i,s)}static createSet(t,e){return new b(t,e)}}function S(t,e,i,s=!1){if(0==e&&i<=0)return;let r=t.length-2;r>=0&&i<=0&&i==t[r+1]?t[r]+=e:r>=0&&0==e&&0==t[r]?t[r+1]+=i:s?(t[r]+=e,t[r+1]+=i):t.push(e,i)}function M(t,i,s){if(0==s.length)return;let r=i.length-2>>1;if(r<t.length)t[t.length-1]=t[t.length-1].append(s);else{for(;t.length<r;)t.push(e.empty);t.push(s)}}function v(t,i,s){let r=t.inserted;for(let n=0,h=0,l=0;l<t.sections.length;){let o=t.sections[l++],f=t.sections[l++];if(f<0)n+=o,h+=o;else{let u=n,a=h,c=e.empty;for(;u+=o,a+=f,f&&r&&(c=c.append(r[l-2>>1])),!(s||l==t.sections.length||t.sections[l+1]<0);)o=t.sections[l++],f=t.sections[l++];i(n,u,h,a,c),n=u,h=a}}}function y(t,e,i,s=!1){let r=[],n=s?[]:null,h=new k(t),l=new k(e);for(let o=-1;;){if(h.done&&l.len||l.done&&h.len)throw new Error("Mismatched change set lengths");if(-1==h.ins&&-1==l.ins){let t=Math.min(h.len,l.len);S(r,t,-1),h.forward(t),l.forward(t)}else if(l.ins>=0&&(h.ins<0||o==h.i||0==h.off&&(l.len<h.len||l.len==h.len&&!i))){let t=l.len;for(S(r,l.ins,-1);t;){let e=Math.min(h.len,t);h.ins>=0&&o<h.i&&h.len<=e&&(S(r,0,h.ins),n&&M(n,r,h.text),o=h.i),h.forward(e),t-=e}l.next()}else{if(!(h.ins>=0)){if(h.done&&l.done)return n?b.createSet(r,n):m.create(r);throw new Error("Mismatched change set lengths")}{let t=0,e=h.len;for(;e;)if(-1==l.ins){let i=Math.min(e,l.len);t+=i,e-=i,l.forward(i)}else{if(!(0==l.ins&&l.len<e))break;e-=l.len,l.next()}S(r,t,o<h.i?h.ins:0),n&&o<h.i&&M(n,r,h.text),o=h.i,h.forward(h.len-e)}}}}function E(t,e,i=!1){let s=[],r=i?[]:null,n=new k(t),h=new k(e);for(let l=!1;;){if(n.done&&h.done)return r?b.createSet(s,r):m.create(s);if(0==n.ins)S(s,n.len,0,l),n.next();else if(0!=h.len||h.done){if(n.done||h.done)throw new Error("Mismatched change set lengths");{let t=Math.min(n.len2,h.len),e=s.length;if(-1==n.ins){let e=-1==h.ins?-1:h.off?0:h.ins;S(s,t,e,l),r&&e&&M(r,s,h.text)}else-1==h.ins?(S(s,n.off?0:n.len,t,l),r&&M(r,s,n.textBit(t))):(S(s,n.off?0:n.len,h.off?0:h.ins,l),r&&!h.off&&M(r,s,h.text));l=(n.ins>t||h.ins>=0&&h.len>t)&&(l||s.length>e),n.forward2(t),h.forward(t)}}else S(s,0,h.ins,l),r&&M(r,s,h.text),h.next()}}class k{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return-2==this.ins}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length?e.empty:t[i]}textBit(t){let{inserted:i}=this.set,s=this.i-2>>1;return s>=i.length&&!t?e.empty:i[s].slice(this.off,null==t?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){-1==this.ins?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class x{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return 32&this.flags?this.to:this.from}get head(){return 32&this.flags?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return 8&this.flags?-1:16&this.flags?1:0}get bidiLevel(){let t=7&this.flags;return 7==t?null:t}get goalColumn(){let t=this.flags>>6;return 16777215==t?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new x(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return O.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return O.range(this.anchor,i)}eq(t,e=!1){return!(this.anchor!=t.anchor||this.head!=t.head||e&&this.empty&&this.assoc!=t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||"number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid JSON representation for SelectionRange");return O.range(t.anchor,t.head)}static create(t,e,i){return new x(t,e,i)}}class O{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:O.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(t.ranges[i],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return 1==this.ranges.length?this:new O([this.main],0)}addRange(t,e=!0){return O.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,O.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||"number"!=typeof t.main||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new O(t.ranges.map(t=>x.fromJSON(t)),t.main)}static single(t,e=t){return new O([O.range(t,e)],0)}static create(t,e=0){if(0==t.length)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let r=t[s];if(r.empty?r.from<=i:r.from<i)return O.normalized(t.slice(),e);i=r.to}return new O(t,e)}static cursor(t,e=0,i,s){return x.create(t,t,(0==e?0:e<0?8:16)|(null==i?7:Math.min(6,i))|(null!=s?s:16777215)<<6)}static range(t,e,i,s){let r=(null!=i?i:16777215)<<6|(null==s?7:Math.min(6,s));return e<t?x.create(e,t,48|r):x.create(t,e,(e>t?8:0)|r)}static normalized(t,e=0){let i=t[e];t.sort((t,e)=>t.from-e.from),e=t.indexOf(i);for(let s=1;s<t.length;s++){let i=t[s],r=t[s-1];if(i.empty?i.from<=r.to:i.from<r.to){let n=r.from,h=Math.max(i.to,r.to);s<=e&&e--,t.splice(--s,2,i.anchor>i.head?O.range(h,n):O.range(n,h))}}return new O(t,e)}}function R(t,e){for(let i of t.ranges)if(i.to>e)throw new RangeError("Selection points outside of document")}let I=0;class A{constructor(t,e,i,s,r){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.id=I++,this.default=t([]),this.extensions="function"==typeof r?r(this):r}get reader(){return this}static define(t={}){return new A(t.combine||(t=>t),t.compareInput||((t,e)=>t===e),t.compare||(t.combine?(t,e)=>t===e:N),!!t.static,t.enables)}of(t){return new C([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new C(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new C(t,this,2,e)}from(t,e){return e||(e=t=>t),this.compute([t],i=>e(i.field(t)))}}function N(t,e){return t==e||t.length==e.length&&t.every((t,i)=>t===e[i])}class C{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=I++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,r=this.id,n=t[r]>>1,h=2==this.type,l=!1,o=!1,f=[];for(let u of this.dependencies)"doc"==u?l=!0:"selection"==u?o=!0:1&(null!==(e=t[u.id])&&void 0!==e?e:1)||f.push(t[u.id]);return{create:t=>(t.values[n]=i(t),1),update(t,e){if(l&&e.docChanged||o&&(e.docChanged||e.selection)||$(t,f)){let e=i(t);if(h?!J(e,t.values[n],s):!s(e,t.values[n]))return t.values[n]=e,1}return 0},reconfigure:(t,e)=>{let l,o=e.config.address[r];if(null!=o){let r=V(e,o);if(this.dependencies.every(i=>i instanceof A?e.facet(i)===t.facet(i):!(i instanceof T)||e.field(i,!1)==t.field(i,!1))||(h?J(l=i(t),r,s):s(l=i(t),r)))return t.values[n]=r,0}else l=i(t);return t.values[n]=l,1}}}}function J(t,e,i){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],e[s]))return!1;return!0}function $(t,e){let i=!1;for(let s of e)1&U(t,s)&&(i=!0);return i}function j(t,e,i){let s=i.map(e=>t[e.id]),r=i.map(t=>t.type),n=s.filter(t=>!(1&t)),h=t[e.id]>>1;function l(t){let i=[];for(let e=0;e<s.length;e++){let n=V(t,s[e]);if(2==r[e])for(let t of n)i.push(t);else i.push(n)}return e.combine(i)}return{create(t){for(let e of s)U(t,e);return t.values[h]=l(t),1},update(t,i){if(!$(t,n))return 0;let s=l(t);return e.compare(s,t.values[h])?0:(t.values[h]=s,1)},reconfigure(t,r){let n=$(t,s),o=r.config.facets[e.id],f=r.facet(e);if(o&&!n&&N(i,o))return t.values[h]=f,0;let u=l(t);return e.compare(u,f)?(t.values[h]=f,0):(t.values[h]=u,1)}}}const D=A.define({static:!0});class T{constructor(t,e,i,s,r){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=r,this.provides=void 0}static define(t){let e=new T(I++,t.create,t.update,t.compare||((t,e)=>t===e),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(D).find(t=>t.field==this);return((null==e?void 0:e.create)||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:t=>(t.values[e]=this.create(t),1),update:(t,i)=>{let s=t.values[e],r=this.updateF(s,i);return this.compareF(s,r)?0:(t.values[e]=r,1)},reconfigure:(t,i)=>{let s,r=t.facet(D),n=i.facet(D);return(s=r.find(t=>t.field==this))&&s!=n.find(t=>t.field==this)?(t.values[e]=s.create(t),1):null!=i.config.address[this.id]?(t.values[e]=i.field(this),0):(t.values[e]=this.create(t),1)}}}init(t){return[this,D.of({field:this,create:t})]}get extension(){return this}}function B(t){return e=>new q(e,t)}const F={highest:B(0),high:B(1),default:B(2),low:B(3),lowest:B(4)};class q{constructor(t,e){this.inner=t,this.prec=e}}class z{of(t){return new P(this,t)}reconfigure(t){return z.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class P{constructor(t,e){this.compartment=t,this.inner=e}}class L{constructor(t,e,i,s,r,n){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=r,this.facets=n,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return null==e?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],r=Object.create(null),n=new Map;for(let a of function(t,e,i){let s=[[],[],[],[],[]],r=new Map;return function t(n,h){let l=r.get(n);if(null!=l){if(l<=h)return;let t=s[l].indexOf(n);t>-1&&s[l].splice(t,1),n instanceof P&&i.delete(n.compartment)}if(r.set(n,h),Array.isArray(n))for(let e of n)t(e,h);else if(n instanceof P){if(i.has(n.compartment))throw new RangeError("Duplicate use of compartment in extensions");let s=e.get(n.compartment)||n.inner;i.set(n.compartment,s),t(s,h)}else if(n instanceof q)t(n.inner,n.prec);else if(n instanceof T)s[h].push(n),n.provides&&t(n.provides,h);else if(n instanceof C)s[h].push(n),n.facet.extensions&&t(n.facet.extensions,2);else{let e=n.extension;if(!e)throw new Error(`Unrecognized extension value in extension set (${n}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);t(e,h)}}(t,2),s.reduce((t,e)=>t.concat(e))}(t,e,n))a instanceof T?s.push(a):(r[a.facet.id]||(r[a.facet.id]=[])).push(a);let h=Object.create(null),l=[],o=[];for(let a of s)h[a.id]=o.length<<1,o.push(t=>a.slot(t));let f=null==i?void 0:i.config.facets;for(let a in r){let t=r[a],e=t[0].facet,s=f&&f[a]||[];if(t.every(t=>0==t.type))if(h[e.id]=l.length<<1|1,N(s,t))l.push(i.facet(e));else{let s=e.combine(t.map(t=>t.value));l.push(i&&e.compare(s,i.facet(e))?i.facet(e):s)}else{for(let e of t)0==e.type?(h[e.id]=l.length<<1|1,l.push(e.value)):(h[e.id]=o.length<<1,o.push(t=>e.dynamicSlot(t)));h[e.id]=o.length<<1,o.push(i=>j(i,e,t))}}let u=o.map(t=>t(h));return new L(t,n,u,h,l,r)}}function U(t,e){if(1&e)return 2;let i=e>>1,s=t.status[i];if(4==s)throw new Error("Cyclic dependency between fields and/or facets");if(2&s)return s;t.status[i]=4;let r=t.computeSlot(t,t.config.dynamicSlots[i]);return t.status[i]=2|r}function V(t,e){return 1&e?t.config.staticValues[e>>1]:t.values[e>>1]}const G=A.define(),W=A.define({combine:t=>t.some(t=>t),static:!0}),_=A.define({combine:t=>t.length?t[0]:void 0,static:!0}),H=A.define(),K=A.define(),Q=A.define(),X=A.define({combine:t=>!!t.length&&t[0]});class Y{constructor(t,e){this.type=t,this.value=e}static define(){return new Z}}class Z{of(t){return new Y(this,t)}}class tt{constructor(t){this.map=t}of(t){return new et(this,t)}}class et{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return void 0===e?void 0:e==this.value?this:new et(this.type,e)}is(t){return this.type==t}static define(t={}){return new tt(t.map||(t=>t))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let t=s.map(e);t&&i.push(t)}return i}}et.reconfigure=et.define(),et.appendConfig=et.define();class it{constructor(t,e,i,s,r,n){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=r,this.scrollIntoView=n,this.t=null,this.h=null,i&&R(i,e.newLength),r.some(t=>t.type==it.time)||(this.annotations=r.concat(it.time.of(Date.now())))}static create(t,e,i,s,r,n){return new it(t,e,i,s,r,n)}get newDoc(){return this.t||(this.t=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this.h||this.startState.applyTransaction(this),this.h}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(it.userEvent);return!(!e||!(e==t||e.length>t.length&&e.slice(0,t.length)==t&&"."==e[t.length]))}}function st(t,e){let i=[];for(let s=0,r=0;;){let n,h;if(s<t.length&&(r==e.length||e[r]>=t[s]))n=t[s++],h=t[s++];else{if(!(r<e.length))return i;n=e[r++],h=e[r++]}!i.length||i[i.length-1]<n?i.push(n,h):i[i.length-1]<h&&(i[i.length-1]=h)}}function rt(t,e,i){var s;let r,n,h;return i?(r=e.changes,n=b.empty(e.changes.length),h=t.changes.compose(e.changes)):(r=e.changes.map(t.changes),n=t.changes.mapDesc(e.changes,!0),h=t.changes.compose(r)),{changes:h,selection:e.selection?e.selection.map(n):null===(s=t.selection)||void 0===s?void 0:s.map(r),effects:et.mapEffects(t.effects,r).concat(et.mapEffects(e.effects,n)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function nt(t,e,i){let s=e.selection,r=ot(e.annotations);return e.userEvent&&(r=r.concat(it.userEvent.of(e.userEvent))),{changes:e.changes instanceof b?e.changes:b.of(e.changes||[],i,t.facet(_)),selection:s&&(s instanceof O?s:O.single(s.anchor,s.head)),effects:ot(e.effects),annotations:r,scrollIntoView:!!e.scrollIntoView}}function ht(t,e,i){let s=nt(t,e.length?e[0]:{},t.doc.length);e.length&&!1===e[0].filter&&(i=!1);for(let n=1;n<e.length;n++){!1===e[n].filter&&(i=!1);let r=!!e[n].sequential;s=rt(s,nt(t,e[n],r?s.changes.newLength:t.doc.length),r)}let r=it.create(t,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return function(t){let e=t.startState,i=e.facet(Q),s=t;for(let r=i.length-1;r>=0;r--){let n=i[r](t);n&&Object.keys(n).length&&(s=rt(s,nt(e,n,t.changes.newLength),!0))}return s==t?t:it.create(e,t.changes,t.selection,s.effects,s.annotations,s.scrollIntoView)}(i?function(t){let e=t.startState,i=!0;for(let r of e.facet(H)){let e=r(t);if(!1===e){i=!1;break}Array.isArray(e)&&(i=!0===i?e:st(i,e))}if(!0!==i){let s,r;if(!1===i)r=t.changes.invertedDesc,s=b.empty(e.doc.length);else{let e=t.changes.filter(i);s=e.changes,r=e.filtered.mapDesc(e.changes).invertedDesc}t=it.create(e,s,t.selection&&t.selection.map(r),et.mapEffects(t.effects,r),t.annotations,t.scrollIntoView)}let s=e.facet(K);for(let r=s.length-1;r>=0;r--){let i=s[r](t);t=i instanceof it?i:Array.isArray(i)&&1==i.length&&i[0]instanceof it?i[0]:ht(e,ot(i),!1)}return t}(r):r)}it.time=Y.define(),it.userEvent=Y.define(),it.addToHistory=Y.define(),it.remote=Y.define();const lt=[];function ot(t){return null==t?lt:Array.isArray(t)?t:[t]}var ft=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(ft||(ft={}));const ut=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let at;try{at=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(Jt){}class ct{constructor(t,e,i,s,r,n){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=r,n&&(n.h=this);for(let h=0;h<this.config.dynamicSlots.length;h++)U(this,h<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(null!=i)return U(this,i),V(this,i);if(e)throw new RangeError("Field is not present in this state")}update(...t){return ht(this,t,!0)}applyTransaction(t){let e,i=this.config,{base:s,compartments:r}=i;for(let h of t.effects)h.is(z.reconfigure)?(i&&(r=new Map,i.compartments.forEach((t,e)=>r.set(e,t)),i=null),r.set(h.value.compartment,h.value.extension)):h.is(et.reconfigure)?(i=null,s=h.value):h.is(et.appendConfig)&&(i=null,s=ot(s).concat(h.value));i?e=t.startState.values.slice():(i=L.resolve(s,r,this),e=new ct(i,this.doc,this.selection,i.dynamicSlots.map(()=>null),(t,e)=>e.reconfigure(t,this),null).values);let n=t.startState.facet(W)?t.newSelection:t.newSelection.asSingle();new ct(i,t.newDoc,n,e,(e,i)=>i.update(e,t),t)}replaceSelection(t){return"string"==typeof t&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:O.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),r=[i.range],n=ot(i.effects);for(let h=1;h<e.ranges.length;h++){let i=t(e.ranges[h]),l=this.changes(i.changes),o=l.map(s);for(let t=0;t<h;t++)r[t]=r[t].map(o);let f=s.mapDesc(l,!0);r.push(i.range.map(f)),s=s.compose(o),n=et.mapEffects(n,o).concat(et.mapEffects(ot(i.effects),f))}return{changes:s,selection:O.create(r,e.mainIndex),effects:n}}changes(t=[]){return t instanceof b?t:b.of(t,this.doc.length,this.facet(ct.lineSeparator))}toText(t){return e.of(t.split(this.facet(ct.lineSeparator)||d))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return null==e?t.default:(U(this,e),V(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof T&&null!=this.config.address[s.id]&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||"string"!=typeof t.doc)throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i)for(let r in i)if(Object.prototype.hasOwnProperty.call(t,r)){let e=i[r],n=t[r];s.push(e.init(t=>e.spec.fromJSON(n,t)))}return ct.create({doc:t.doc,selection:O.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let i=L.resolve(t.extensions||[],new Map),s=t.doc instanceof e?t.doc:e.of((t.doc||"").split(i.staticFacet(ct.lineSeparator)||d)),r=t.selection?t.selection instanceof O?t.selection:O.single(t.selection.anchor,t.selection.head):O.single(0);return R(r,s.length),i.staticFacet(W)||(r=r.asSingle()),new ct(i,s,r,i.dynamicSlots.map(()=>null),(t,e)=>e.create(t),null)}get tabSize(){return this.facet(ct.tabSize)}get lineBreak(){return this.facet(ct.lineSeparator)||"\n"}get readOnly(){return this.facet(X)}phrase(t,...e){for(let i of this.facet(ct.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(t,i)=>{if("$"==i)return"$";let s=+(i||1);return!s||s>e.length?t:e[s-1]})),t}languageDataAt(t,e,i=-1){let s=[];for(let r of this.facet(G))for(let n of r(this,e,i))Object.prototype.hasOwnProperty.call(n,t)&&s.push(n[t]);return s}charCategorizer(t){return e=this.languageDataAt("wordChars",t).join(""),t=>{if(!/\S/.test(t))return ft.Space;if(function(t){if(at)return at.test(t);for(let e=0;e<t.length;e++){let i=t[e];if(/\w/.test(i)||i>""&&(i.toUpperCase()!=i.toLowerCase()||ut.test(i)))return!0}return!1}(t))return ft.Word;for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return ft.Word;return ft.Other};var e}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),r=this.charCategorizer(t),n=t-i,h=t-i;for(;n>0;){let t=a(e,n,!1);if(r(e.slice(t,n))!=ft.Word)break;n=t}for(;h<s;){let t=a(e,h);if(r(e.slice(h,t))!=ft.Word)break;h=t}return n==h?null:O.range(n+i,h+i)}}function wt(t,e,i={}){let s={};for(let r of t)for(let t of Object.keys(r)){let e=r[t],n=s[t];if(void 0===n)s[t]=e;else if(n===e||void 0===e);else{if(!Object.hasOwnProperty.call(i,t))throw new Error("Config merge conflict for field "+t);s[t]=i[t](n,e)}}for(let r in e)void 0===s[r]&&(s[r]=e[r]);return s}ct.allowMultipleSelections=W,ct.tabSize=A.define({combine:t=>t.length?t[0]:4}),ct.lineSeparator=_,ct.readOnly=X,ct.phrases=A.define({compare(t,e){let i=Object.keys(t),s=Object.keys(e);return i.length==s.length&&i.every(i=>t[i]==e[i])}}),ct.languageData=G,ct.changeFilter=H,ct.transactionFilter=K,ct.transactionExtender=Q,z.reconfigure=et.define();class gt{eq(t){return this==t}range(t,e=t){return dt.create(t,e,this)}}gt.prototype.startSide=gt.prototype.endSide=0,gt.prototype.point=!1,gt.prototype.mapMode=p.TrackDel;class dt{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new dt(t,e,i)}}function pt(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class mt{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let r=i?this.to:this.from;for(let n=s,h=r.length;;){if(n==h)return n;let s=n+h>>1,l=r[s]-t||(i?this.value[s].endSide:this.value[s].startSide)-e;if(s==n)return l>=0?n:h;l>=0?h=s:n=s+1}}between(t,e,i,s){for(let r=this.findIndex(e,-1e9,!0),n=this.findIndex(i,1e9,!1,r);r<n;r++)if(!1===s(this.from[r]+t,this.to[r]+t,this.value[r]))return!1}map(t,e){let i=[],s=[],r=[],n=-1,h=-1;for(let l=0;l<this.value.length;l++){let o,f,u=this.value[l],a=this.from[l]+t,c=this.to[l]+t;if(a==c){let t=e.mapPos(a,u.startSide,u.mapMode);if(null==t)continue;if(o=f=t,u.startSide!=u.endSide&&(f=e.mapPos(a,u.endSide),f<o))continue}else if(o=e.mapPos(a,u.startSide),f=e.mapPos(c,u.endSide),o>f||o==f&&u.startSide>0&&u.endSide<=0)continue;(f-o||u.endSide-u.startSide)<0||(n<0&&(n=o),u.point&&(h=Math.max(h,f-o)),i.push(u),s.push(o-n),r.push(f-n))}return{mapped:i.length?new mt(s,r,i,h):null,pos:n}}}class bt{constructor(t,e,i,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}static create(t,e,i,s){return new bt(t,e,i,s)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:r=this.length}=t,n=t.filter;if(0==e.length&&!n)return this;if(i&&(e=e.slice().sort(pt)),this.isEmpty)return e.length?bt.of(e):this;let h=new vt(this,null,-1).goto(0),l=0,o=[],f=new St;for(;h.value||l<e.length;)if(l<e.length&&(h.from-e[l].from||h.startSide-e[l].value.startSide)>=0){let t=e[l++];f.addInner(t.from,t.to,t.value)||o.push(t)}else 1==h.rangeIndex&&h.chunkIndex<this.chunk.length&&(l==e.length||this.chunkEnd(h.chunkIndex)<e[l].from)&&(!n||s>this.chunkEnd(h.chunkIndex)||r<this.chunkPos[h.chunkIndex])&&f.addChunk(this.chunkPos[h.chunkIndex],this.chunk[h.chunkIndex])?h.nextChunk():((!n||s>h.to||r<h.from||n(h.from,h.to,h.value))&&(f.addInner(h.from,h.to,h.value)||o.push(dt.create(h.from,h.to,h.value))),h.next());return f.finishInner(this.nextLayer.isEmpty&&!o.length?bt.empty:this.nextLayer.update({add:o,filter:n,filterFrom:s,filterTo:r}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],h=this.chunk[n],l=t.touchesRange(r,r+h.length);if(!1===l)s=Math.max(s,h.maxPoint),e.push(h),i.push(t.mapPos(r));else if(!0===l){let{mapped:n,pos:l}=h.map(r,t);n&&(s=Math.max(s,n.maxPoint),e.push(n),i.push(l))}}let r=this.nextLayer.map(t);return 0==e.length?r:new bt(i,e,r||bt.empty,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],n=this.chunk[s];if(e>=r&&t<=r+n.length&&!1===n.between(r,t-r,e-r,i))return}this.nextLayer.between(t,e,i)}}iter(t=0){return yt.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return yt.from(t).goto(e)}static compare(t,e,i,s,r=-1){let n=t.filter(t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=r),h=e.filter(t=>t.maxPoint>0||!t.isEmpty&&t.maxPoint>=r),l=Mt(n,h,i),o=new kt(n,l,r),f=new kt(h,l,r);i.iterGaps((t,e,i)=>xt(o,t,f,e,i,s)),i.empty&&0==i.length&&xt(o,0,f,0,0,s)}static eq(t,e,i=0,s){null==s&&(s=999999999);let r=t.filter(t=>!t.isEmpty&&e.indexOf(t)<0),n=e.filter(e=>!e.isEmpty&&t.indexOf(e)<0);if(r.length!=n.length)return!1;if(!r.length)return!0;let h=Mt(r,n),l=new kt(r,h,0).goto(i),o=new kt(n,h,0).goto(i);for(;;){if(l.to!=o.to||!Ot(l.active,o.active)||l.point&&(!o.point||!l.point.eq(o.point)))return!1;if(l.to>s)return!0;l.next(),o.next()}}static spans(t,e,i,s,r=-1){let n=new kt(t,null,r).goto(e),h=e,l=n.openStart;for(;;){let t=Math.min(n.to,i);if(n.point){let i=n.activeForPoint(n.to),r=n.pointFrom<e?i.length+1:n.point.startSide<0?i.length:Math.min(i.length,l);s.point(h,t,n.point,i,r,n.pointRank),l=Math.min(n.openEnd(t),i.length)}else t>h&&(s.span(h,t,n.active,l),l=n.openEnd(t));if(n.to>i)return l+(n.point&&n.to>i?1:0);h=n.to,n.next()}}static of(t,e=!1){let i=new St;for(let s of t instanceof dt?[t]:e?function(t){if(t.length>1)for(let e=t[0],i=1;i<t.length;i++){let s=t[i];if(pt(e,s)>0)return t.slice().sort(pt);e=s}return t}(t):t)i.add(s.from,s.to,s.value);return i.finish()}static join(t){if(!t.length)return bt.empty;let e=t[t.length-1];for(let i=t.length-2;i>=0;i--)for(let s=t[i];s!=bt.empty;s=s.nextLayer)e=new bt(s.chunkPos,s.chunk,e,Math.max(s.maxPoint,e.maxPoint));return e}}bt.empty=new bt([],[],null,-1),bt.empty.nextLayer=bt.empty;class St{finishChunk(t){this.chunks.push(new mt(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new St)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return!(s<0||(250==this.from.length&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),0))}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(bt.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),0==this.chunks.length)return t;let e=bt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Mt(t,e,i){let s=new Map;for(let n of t)for(let t=0;t<n.chunk.length;t++)n.chunk[t].maxPoint<=0&&s.set(n.chunk[t],n.chunkPos[t]);let r=new Set;for(let n of e)for(let t=0;t<n.chunk.length;t++){let e=s.get(n.chunk[t]);null==e||(i?i.mapPos(e):e)!=n.chunkPos[t]||(null==i?void 0:i.touchesRange(e,e+n.chunk[t].length))||r.add(n.chunk[t])}return r}class vt{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let e=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(e)||this.layer.chunkEnd(this.chunkIndex)<t||e.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class yt{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let r=0;r<t.length;r++)for(let n=t[r];!n.isEmpty;n=n.nextLayer)n.maxPoint>=i&&s.push(new vt(n,e,i,r));return 1==s.length?s[0]:new yt(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)Et(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)Et(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(0==this.heap.length)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),Et(this.heap,0)}}}function Et(t,e){for(let i=t[e];;){let s=1+(e<<1);if(s>=t.length)break;let r=t[s];if(s+1<t.length&&r.compare(t[s+1])>=0&&(r=t[s+1],s++),i.compare(r)<0)break;t[s]=i,t[e]=r,e=s}}class kt{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=yt.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){Rt(this.active,t),Rt(this.activeTo,t),Rt(this.activeRank,t),this.minActive=At(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:r}=this.cursor;for(;e<this.activeRank.length&&(r-this.activeRank[e]||s-this.activeTo[e])>0;)e++;It(this.active,e,i),It(this.activeTo,e,s),It(this.activeRank,e,r),t&&It(t,e,this.cursor.from),this.minActive=At(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&Rt(i,s)}else{if(!this.cursor.value){this.to=this.endSide=1e9;break}if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}{let t=this.cursor.value;if(t.point){if(!(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)){this.point=t,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=t.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}this.cursor.next()}else this.addActive(i),this.cursor.next()}}}if(i){this.openStart=0;for(let e=i.length-1;e>=0&&i[e]<t;e--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function xt(t,e,i,s,r,n){t.goto(e),i.goto(s);let h=s+r,l=s,o=s-e;for(;;){let e=t.to+o-i.to,s=e||t.endSide-i.endSide,r=s<0?t.to+o:i.to,f=Math.min(r,h);if(t.point||i.point?t.point&&i.point&&(t.point==i.point||t.point.eq(i.point))&&Ot(t.activeForPoint(t.to),i.activeForPoint(i.to))||n.comparePoint(l,f,t.point,i.point):f>l&&!Ot(t.active,i.active)&&n.compareRange(l,f,t.active,i.active),r>h)break;(e||t.openEnd!=i.openEnd)&&n.boundChange&&n.boundChange(r),l=r,s<=0&&t.next(),s>=0&&i.next()}}function Ot(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!=e[i]&&!t[i].eq(e[i]))return!1;return!0}function Rt(t,e){for(let i=e,s=t.length-1;i<s;i++)t[i]=t[i+1];t.pop()}function It(t,e,i){for(let s=t.length-1;s>=e;s--)t[s+1]=t[s];t[e]=i}function At(t,e){let i=-1,s=1e9;for(let r=0;r<e.length;r++)(e[r]-s||t[r].endSide-t[i].endSide)<0&&(i=r,s=e[r]);return i}function Nt(t,e,i=t.length){let s=0;for(let r=0;r<i&&r<t.length;)9==t.charCodeAt(r)?(s+=e-s%e,r++):(s++,r=a(t,r));return s}function Ct(t,e,i,s){for(let r=0,n=0;;){if(n>=e)return r;if(r==t.length)break;n+=9==t.charCodeAt(r)?i-n%i:1,r=a(t,r)}return t.length}export{Y as A,b as C,O as E,A as F,p as M,F as P,gt as R,T as S,it as T,et as a,e as b,wt as c,c as d,g as e,w as f,Nt as g,a as h,m as i,ct as j,St as k,ft as l,bt as m,Ct as n,z as o};
