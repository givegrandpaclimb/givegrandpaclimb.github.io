import{g as t}from"./vendor-smithy-util-middleware-CiYOBhdT.js";import{a as e}from"./vendor-smithy-protocol-http-BM_qqgGS.js";import{U as r}from"./vendor-smithy-util-stream-qKluyzXl.js";const s={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},n=(e,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:n})=>({applyToStack:i=>{i.addRelativeTo(((e,r)=>(s,n)=>async i=>{const o=((t,e)=>{if(!e||0===e.length)return t;const r=[];for(const s of e)for(const e of t)e.schemeId.split("#")[1]===s&&r.push(e);for(const s of t)r.find(({schemeId:t})=>t===s.schemeId)||r.push(s);return r})(e.httpAuthSchemeProvider(await r.httpAuthSchemeParametersProvider(e,n,i.input)),e.authSchemePreference?await e.authSchemePreference():[]),a=function(t){const e=new Map;for(const r of t)e.set(r.schemeId,r);return e}(e.httpAuthSchemes),h=t(n),c=[];for(const t of o){const s=a.get(t.schemeId);if(!s){c.push(`HttpAuthScheme \`${t.schemeId}\` was not enabled for this service.`);continue}const i=s.identityProvider(await r.identityProviderConfigProvider(e));if(!i){c.push(`HttpAuthScheme \`${t.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:o={},signingProperties:u={}}=t.propertiesExtractor?.(e,n)||{};t.identityProperties=Object.assign(t.identityProperties||{},o),t.signingProperties=Object.assign(t.signingProperties||{},u),h.selectedHttpAuthScheme={httpAuthOption:t,identity:await i(t.identityProperties),signer:s.signer};break}if(!h.selectedHttpAuthScheme)throw new Error(c.join("\n"));return s(i)})(e,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:n}),s)}}),i=t=>t=>{throw t},o=(t,e)=>{},a={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},h=r=>({applyToStack:r=>{r.addRelativeTo((r,s)=>async n=>{if(!e.isInstance(n.request))return r(n);const a=t(s).selectedHttpAuthScheme;if(!a)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:h={}},identity:c,signer:u}=a,m=await r({...n,request:await u.sign(n.request,c,h)}).catch((u.errorHandler||i)(h));return(u.successHandler||o)(m.response,h),m},a)}}),c=t=>{if("function"==typeof t)return t;const e=Promise.resolve(t);return()=>e},u=async(t=new Uint8Array,e)=>{if(t instanceof Uint8Array)return r.mutate(t);if(!t)return r.mutate(new Uint8Array);const s=e.streamCollector(t);return r.mutate(await s)};function m(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}const f=t=>"function"==typeof t?t():t;class d{constructor(t,e=new Map){this.namespace=t,this.schemas=e}static for(t){return d.registries.has(t)||d.registries.set(t,new d(t)),d.registries.get(t)}register(t,e){const r=this.normalizeShapeId(t);d.for(this.getNamespace(t)).schemas.set(r,e)}getSchema(t){const e=this.normalizeShapeId(t);if(!this.schemas.has(e))throw new Error(`@smithy/core/schema - schema not found for ${e}`);return this.schemas.get(e)}getBaseException(){for(const[t,e]of this.schemas.entries())if(t.startsWith("smithy.ts.sdk.synthetic.")&&t.endsWith("ServiceException"))return e}find(t){return[...this.schemas.values()].find(t)}destroy(){d.registries.delete(this.namespace),this.schemas.clear()}normalizeShapeId(t){return t.includes("#")?t:this.namespace+"#"+t}getNamespace(t){return this.normalizeShapeId(t).split("#")[0]}}d.registries=new Map;class p{static assign(t,e){const r=Object.assign(t,e);return d.for(r.namespace).register(r.name,r),r}static[Symbol.hasInstance](t){const e=this.prototype.isPrototypeOf(t);return e||"object"!=typeof t||null===t?e:t.symbol===this.symbol}getName(){return this.namespace+"#"+this.name}}class l extends p{constructor(){super(...arguments),this.symbol=l.symbol}}l.symbol=Symbol.for("@smithy/lis");class y extends p{constructor(){super(...arguments),this.symbol=y.symbol}}y.symbol=Symbol.for("@smithy/map");class w extends p{constructor(){super(...arguments),this.symbol=w.symbol}}w.symbol=Symbol.for("@smithy/str");const b={BLOB:21,STREAMING_BLOB:42,BOOLEAN:2,STRING:0,NUMERIC:1,BIG_INTEGER:17,BIG_DECIMAL:19,DOCUMENT:15,TIMESTAMP_DEFAULT:4,TIMESTAMP_DATE_TIME:5,TIMESTAMP_HTTP_DATE:6,TIMESTAMP_EPOCH_SECONDS:7,LIST_MODIFIER:64,MAP_MODIFIER:128};class g extends p{constructor(){super(...arguments),this.symbol=g.symbol}}g.symbol=Symbol.for("@smithy/sim");class S{constructor(t,e){this.ref=t,this.memberName=e,this.symbol=S.symbol;const r=[];let s=t,n=t;for(this.t=!1;Array.isArray(s);)r.push(s[1]),s=s[0],n=f(s),this.t=!0;if(r.length>0){this.memberTraits={};for(let t=r.length-1;t>=0;--t){const e=r[t];Object.assign(this.memberTraits,S.translateTraits(e))}}else this.memberTraits=0;if(n instanceof S)return Object.assign(this,n),this.memberTraits=Object.assign({},n.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,void(this.memberName=e??n.memberName);if(this.schema=f(n),this.schema&&"object"==typeof this.schema?this.traits=this.schema?.traits??{}:this.traits=0,this.name=(this.schema instanceof p?this.schema.getName?.():void 0)??this.memberName??this.getSchemaName(),this.t&&!e)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](t){return p[Symbol.hasInstance].bind(this)(t)}static of(t){if(t instanceof S)return t;if(Array.isArray(t)){const[e,r]=t;if(e instanceof S)return Object.assign(e.getMergedTraits(),S.translateTraits(r)),e;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(t,null,2)}.`)}return new S(t)}static translateTraits(t){if("object"==typeof t)return t;t|=0;const e={};let r=0;for(const s of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])1==(t>>r++&1)&&(e[s]=1);return e}getSchema(){return this.schema instanceof S?(Object.assign(this,{schema:this.schema.getSchema()}),this.schema):this.schema instanceof g?f(this.schema.schemaRef):f(this.schema)}getName(t=!1){return!t&&this.name&&this.name.includes("#")?this.name.split("#")[1]:this.name||void 0}getMemberName(){if(!this.isMemberSchema())throw new Error(`@smithy/core/schema - non-member schema: ${this.getName(!0)}`);return this.memberName}isMemberSchema(){return this.t}isUnitSchema(){return"unit"===this.getSchema()}isListSchema(){const t=this.getSchema();return"number"==typeof t?t>=b.LIST_MODIFIER&&t<b.MAP_MODIFIER:t instanceof l}isMapSchema(){const t=this.getSchema();return"number"==typeof t?t>=b.MAP_MODIFIER&&t<=255:t instanceof y}isStructSchema(){const t=this.getSchema();return null!==t&&"object"==typeof t&&"members"in t||t instanceof w}isBlobSchema(){return this.getSchema()===b.BLOB||this.getSchema()===b.STREAMING_BLOB}isTimestampSchema(){const t=this.getSchema();return"number"==typeof t&&t>=b.TIMESTAMP_DEFAULT&&t<=b.TIMESTAMP_EPOCH_SECONDS}isDocumentSchema(){return this.getSchema()===b.DOCUMENT}isStringSchema(){return this.getSchema()===b.STRING}isBooleanSchema(){return this.getSchema()===b.BOOLEAN}isNumericSchema(){return this.getSchema()===b.NUMERIC}isBigIntegerSchema(){return this.getSchema()===b.BIG_INTEGER}isBigDecimalSchema(){return this.getSchema()===b.BIG_DECIMAL}isStreaming(){return!!this.getMergedTraits().streaming||this.getSchema()===b.STREAMING_BLOB}isIdempotencyToken(){return"number"==typeof this.traits?!(4&~this.traits):"object"==typeof this.traits&&!!this.traits.idempotencyToken}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return S.translateTraits(this.memberTraits)}getOwnTraits(){return S.translateTraits(this.traits)}getKeySchema(){if(this.isDocumentSchema())return this.memberFrom([b.DOCUMENT,0],"key");if(!this.isMapSchema())throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const t=this.getSchema();return"number"==typeof t?this.memberFrom([63&t,0],"key"):this.memberFrom([t.keySchema,0],"key")}getValueSchema(){const t=this.getSchema();if("number"==typeof t){if(this.isMapSchema())return this.memberFrom([63&t,0],"value");if(this.isListSchema())return this.memberFrom([63&t,0],"member")}if(t&&"object"==typeof t){if(this.isStructSchema())throw new Error(`may not getValueSchema() on structure ${this.getName(!0)}`);const e=t;if("valueSchema"in e){if(this.isMapSchema())return this.memberFrom([e.valueSchema,0],"value");if(this.isListSchema())return this.memberFrom([e.valueSchema,0],"member")}}if(this.isDocumentSchema())return this.memberFrom([b.DOCUMENT,0],"value");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}hasMemberSchema(t){return!!this.isStructSchema()&&this.getSchema().memberNames.includes(t)}getMemberSchema(t){if(this.isStructSchema()){const e=this.getSchema();if(!e.memberNames.includes(t))throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no member=${t}.`);const r=e.memberNames.indexOf(t),s=e.memberList[r];return this.memberFrom(Array.isArray(s)?s:[s,0],t)}if(this.isDocumentSchema())return this.memberFrom([b.DOCUMENT,0],t);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no members.`)}getMemberSchemas(){const t={};try{for(const[e,r]of this.structIterator())t[e]=r}catch(e){}return t}getEventStreamMember(){if(this.isStructSchema())for(const[t,e]of this.structIterator())if(e.isStreaming()&&e.isStructSchema())return t;return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const t=this.getSchema();for(let e=0;e<t.memberNames.length;++e)yield[t.memberNames[e],this.memberFrom([t.memberList[e],0],t.memberNames[e])]}memberFrom(t,e){return t instanceof S?Object.assign(t,{memberName:e,t:!0}):new S(t,e)}getSchemaName(){const t=this.getSchema();if("number"==typeof t){const e=63&t,r=192&t,s=Object.entries(b).find(([,t])=>t===e)?.[0]??"Unknown";switch(r){case b.MAP_MODIFIER:return`${s}Map`;case b.LIST_MODIFIER:return`${s}List`;case 0:return s}}return"Unknown"}}S.symbol=Symbol.for("@smithy/nor");const E=t=>{switch(t){case"true":return!0;case"false":return!1;default:throw new Error(`Unable to parse boolean value "${t}"`)}},T=Math.ceil(2**127*(2-2**-23)),M=t=>{if(null!=t){if(Number.isInteger(t)&&!Number.isNaN(t))return t;throw new TypeError(`Expected integer, got ${typeof t}: ${t}`)}},$=(t,e)=>{const r=M(t);if(void 0!==r&&v(r,e)!==r)throw new TypeError(`Expected ${e}-bit integer, got ${t}`);return r},v=(t,e)=>{switch(e){case 32:return Int32Array.of(t)[0];case 16:return Int16Array.of(t)[0];case 8:return Int8Array.of(t)[0]}},A=(t,e)=>{if(null==t){if(e)throw new TypeError(`Expected a non-null value for ${e}`);throw new TypeError("Expected a non-null value")}return t},I=t=>{if(null==t)return;if("object"==typeof t&&!Array.isArray(t))return t;const e=Array.isArray(t)?"array":typeof t;throw new TypeError(`Expected object, got ${e}: ${t}`)},N=t=>{if(null!=t){if("string"==typeof t)return t;if(["boolean","number","bigint"].includes(typeof t))return R.warn(F(`Expected string, got ${typeof t}: ${t}`)),String(t);throw new TypeError(`Expected string, got ${typeof t}: ${t}`)}},O=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,P=t=>{const e=t.match(O);if(null===e||e[0].length!==t.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(t)},j=t=>M("string"==typeof t?P(t):t),x=t=>(t=>$(t,32))("string"==typeof t?P(t):t),D=t=>(t=>$(t,16))("string"==typeof t?P(t):t),F=t=>String(new TypeError(t).stack||t).split("\n").slice(0,5).filter(t=>!t.includes("stackTraceWarning")).join("\n"),R={warn:console.warn},_=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(t){const e=t.getUTCFullYear(),r=t.getUTCMonth(),s=t.getUTCDay(),n=t.getUTCDate(),i=t.getUTCHours(),o=t.getUTCMinutes(),a=t.getUTCSeconds(),h=i<10?`0${i}`:`${i}`,c=o<10?`0${o}`:`${o}`,u=a<10?`0${a}`:`${a}`;return`${_[s]}, ${n<10?`0${n}`:`${n}`} ${k[r]} ${e} ${h}:${c}:${u} GMT`}const J=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),U=t=>{if(null==t)return;if("string"!=typeof t)throw new TypeError("RFC-3339 date-times must be expressed as strings");const e=J.exec(t);if(!e)throw new TypeError("Invalid RFC-3339 date-time value");const[r,s,n,i,o,a,h,c,u]=e,m=D(et(s)),f=X(n,"month",1,12),d=X(i,"day",1,31),p=q(m,f,d,{hours:o,minutes:a,seconds:h,fractionalMilliseconds:c});return"Z"!=u.toUpperCase()&&p.setTime(p.getTime()-tt(u)),p},B=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),H=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),G=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),L=t=>{if(null==t)return;if("string"!=typeof t)throw new TypeError("RFC-7231 date-times must be expressed as strings");let e=B.exec(t);if(e){const[t,r,s,n,i,o,a,h]=e;return q(D(et(n)),V(s),X(r,"day",1,31),{hours:i,minutes:o,seconds:a,fractionalMilliseconds:h})}if(e=H.exec(t),e){const[t,r,s,n,i,o,a,h]=e;return W(q(z(n),V(s),X(r,"day",1,31),{hours:i,minutes:o,seconds:a,fractionalMilliseconds:h}))}if(e=G.exec(t),e){const[t,r,s,n,i,o,a,h]=e;return q(D(et(h)),V(r),X(s.trimLeft(),"day",1,31),{hours:n,minutes:i,seconds:o,fractionalMilliseconds:a})}throw new TypeError("Invalid RFC-7231 date-time value")},q=(t,e,r,s)=>{const n=e-1;return Z(t,n,r),new Date(Date.UTC(t,n,r,X(s.hours,"hour",0,23),X(s.minutes,"minute",0,59),X(s.seconds,"seconds",0,60),Y(s.fractionalMilliseconds)))},z=t=>{const e=(new Date).getUTCFullYear(),r=100*Math.floor(e/100)+D(et(t));return r<e?r+100:r},W=t=>t.getTime()-(new Date).getTime()>15768e8?new Date(Date.UTC(t.getUTCFullYear()-100,t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())):t,V=t=>{const e=k.indexOf(t);if(e<0)throw new TypeError(`Invalid month: ${t}`);return e+1},K=[31,28,31,30,31,30,31,31,30,31,30,31],Z=(t,e,r)=>{let s=K[e];if(1===e&&Q(t)&&(s=29),r>s)throw new TypeError(`Invalid day for ${k[e]} in ${t}: ${r}`)},Q=t=>t%4==0&&(t%100!=0||t%400==0),X=(t,e,r,s)=>{const n=(t=>(t=>$(t,8))("string"==typeof t?P(t):t))(et(t));if(n<r||n>s)throw new TypeError(`${e} must be between ${r} and ${s}, inclusive`);return n},Y=t=>null==t?0:1e3*(t=>(t=>{const e=(t=>{if(null!=t){if("string"==typeof t){const e=parseFloat(t);if(!Number.isNaN(e))return String(e)!==String(t)&&R.warn(F(`Expected number but observed string: ${t}`)),e}if("number"==typeof t)return t;throw new TypeError(`Expected number, got ${typeof t}: ${t}`)}})(t);if(void 0!==e&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0&&Math.abs(e)>T)throw new TypeError(`Expected 32-bit float, got ${t}`);return e})("string"==typeof t?P(t):t))("0."+t),tt=t=>{const e=t[0];let r=1;if("+"==e)r=1;else{if("-"!=e)throw new TypeError(`Offset direction, ${e}, must be "+" or "-"`);r=-1}return r*(60*Number(t.substring(1,3))+Number(t.substring(4,6)))*60*1e3},et=t=>{let e=0;for(;e<t.length-1&&"0"===t.charAt(e);)e++;return 0===e?t:t.slice(e)};function rt(t){return(t.includes(",")||t.includes('"'))&&(t=`"${t.replace(/"/g,'\\"')}"`),t}function st(t,e){return new nt(t,e)}class nt{constructor(t,e){this.input=t,this.context=e,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:t,protocol:r="https",port:s,path:n}=await this.context.endpoint();this.path=n;for(const e of this.resolvePathStack)e(this.path);return new e({protocol:r,hostname:this.hostname||t,port:s,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(t){return this.hostname=t,this}bp(t){return this.resolvePathStack.push(e=>{this.path=`${e?.endsWith("/")?e.slice(0,-1):e||""}`+t}),this}p(t,e,r,s){return this.resolvePathStack.push(n=>{this.path=((t,e,r,s,n,i)=>{if(null==e||void 0===e[r])throw new Error("No value provided for input HTTP label: "+r+".");{const e=s();if(e.length<=0)throw new Error("Empty value provided for input HTTP label: "+r+".");t=t.replace(n,i?e.split("/").map(t=>m(t)).join("/"):m(e))}return t})(n,this.input,t,e,r,s)}),this}h(t){return this.headers=t,this}q(t){return this.query=t,this}b(t){return this.body=t,this}m(t){return this.method=t,this}}function it(t,e,r){t.i?t.i.features||(t.i.features={}):t.i={features:{}},t.i.features[e]=r}class ot{constructor(t){this.authSchemes=new Map;for(const[e,r]of Object.entries(t))void 0!==r&&this.authSchemes.set(e,r)}getIdentityProvider(t){return this.authSchemes.get(t)}}const at=t=>ht(t)&&t.expiration.getTime()-Date.now()<3e5,ht=t=>void 0!==t.expiration,ct=(t,e,r)=>{if(void 0===t)return;const s="function"!=typeof t?async()=>Promise.resolve(t):t;let n,i,o,a=!1;const h=async t=>{i||(i=s(t));try{n=await i,o=!0,a=!1}finally{i=void 0}return n};return void 0===e?async t=>(o&&!t?.forceRefresh||(n=await h(t)),n):async t=>(o&&!t?.forceRefresh||(n=await h(t)),a?n:r(n)?e(n)?(await h(t),n):n:(a=!0,n))};export{ot as D,S as N,I as a,N as b,E as c,C as d,A as e,u as f,x as g,L as h,n as i,h as j,ht as k,at as l,ct as m,c as n,a as o,U as p,rt as q,st as r,j as s,it as t};
