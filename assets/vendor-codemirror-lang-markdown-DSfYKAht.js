import{P as e,E as t,g as r,j as n}from"./vendor-codemirror-state-d-AKQu11.js";import{k as o}from"./vendor-codemirror-view-BFv1CI2l.js";import{c as s,p as l,o as i,q as a,s as m,i as f,f as c,d as u,r as d,t as p,P as g}from"./vendor-codemirror-language-BPIDEO9h.js";import{C as h}from"./vendor-codemirror-autocomplete-DSfl44C_.js";import{M as x,p as k,a as v,G as L,S as A,b as B,E as j}from"./vendor-lezer-markdown-C4BfTx_h.js";import{html as b,htmlCompletionSource as w}from"./vendor-codemirror-lang-html-BjASXBq2.js";import{N as I}from"./vendor-lezer-common-3JYFuo68.js";import"./vendor-marijn-find-cluster-break-Dub_CRYN.js";import"./vendor-style-mod-_NPnILvn.js";import"./vendor-w3c-keyname-f-y9tSbI.js";import"./vendor-lezer-highlight-QzoJ8SKk.js";import"./vendor-lezer-html-B2Sh_xaS.js";import"./vendor-lezer-lr-kLeAvj2c.js";import"./vendor-codemirror-lang-css-Ce4EGh_v.js";import"./vendor-lezer-css-CEMGMhzc.js";import"./vendor-codemirror-lang-javascript-CC714N_c.js";import"./vendor-lezer-javascript-BFGnb0ul.js";const y=i({commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}}}),S=new I,C=v.configure({props:[c.add(e=>!e.is("Block")||e.is("Document")||null!=T(e)||function(e){return"OrderedList"==e.name||"BulletList"==e.name}(e)?void 0:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})),S.add(T),u.add({Document:()=>null}),d.add({Document:y})]});function T(e){let t=/^(?:ATX|Setext)Heading(\d)$/.exec(e.name);return t?+t[1]:void 0}function O(e,t){let r=e;for(;;){let e,n=r.nextSibling;if(!n||null!=(e=T(n.type))&&e<=t)break;r=n}return r.to}const z=a.of((e,t,r)=>{for(let n=m(e).resolveInner(r,-1);n&&!(n.from<t);n=n.parent){let e=n.type.prop(S);if(null==e)continue;let t=O(n,e);if(t>r)return{from:r,to:t}}return null});function E(e){return new l(y,e,[z],"markdown")}const P=E(C),$=E(C.configure([L,A,B,j,{props:[c.add({Table:(e,t)=>({from:t.doc.lineAt(e.from).to,to:e.to})})]}]));class q{constructor(e,t,r,n,o,s,l){this.node=e,this.from=t,this.to=r,this.spaceBefore=n,this.spaceAfter=o,this.type=s,this.item=l}blank(e,t=!0){let r=this.spaceBefore+("Blockquote"==this.node.name?">":"");if(null!=e){for(;r.length<e;)r+=" ";return r}for(let n=this.to-this.from-r.length-this.spaceAfter.length;n>0;n--)r+=" ";return r+(t?this.spaceAfter:"")}marker(e,t){let r="OrderedList"==this.node.name?String(+D(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter}}function M(e,t){let r=[],n=[];for(let o=e;o;o=o.parent){if("FencedCode"==o.name)return n;"ListItem"!=o.name&&"Blockquote"!=o.name||r.push(o)}for(let o=r.length-1;o>=0;o--){let e,s=r[o],l=t.lineAt(s.from),i=s.from-l.from;if("Blockquote"==s.name&&(e=/^ *>( ?)/.exec(l.text.slice(i))))n.push(new q(s,i,i+e[0].length,"",e[1],">",null));else if("ListItem"==s.name&&"OrderedList"==s.parent.name&&(e=/^( *)\d+([.)])( *)/.exec(l.text.slice(i)))){let t=e[3],r=e[0].length;t.length>=4&&(t=t.slice(0,t.length-4),r-=4),n.push(new q(s.parent,i,i+r,e[1],t,e[2],s))}else if("ListItem"==s.name&&"BulletList"==s.parent.name&&(e=/^( *)([-+*])( {1,4}\[[ xX]\])?( +)/.exec(l.text.slice(i)))){let t=e[4],r=e[0].length;t.length>4&&(t=t.slice(0,t.length-4),r-=4);let o=e[2];e[3]&&(o+=e[3].replace(/[xX]/," ")),n.push(new q(s.parent,i,i+r,e[1],t,o,s))}}return n}function D(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function F(e,t,r,n=0){for(let o=-1,s=e;;){if("ListItem"==s.name){let e=D(s,t),l=+e[2];if(o>=0){if(l!=o+1)return;r.push({from:s.from+e[1].length,to:s.from+e[0].length,insert:String(o+2+n)})}o=l}let e=s.nextSibling;if(!e)break;s=e}}function R(e,t){let n=/^[ \t]*/.exec(e)[0].length;if(!n||"\t"!=t.facet(f))return e;let o="";for(let s=r(e,4,n);s>0;)s>=4?(o+="\t",s-=4):(o+=" ",s--);return o+e.slice(n)}const V=({state:e,dispatch:n})=>{let o=m(e),{doc:s}=e,l=null,i=e.changeByRange(n=>{if(!n.empty||!$.isActiveAt(e,n.from,-1)&&!$.isActiveAt(e,n.from,1))return l={range:n};let i=n.from,a=s.lineAt(i),m=M(o.resolveInner(i,-1),s);for(;m.length&&m[m.length-1].from>i-a.from;)m.pop();if(!m.length)return l={range:n};let f=m[m.length-1];if(f.to-f.spaceAfter.length>i-a.from)return l={range:n};let c=i>=f.to-f.spaceAfter.length&&!/\S/.test(a.text.slice(f.to));if(f.item&&c){let r=f.node.firstChild,n=f.node.getChild("ListItem","ListItem");if(r.to>=i||n&&n.to<i||a.from>0&&!/[^\s>]/.test(s.lineAt(a.from-1).text)){let e,r=m.length>1?m[m.length-2]:null,n="";r&&r.item?(e=a.from+r.from,n=r.marker(s,1)):e=a.from+(r?r.to:0);let o=[{from:e,to:i,insert:n}];return"OrderedList"==f.node.name&&F(f.item,s,o,-2),r&&"OrderedList"==r.node.name&&F(r.item,s,o),{range:t.cursor(e+n.length),changes:o}}{let r=H(m,e,a);return{range:t.cursor(i+r.length+1),changes:{from:a.from,insert:r+e.lineBreak}}}}if("Blockquote"==f.node.name&&c&&a.from){let t=s.lineAt(a.from-1),r=/>\s*$/.exec(t.text);if(r&&r.index==f.from){let o=e.changes([{from:t.from+r.index,to:t.to},{from:a.from+f.from,to:a.to}]);return{range:n.map(o),changes:o}}}let u=[];"OrderedList"==f.node.name&&F(f.item,s,u);let d=f.item&&f.item.from<a.from,p="";if(!d||/^[\s\d.)\-+*>]*/.exec(a.text)[0].length>=f.to)for(let e=0,t=m.length-1;e<=t;e++)p+=e!=t||d?m[e].blank(e<t?r(a.text,4,m[e+1].from)-p.length:null):m[e].marker(s,1);let g=i;for(;g>a.from&&/\s/.test(a.text.charAt(g-a.from-1));)g--;return p=R(p,e),function(e,t){if("OrderedList"!=e.name&&"BulletList"!=e.name)return!1;let r=e.firstChild,n=e.getChild("ListItem","ListItem");if(!n)return!1;let o=t.lineAt(r.to),s=t.lineAt(n.from),l=/^[\s>]*$/.test(o.text);return o.number+(l?0:1)<s.number}(f.node,e.doc)&&(p=H(m,e,a)+e.lineBreak+p),u.push({from:g,to:i,insert:e.lineBreak+p}),{range:t.cursor(g+p.length+1),changes:u}});return!l&&(n(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0)};function X(e){return"QuoteMark"==e.name||"ListMark"==e.name}function H(e,t,n){let o="";for(let s=0,l=e.length-2;s<=l;s++)o+=e[s].blank(s<l?r(n.text,4,e[s+1].from)-o.length:null,s<l);return R(o,t)}const N=({state:e,dispatch:n})=>{let o=m(e),s=null,l=e.changeByRange(n=>{let l=n.from,{doc:i}=e;if(n.empty&&$.isActiveAt(e,n.from)){let n=i.lineAt(l),s=M(function(e,t){let r=e.resolveInner(t,-1),n=t;X(r)&&(n=r.from,r=r.parent);for(let o;o=r.childBefore(n);)if(X(o))n=o.from;else{if("OrderedList"!=o.name&&"BulletList"!=o.name)break;r=o.lastChild,n=r.to}return r}(o,l),i);if(s.length){let o=s[s.length-1],i=o.to-o.spaceAfter.length+(o.spaceAfter?1:0);if(l-n.from>i&&!/\S/.test(n.text.slice(i,l-n.from)))return{range:t.cursor(n.from+i),changes:{from:n.from+i,to:l}};if(l-n.from==i&&(!o.item||n.from<=o.item.from||!/\S/.test(n.text.slice(0,o.to)))){let s=n.from+o.from;if(o.item&&o.node.from<o.item.from&&/\S/.test(n.text.slice(o.from,o.to))){let l=o.blank(r(n.text,4,o.to)-r(n.text,4,o.from));return s==n.from&&(l=R(l,e)),{range:t.cursor(s+l.length),changes:{from:s,to:n.from+o.to,insert:l}}}if(s<l)return{range:t.cursor(s),changes:{from:s,to:l}}}}}return s={range:n}});return!s&&(n(e.update(l,{scrollIntoView:!0,userEvent:"delete"})),!0)},G=[{key:"Enter",run:V},{key:"Backspace",run:N}],K=b({matchClosingTags:!1});function Q(t={}){let{codeLanguages:r,defaultCodeLanguage:n,addKeymap:l=!0,base:{parser:i}=P,completeHTMLTags:a=!0,htmlTagLanguage:m=K}=t;if(!(i instanceof x))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let f,c=t.extensions?[t.extensions]:[],u=[m.support];n instanceof s?(u.push(n.support),f=n.language):n&&(f=n);let d=r||f?(h=r,v=f,e=>{if(e&&h){let t=null;if(e=/\S*/.exec(e)[0],t="function"==typeof h?h(e):p.matchLanguageName(h,e,!0),t instanceof p)return t.support?t.support.language.parser:g.getSkippingParser(t.load());if(t)return t.parser}return v?v.parser:null}):void 0;var h,v;c.push(k({codeParser:d,htmlParser:m.language.parser})),l&&u.push(e.high(o.of(G)));let L=E(i.configure(c));return a&&u.push(L.data.of({autocomplete:U})),new s(L,u)}function U(e){let{state:t,pos:r}=e,n=/<[:\-\.\w\u00b7-\uffff]*$/.exec(t.sliceDoc(r-25,r));if(!n)return null;let o=m(t).resolveInner(r,-1);for(;o&&!o.type.isTop;){if("CodeBlock"==o.name||"FencedCode"==o.name||"ProcessingInstructionBlock"==o.name||"CommentBlock"==o.name||"Link"==o.name||"Image"==o.name)return null;o=o.parent}return{from:r-n[0].length,to:r,options:Y(),validFor:/^<[:\-\.\w\u00b7-\uffff]*$/}}let W=null;function Y(){if(W)return W;let e=w(new h(n.create({extensions:K}),0,!0));return W=e?e.options:[]}export{P as commonmarkLanguage,N as deleteMarkupBackward,V as insertNewlineContinueMarkup,Q as markdown,G as markdownKeymap,$ as markdownLanguage};
