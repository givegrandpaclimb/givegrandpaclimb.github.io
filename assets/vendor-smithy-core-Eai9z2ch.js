import{g as e}from"./vendor-smithy-util-middleware-I6Z6a_gz.js";import{a as t}from"./vendor-smithy-protocol-http-D-24QeOr.js";import{U as r}from"./vendor-smithy-util-stream--lqQ3djc.js";const s={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},i=(t,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:i})=>({applyToStack:n=>{n.addRelativeTo(((t,r)=>(s,i)=>async n=>{const a=((e,t)=>{if(!t||0===t.length)return e;const r=[];for(const s of t)for(const t of e)t.schemeId.split("#")[1]===s&&r.push(t);for(const s of e)r.find(({schemeId:e})=>e===s.schemeId)||r.push(s);return r})(t.httpAuthSchemeProvider(await r.httpAuthSchemeParametersProvider(t,i,n.input)),t.authSchemePreference?await t.authSchemePreference():[]),o=function(e){const t=new Map;for(const r of e)t.set(r.schemeId,r);return t}(t.httpAuthSchemes),h=e(i),c=[];for(const e of a){const s=o.get(e.schemeId);if(!s){c.push(`HttpAuthScheme \`${e.schemeId}\` was not enabled for this service.`);continue}const n=s.identityProvider(await r.identityProviderConfigProvider(t));if(!n){c.push(`HttpAuthScheme \`${e.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:a={},signingProperties:m={}}=e.propertiesExtractor?.(t,i)||{};e.identityProperties=Object.assign(e.identityProperties||{},a),e.signingProperties=Object.assign(e.signingProperties||{},m),h.selectedHttpAuthScheme={httpAuthOption:e,identity:await n(e.identityProperties),signer:s.signer};break}if(!h.selectedHttpAuthScheme)throw new Error(c.join("\n"));return s(n)})(t,{httpAuthSchemeParametersProvider:r,identityProviderConfigProvider:i}),s)}}),n=e=>e=>{throw e},a=(e,t)=>{},o={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},h=r=>({applyToStack:r=>{r.addRelativeTo((r,s)=>async i=>{if(!t.isInstance(i.request))return r(i);const o=e(s).selectedHttpAuthScheme;if(!o)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:h={}},identity:c,signer:m}=o,u=await r({...i,request:await m.sign(i.request,c,h)}).catch((m.errorHandler||n)(h));return(m.successHandler||a)(u.response,h),u},o)}}),c=e=>{if("function"==typeof e)return e;const t=Promise.resolve(e);return()=>t},m=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return r.mutate(e);if(!e)return r.mutate(new Uint8Array);const s=t.streamCollector(e);return r.mutate(await s)};function u(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}const l=e=>"function"==typeof e?e():e;class d{constructor(e,t=new Map){this.namespace=e,this.schemas=t}static for(e){return d.registries.has(e)||d.registries.set(e,new d(e)),d.registries.get(e)}register(e,t){const r=this.normalizeShapeId(e);d.for(this.getNamespace(e)).schemas.set(r,t)}getSchema(e){const t=this.normalizeShapeId(e);if(!this.schemas.has(t))throw new Error(`@smithy/core/schema - schema not found for ${t}`);return this.schemas.get(t)}getBaseException(){for(const[e,t]of this.schemas.entries())if(e.startsWith("smithy.ts.sdk.synthetic.")&&e.endsWith("ServiceException"))return t}find(e){return[...this.schemas.values()].find(e)}destroy(){d.registries.delete(this.namespace),this.schemas.clear()}normalizeShapeId(e){return e.includes("#")?e:this.namespace+"#"+e}getNamespace(e){return this.normalizeShapeId(e).split("#")[0]}}d.registries=new Map;class f{static assign(e,t){const r=Object.assign(e,t);return d.for(r.namespace).register(r.name,r),r}static[Symbol.hasInstance](e){const t=this.prototype.isPrototypeOf(e);return t||"object"!=typeof e||null===e?t:e.symbol===this.symbol}getName(){return this.namespace+"#"+this.name}}class p extends f{constructor(){super(...arguments),this.symbol=p.symbol}}p.symbol=Symbol.for("@smithy/lis");class y extends f{constructor(){super(...arguments),this.symbol=y.symbol}}y.symbol=Symbol.for("@smithy/map");class g extends f{constructor(){super(...arguments),this.symbol=g.symbol}}g.symbol=Symbol.for("@smithy/str");const S={BLOB:21,STREAMING_BLOB:42,BOOLEAN:2,STRING:0,NUMERIC:1,BIG_INTEGER:17,BIG_DECIMAL:19,DOCUMENT:15,TIMESTAMP_DEFAULT:4,TIMESTAMP_DATE_TIME:5,TIMESTAMP_HTTP_DATE:6,TIMESTAMP_EPOCH_SECONDS:7,LIST_MODIFIER:64,MAP_MODIFIER:128};class b extends f{constructor(){super(...arguments),this.symbol=b.symbol}}b.symbol=Symbol.for("@smithy/sim");class T{constructor(e,t){this.ref=e,this.memberName=t,this.symbol=T.symbol;const r=[];let s=e,i=e;for(this._isMemberSchema=!1;Array.isArray(s);)r.push(s[1]),s=s[0],i=l(s),this._isMemberSchema=!0;if(r.length>0){this.memberTraits={};for(let e=r.length-1;e>=0;--e){const t=r[e];Object.assign(this.memberTraits,T.translateTraits(t))}}else this.memberTraits=0;if(i instanceof T)return Object.assign(this,i),this.memberTraits=Object.assign({},i.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,void(this.memberName=t??i.memberName);if(this.schema=l(i),this.schema&&"object"==typeof this.schema?this.traits=this.schema?.traits??{}:this.traits=0,this.name=(this.schema instanceof f?this.schema.getName?.():void 0)??this.memberName??this.getSchemaName(),this._isMemberSchema&&!t)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](e){return f[Symbol.hasInstance].bind(this)(e)}static of(e){if(e instanceof T)return e;if(Array.isArray(e)){const[t,r]=e;if(t instanceof T)return Object.assign(t.getMergedTraits(),T.translateTraits(r)),t;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(e,null,2)}.`)}return new T(e)}static translateTraits(e){if("object"==typeof e)return e;e|=0;const t={};let r=0;for(const s of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])1==(e>>r++&1)&&(t[s]=1);return t}getSchema(){return this.schema instanceof T?(Object.assign(this,{schema:this.schema.getSchema()}),this.schema):this.schema instanceof b?l(this.schema.schemaRef):l(this.schema)}getName(e=!1){return!e&&this.name&&this.name.includes("#")?this.name.split("#")[1]:this.name||void 0}getMemberName(){if(!this.isMemberSchema())throw new Error(`@smithy/core/schema - non-member schema: ${this.getName(!0)}`);return this.memberName}isMemberSchema(){return this._isMemberSchema}isUnitSchema(){return"unit"===this.getSchema()}isListSchema(){const e=this.getSchema();return"number"==typeof e?e>=S.LIST_MODIFIER&&e<S.MAP_MODIFIER:e instanceof p}isMapSchema(){const e=this.getSchema();return"number"==typeof e?e>=S.MAP_MODIFIER&&e<=255:e instanceof y}isStructSchema(){const e=this.getSchema();return null!==e&&"object"==typeof e&&"members"in e||e instanceof g}isBlobSchema(){return this.getSchema()===S.BLOB||this.getSchema()===S.STREAMING_BLOB}isTimestampSchema(){const e=this.getSchema();return"number"==typeof e&&e>=S.TIMESTAMP_DEFAULT&&e<=S.TIMESTAMP_EPOCH_SECONDS}isDocumentSchema(){return this.getSchema()===S.DOCUMENT}isStringSchema(){return this.getSchema()===S.STRING}isBooleanSchema(){return this.getSchema()===S.BOOLEAN}isNumericSchema(){return this.getSchema()===S.NUMERIC}isBigIntegerSchema(){return this.getSchema()===S.BIG_INTEGER}isBigDecimalSchema(){return this.getSchema()===S.BIG_DECIMAL}isStreaming(){return!!this.getMergedTraits().streaming||this.getSchema()===S.STREAMING_BLOB}isIdempotencyToken(){return"number"==typeof this.traits?!(4&~this.traits):"object"==typeof this.traits&&!!this.traits.idempotencyToken}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return T.translateTraits(this.memberTraits)}getOwnTraits(){return T.translateTraits(this.traits)}getKeySchema(){if(this.isDocumentSchema())return this.memberFrom([S.DOCUMENT,0],"key");if(!this.isMapSchema())throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const e=this.getSchema();return"number"==typeof e?this.memberFrom([63&e,0],"key"):this.memberFrom([e.keySchema,0],"key")}getValueSchema(){const e=this.getSchema();if("number"==typeof e){if(this.isMapSchema())return this.memberFrom([63&e,0],"value");if(this.isListSchema())return this.memberFrom([63&e,0],"member")}if(e&&"object"==typeof e){if(this.isStructSchema())throw new Error(`may not getValueSchema() on structure ${this.getName(!0)}`);const t=e;if("valueSchema"in t){if(this.isMapSchema())return this.memberFrom([t.valueSchema,0],"value");if(this.isListSchema())return this.memberFrom([t.valueSchema,0],"member")}}if(this.isDocumentSchema())return this.memberFrom([S.DOCUMENT,0],"value");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}hasMemberSchema(e){return!!this.isStructSchema()&&this.getSchema().memberNames.includes(e)}getMemberSchema(e){if(this.isStructSchema()){const t=this.getSchema();if(!t.memberNames.includes(e))throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no member=${e}.`);const r=t.memberNames.indexOf(e),s=t.memberList[r];return this.memberFrom(Array.isArray(s)?s:[s,0],e)}if(this.isDocumentSchema())return this.memberFrom([S.DOCUMENT,0],e);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no members.`)}getMemberSchemas(){const e={};try{for(const[t,r]of this.structIterator())e[t]=r}catch(t){}return e}getEventStreamMember(){if(this.isStructSchema())for(const[e,t]of this.structIterator())if(t.isStreaming()&&t.isStructSchema())return e;return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const e=this.getSchema();for(let t=0;t<e.memberNames.length;++t)yield[e.memberNames[t],this.memberFrom([e.memberList[t],0],e.memberNames[t])]}memberFrom(e,t){return e instanceof T?Object.assign(e,{memberName:t,_isMemberSchema:!0}):new T(e,t)}getSchemaName(){const e=this.getSchema();if("number"==typeof e){const t=63&e,r=192&e,s=Object.entries(S).find(([,e])=>e===t)?.[0]??"Unknown";switch(r){case S.MAP_MODIFIER:return`${s}Map`;case S.LIST_MODIFIER:return`${s}List`;case 0:return s}}return"Unknown"}}T.symbol=Symbol.for("@smithy/nor");const w=e=>{switch(e){case"true":return!0;case"false":return!1;default:throw new Error(`Unable to parse boolean value "${e}"`)}},M=Math.ceil(2**127*(2-2**-23)),E=e=>{if(null!=e){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}},I=(e,t)=>{const r=E(e);if(void 0!==r&&N(r,t)!==r)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return r},N=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},v=(e,t)=>{if(null==e){if(t)throw new TypeError(`Expected a non-null value for ${t}`);throw new TypeError("Expected a non-null value")}return e},A=e=>{if(null==e)return;if("object"==typeof e&&!Array.isArray(e))return e;const t=Array.isArray(e)?"array":typeof e;throw new TypeError(`Expected object, got ${t}: ${e}`)},$=e=>{if(null!=e){if("string"==typeof e)return e;if(["boolean","number","bigint"].includes(typeof e))return U.warn(D(`Expected string, got ${typeof e}: ${e}`)),String(e);throw new TypeError(`Expected string, got ${typeof e}: ${e}`)}},P=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,O=e=>{const t=e.match(P);if(null===t||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},_=e=>E("string"==typeof e?O(e):e),C=e=>(e=>I(e,32))("string"==typeof e?O(e):e),x=e=>(e=>I(e,16))("string"==typeof e?O(e):e),D=e=>String(new TypeError(e).stack||e).split("\n").slice(0,5).filter(e=>!e.includes("stackTraceWarning")).join("\n"),U={warn:console.warn},F=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(e){const t=e.getUTCFullYear(),r=e.getUTCMonth(),s=e.getUTCDay(),i=e.getUTCDate(),n=e.getUTCHours(),a=e.getUTCMinutes(),o=e.getUTCSeconds(),h=n<10?`0${n}`:`${n}`,c=a<10?`0${a}`:`${a}`,m=o<10?`0${o}`:`${o}`;return`${F[s]}, ${i<10?`0${i}`:`${i}`} ${R[r]} ${t} ${h}:${c}:${m} GMT`}const k=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),L=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=k.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[r,s,i,n,a,o,h,c,m]=t,u=x(te(s)),l=Q(i,"month",1,12),d=Q(n,"day",1,31),f=q(u,l,d,{hours:a,minutes:o,seconds:h,fractionalMilliseconds:c});return"Z"!=m.toUpperCase()&&f.setTime(f.getTime()-ee(m)),f},B=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),H=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),G=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),J=e=>{if(null==e)return;if("string"!=typeof e)throw new TypeError("RFC-7231 date-times must be expressed as strings");let t=B.exec(e);if(t){const[e,r,s,i,n,a,o,h]=t;return q(x(te(i)),V(s),Q(r,"day",1,31),{hours:n,minutes:a,seconds:o,fractionalMilliseconds:h})}if(t=H.exec(e),t){const[e,r,s,i,n,a,o,h]=t;return W(q(z(i),V(s),Q(r,"day",1,31),{hours:n,minutes:a,seconds:o,fractionalMilliseconds:h}))}if(t=G.exec(e),t){const[e,r,s,i,n,a,o,h]=t;return q(x(te(h)),V(r),Q(s.trimLeft(),"day",1,31),{hours:i,minutes:n,seconds:a,fractionalMilliseconds:o})}throw new TypeError("Invalid RFC-7231 date-time value")},q=(e,t,r,s)=>{const i=t-1;return K(e,i,r),new Date(Date.UTC(e,i,r,Q(s.hours,"hour",0,23),Q(s.minutes,"minute",0,59),Q(s.seconds,"seconds",0,60),X(s.fractionalMilliseconds)))},z=e=>{const t=(new Date).getUTCFullYear(),r=100*Math.floor(t/100)+x(te(e));return r<t?r+100:r},W=e=>e.getTime()-(new Date).getTime()>15768e8?new Date(Date.UTC(e.getUTCFullYear()-100,e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())):e,V=e=>{const t=R.indexOf(e);if(t<0)throw new TypeError(`Invalid month: ${e}`);return t+1},Y=[31,28,31,30,31,30,31,31,30,31,30,31],K=(e,t,r)=>{let s=Y[t];if(1===t&&Z(e)&&(s=29),r>s)throw new TypeError(`Invalid day for ${R[t]} in ${e}: ${r}`)},Z=e=>e%4==0&&(e%100!=0||e%400==0),Q=(e,t,r,s)=>{const i=(e=>(e=>I(e,8))("string"==typeof e?O(e):e))(te(e));if(i<r||i>s)throw new TypeError(`${t} must be between ${r} and ${s}, inclusive`);return i},X=e=>null==e?0:1e3*(e=>(e=>{const t=(e=>{if(null!=e){if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&U.warn(D(`Expected number but observed string: ${e}`)),t}if("number"==typeof e)return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}})(e);if(void 0!==t&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>M)throw new TypeError(`Expected 32-bit float, got ${e}`);return t})("string"==typeof e?O(e):e))("0."+e),ee=e=>{const t=e[0];let r=1;if("+"==t)r=1;else{if("-"!=t)throw new TypeError(`Offset direction, ${t}, must be "+" or "-"`);r=-1}return r*(60*Number(e.substring(1,3))+Number(e.substring(4,6)))*60*1e3},te=e=>{let t=0;for(;t<e.length-1&&"0"===e.charAt(t);)t++;return 0===t?e:e.slice(t)};function re(e){return(e.includes(",")||e.includes('"'))&&(e=`"${e.replace(/"/g,'\\"')}"`),e}function se(e,t){return new ie(e,t)}class ie{constructor(e,t){this.input=e,this.context=t,this.query={},this.method="",this.headers={},this.path="",this.body=null,this.hostname="",this.resolvePathStack=[]}async build(){const{hostname:e,protocol:r="https",port:s,path:i}=await this.context.endpoint();this.path=i;for(const t of this.resolvePathStack)t(this.path);return new t({protocol:r,hostname:this.hostname||e,port:s,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(e){return this.hostname=e,this}bp(e){return this.resolvePathStack.push(t=>{this.path=`${t?.endsWith("/")?t.slice(0,-1):t||""}`+e}),this}p(e,t,r,s){return this.resolvePathStack.push(i=>{this.path=((e,t,r,s,i,n)=>{if(null==t||void 0===t[r])throw new Error("No value provided for input HTTP label: "+r+".");{const t=s();if(t.length<=0)throw new Error("Empty value provided for input HTTP label: "+r+".");e=e.replace(i,n?t.split("/").map(e=>u(e)).join("/"):u(t))}return e})(i,this.input,e,t,r,s)}),this}h(e){return this.headers=e,this}q(e){return this.query=e,this}b(e){return this.body=e,this}m(e){return this.method=e,this}}function ne(e,t,r){e.__smithy_context?e.__smithy_context.features||(e.__smithy_context.features={}):e.__smithy_context={features:{}},e.__smithy_context.features[t]=r}class ae{constructor(e){this.authSchemes=new Map;for(const[t,r]of Object.entries(e))void 0!==r&&this.authSchemes.set(t,r)}getIdentityProvider(e){return this.authSchemes.get(e)}}const oe=e=>he(e)&&e.expiration.getTime()-Date.now()<3e5,he=e=>void 0!==e.expiration,ce=(e,t,r)=>{if(void 0===e)return;const s="function"!=typeof e?async()=>Promise.resolve(e):e;let i,n,a,o=!1;const h=async e=>{n||(n=s(e));try{i=await n,a=!0,o=!1}finally{n=void 0}return i};return void 0===t?async e=>(a&&!e?.forceRefresh||(i=await h(e)),i):async e=>(a&&!e?.forceRefresh||(i=await h(e)),o?i:r(i)?t(i)?(await h(e),i):i:(o=!0,i))};export{ae as D,T as N,A as a,$ as b,w as c,j as d,v as e,m as f,C as g,J as h,i,h as j,he as k,oe as l,ce as m,c as n,o,L as p,re as q,se as r,_ as s,ne as t};
