import{p as e}from"./vendor-lezer-xml-C1h3Vjnz.js";import{L as t,s as n,c as o,d as l,f as r,l as a}from"./vendor-codemirror-language-BPIDEO9h.js";import{E as i}from"./vendor-codemirror-state-d-AKQu11.js";import{E as s}from"./vendor-codemirror-view-BFv1CI2l.js";import"./vendor-lezer-lr-kLeAvj2c.js";import"./vendor-lezer-common-3JYFuo68.js";import"./vendor-lezer-highlight-QzoJ8SKk.js";import"./vendor-style-mod-_NPnILvn.js";import"./vendor-marijn-find-cluster-break-Dub_CRYN.js";import"./vendor-w3c-keyname-f-y9tSbI.js";function m(e,t){let n=t&&t.getChild("TagName");return n?e.sliceString(n.from,n.to):""}function c(e,t){let n=t&&t.firstChild;return n&&"OpenTag"==n.name?m(e,n):""}function p(e){for(let t=e&&e.parent;t;t=t.parent)if("Element"==t.name)return t;return null}class u{constructor(e,t,n){this.attrs=t,this.attrValues=n,this.children=[],this.name=e.name,this.completion=Object.assign(Object.assign({type:"type"},e.completion||{}),{label:this.name}),this.openCompletion=Object.assign(Object.assign({},this.completion),{label:"<"+this.name}),this.closeCompletion=Object.assign(Object.assign({},this.completion),{label:"</"+this.name+">",boost:2}),this.closeNameCompletion=Object.assign(Object.assign({},this.completion),{label:this.name+">"}),this.text=e.textContent?e.textContent.map(e=>({label:e,type:"text"})):[]}}const f=/^[:\-\.\w\u00b7-\uffff]*$/;function d(e){return Object.assign(Object.assign({type:"property"},e.completion||{}),{label:e.name})}function g(e){return"string"==typeof e?{label:`"${e}"`,type:"constant"}:/^"/.test(e.label)?e:Object.assign(Object.assign({},e),{label:`"${e.label}"`})}function h(e,t){let o=[],l=[],r=Object.create(null);for(let n of t){let e=d(n);o.push(e),n.global&&l.push(e),n.values&&(r[n.name]=n.values.map(g))}let a=[],i=[],s=Object.create(null);for(let n of e){let e=l,t=r;n.attributes&&(e=e.concat(n.attributes.map(e=>"string"==typeof e?o.find(t=>t.label==e)||{label:e,type:"property"}:(e.values&&(t==r&&(t=Object.create(t)),t[e.name]=e.values.map(g)),d(e)))));let m=new u(n,e,t);s[m.name]=m,a.push(m),n.top&&i.push(m)}i.length||(i=a);for(let n=0;n<a.length;n++){let t=e[n],o=a[n];if(t.children)for(let e of t.children)s[e]&&o.children.push(s[e]);else o.children=a}return e=>{var t;let{doc:o}=e.state,u=function(e,t){var o;let l=n(e).resolveInner(t,-1),r=null;for(let n=l;!r&&n.parent;n=n.parent)"OpenTag"!=n.name&&"CloseTag"!=n.name&&"SelfClosingTag"!=n.name&&"MismatchedCloseTag"!=n.name||(r=n);if(r&&(r.to>t||r.lastChild.type.isError)){let e=r.parent;if("TagName"==l.name)return"CloseTag"==r.name||"MismatchedCloseTag"==r.name?{type:"closeTag",from:l.from,context:e}:{type:"openTag",from:l.from,context:p(e)};if("AttributeName"==l.name)return{type:"attrName",from:l.from,context:r};if("AttributeValue"==l.name)return{type:"attrValue",from:l.from,context:r};let n=l==r||"Attribute"==l.name?l.childBefore(t):l;return"StartTag"==(null==n?void 0:n.name)?{type:"openTag",from:t,context:p(e)}:"StartCloseTag"==(null==n?void 0:n.name)&&n.to<=t?{type:"closeTag",from:t,context:e}:"Is"==(null==n?void 0:n.name)?{type:"attrValue",from:t,context:r}:n?{type:"attrName",from:t,context:r}:null}if("StartCloseTag"==l.name)return{type:"closeTag",from:t,context:l.parent};for(;l.parent&&l.to==t&&!(null===(o=l.lastChild)||void 0===o?void 0:o.type.isError);)l=l.parent;return"Element"==l.name||"Text"==l.name||"Document"==l.name?{type:"tag",from:t,context:"Element"==l.name?l:p(l)}:null}(e.state,e.pos);if(!u||"tag"==u.type&&!e.explicit)return null;let{type:d,from:g,context:h}=u;if("openTag"==d){let e=i,t=c(o,h);if(t){let n=s[t];e=(null==n?void 0:n.children)||a}return{from:g,options:e.map(e=>e.completion),validFor:f}}if("closeTag"==d){let n=c(o,h);return n?{from:g,to:e.pos+(">"==o.sliceString(e.pos,e.pos+1)?1:0),options:[(null===(t=s[n])||void 0===t?void 0:t.closeNameCompletion)||{label:n+">",type:"type"}],validFor:f}:null}if("attrName"==d){let e=s[m(o,h)];return{from:g,options:(null==e?void 0:e.attrs)||l,validFor:f}}if("attrValue"==d){let t=function(e,t,n){let o=t&&t.getChildren("Attribute").find(e=>e.from<=n&&e.to>=n),l=o&&o.getChild("AttributeName");return l?e.sliceString(l.from,l.to):""}(o,h,g);if(!t)return null;let n=s[m(o,h)],l=((null==n?void 0:n.attrValues)||r)[t];return l&&l.length?{from:g,to:e.pos+('"'==o.sliceString(e.pos,e.pos+1)?1:0),options:l,validFor:/^"[^"]*"?$/}:null}if("tag"==d){let t=c(o,h),n=s[t],l=[],r=h&&h.lastChild;!t||r&&"CloseTag"==r.name&&m(o,r)==t||l.push(n?n.closeCompletion:{label:"</"+t+">",type:"type",boost:2});let p=l.concat(((null==n?void 0:n.children)||(h?a:i)).map(e=>e.openCompletion));if(h&&(null==n?void 0:n.text.length)){let t=h.firstChild;t.to>e.pos-20&&!/\S/.test(e.state.sliceDoc(t.to,e.pos))&&(p=p.concat(n.text))}return{from:g,options:p,validFor:/^<\/?[:\-\.\w\u00b7-\uffff]*$/}}return null}}const v=t.define({name:"xml",parser:e.configure({props:[l.add({Element(e){let t=/^\s*<\//.test(e.textAfter);return e.lineIndent(e.node.from)+(t?0:e.unit)},"OpenTag CloseTag SelfClosingTag":e=>e.column(e.node.from)+e.unit}),r.add({Element(e){let t=e.firstChild,n=e.lastChild;return t&&"OpenTag"==t.name?{from:t.to,to:"CloseTag"==n.name?n.from:e.to}:null}}),a.add({"OpenTag CloseTag":e=>e.getChild("TagName")})]}),languageData:{commentTokens:{block:{open:"\x3c!--",close:"--\x3e"}},indentOnInput:/^\s*<\/$/}});function b(e={}){let t=[v.data.of({autocomplete:h(e.elements||[],e.attributes||[])})];return!1!==e.autoCloseTags&&t.push(T),new o(v,t)}function C(e,t,n=e.length){if(!t)return"";let o=t.firstChild,l=o&&o.getChild("TagName");return l?e.sliceString(l.from,Math.min(l.to,n)):""}const T=s.inputHandler.of((e,t,o,l,r)=>{if(e.composing||e.state.readOnly||t!=o||">"!=l&&"/"!=l||!v.isActiveAt(e.state,t,-1))return!1;let a=r(),{state:s}=a,m=s.changeByRange(e=>{var t,o,r;let a,{head:m}=e,c=s.doc.sliceString(m-1,m)==l,p=n(s).resolveInner(m,-1);if(c&&">"==l&&"EndTag"==p.name){let n=p.parent;if("CloseTag"!=(null===(o=null===(t=n.parent)||void 0===t?void 0:t.lastChild)||void 0===o?void 0:o.name)&&(a=C(s.doc,n.parent,m)))return{range:e,changes:{from:m,to:m+(">"===s.doc.sliceString(m,m+1)?1:0),insert:`</${a}>`}}}else if(c&&"/"==l&&"StartCloseTag"==p.name){let e=p.parent;if(p.from==m-2&&"CloseTag"!=(null===(r=e.lastChild)||void 0===r?void 0:r.name)&&(a=C(s.doc,e,m))){let e=m+(">"===s.doc.sliceString(m,m+1)?1:0),t=`${a}>`;return{range:i.cursor(m+t.length,-1),changes:{from:m,to:e,insert:t}}}}return{range:e}});return!m.changes.empty&&(e.dispatch([a,s.update(m,{userEvent:"input.complete",scrollIntoView:!0})]),!0)});export{T as autoCloseTags,h as completeFromSchema,b as xml,v as xmlLanguage};
