import{N as t,T as e,I as i,P as s,b as r,c as n,d as h}from"./vendor-lezer-common-QPiu6Hcj.js";import{F as l,P as o,g as u,j as a,k as f,a as c,S as d}from"./vendor-codemirror-state-D88w-V9V.js";import{E as m,V as p,a as g,l as v,D as w}from"./vendor-codemirror-view-DVzN21hM.js";import{a as b,h as k,t as y,s as x}from"./vendor-lezer-highlight-4-fykoed.js";import{S as j}from"./vendor-style-mod-tLAqh-pC.js";var A;const N=new t;function S(t){return l.define({combine:t?e=>e.concat(t):void 0})}const D=new t;class I{constructor(t,e,i=[],s=""){this.data=t,this.name=s,a.prototype.hasOwnProperty("tree")||Object.defineProperty(a.prototype,"tree",{get(){return P(this)}}),this.parser=e,this.extension=[W.of(this),a.languageData.of((t,e,i)=>{let s=T(t,e,i),r=s.type.prop(N);if(!r)return[];let n=t.facet(r),h=s.type.prop(D);if(h){let r=s.resolve(e-s.from,i);for(let e of h)if(e.test(r,t)){let i=t.facet(e.facet);return"replace"==e.type?i:i.concat(n)}}return n})].concat(i)}isActiveAt(t,e,i=-1){return T(t,e,i).type.prop(N)==this.data}findRegions(i){let s=i.facet(W);if((null==s?void 0:s.data)==this.data)return[{from:0,to:i.doc.length}];if(!s||!s.allowsNesting)return[];let r=[],n=(i,s)=>{if(i.prop(N)==this.data)return void r.push({from:s,to:s+i.length});let h=i.prop(t.mounted);if(h){if(h.tree.prop(N)==this.data){if(h.overlay)for(let t of h.overlay)r.push({from:t.from+s,to:t.to+s});else r.push({from:s,to:s+i.length});return}if(h.overlay){let t=r.length;if(n(h.tree,h.overlay[0].from+s),r.length>t)return}}for(let t=0;t<i.children.length;t++){let r=i.children[t];r instanceof e&&n(r,i.positions[t]+s)}};return n(P(i),0),r}get allowsNesting(){return!0}}function T(t,e,s){let r=t.facet(W),n=P(t).topNode;if(!r||r.allowsNesting)for(let h=n;h;h=h.enter(e,s,i.ExcludeBuffers))h.type.isTop&&(n=h);return n}I.setState=c.define();class M extends I{constructor(t,e,i){super(t,e,[],i),this.parser=e}static define(t){let e=S(t.languageData);return new M(e,t.parser.configure({props:[N.add(t=>t.isTop?e:void 0)]}),t.name)}configure(t,e){return new M(this.data,this.parser.configure(t),e||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function P(t){let i=t.field(I.state,!1);return i?i.tree:e.empty}class O{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let B=null;class L{constructor(t,e,i=[],s,r,n,h,l){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=r,this.viewport=n,this.skipped=h,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(t,i,s){return new L(t,i,[],e.empty,0,s,[],null)}startParse(){return this.parser.startParse(new O(this.state.doc),this.fragments)}work(t,i){return null!=i&&i>=this.state.doc.length&&(i=void 0),this.tree!=e.empty&&this.isDone(null!=i?i:this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var e;if("number"==typeof t){let e=Date.now()+t;t=()=>Date.now()>e}for(this.parse||(this.parse=this.startParse()),null!=i&&(null==this.parse.stoppedAt||this.parse.stoppedAt>i)&&i<this.state.doc.length&&this.parse.stopAt(i);;){let s=this.parse.advance();if(s){if(this.fragments=this.withoutTempSkipped(n.addTree(s,this.fragments,null!=this.parse.stoppedAt)),this.treeLen=null!==(e=this.parse.stoppedAt)&&void 0!==e?e:this.state.doc.length,this.tree=s,this.parse=null,!(this.treeLen<(null!=i?i:this.state.doc.length)))return!0;this.parse=this.startParse()}if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((null==this.parse.stoppedAt||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(n.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=B;B=this;try{return t()}finally{B=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=C(t,e.from,e.to);return t}changes(t,i){let{fragments:s,tree:r,treeLen:h,viewport:l,skipped:o}=this;if(this.takeTree(),!t.empty){let i=[];if(t.iterChangedRanges((t,e,s,r)=>i.push({fromA:t,toA:e,fromB:s,toB:r})),s=n.applyChanges(s,i),r=e.empty,h=0,l={from:t.mapPos(l.from,-1),to:t.mapPos(l.to,1)},this.skipped.length){o=[];for(let e of this.skipped){let i=t.mapPos(e.from,1),s=t.mapPos(e.to,-1);i<s&&o.push({from:i,to:s})}}}return new L(this.parser,i,s,r,h,l,o,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:e,to:s}=this.skipped[i];e<t.to&&s>t.from&&(this.fragments=C(this.fragments,e,s),this.skipped.splice(i--,1))}return!(this.skipped.length>=e||(this.reset(),0))}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends s{createParse(i,s,n){let h=n[0].from,l=n[n.length-1].to;return{parsedPos:h,advance(){let i=B;if(i){for(let t of n)i.tempSkipped.push(t);t&&(i.scheduleOn=i.scheduleOn?Promise.all([i.scheduleOn,t]):t)}return this.parsedPos=l,new e(r.none,[],[],l-h)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&0==e[0].from&&e[0].to>=t}static get(){return B}}function C(t,e,i){return n.applyChanges(t,[{fromA:e,toA:i,fromB:e,toB:i}])}class E{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new E(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=L.create(t.facet(W).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new E(i)}}I.state=d.define({create:E.init,update(t,e){for(let i of e.effects)if(i.is(I.setState))return i.value;return e.startState.facet(W)!=e.state.facet(W)?E.init(e.state):t.apply(e)}});let q=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};"undefined"!=typeof requestIdleCallback&&(q=t=>{let e=-1,i=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(i):cancelIdleCallback(e)});const R="undefined"!=typeof navigator&&(null===(A=navigator.scheduling)||void 0===A?void 0:A.isInputPending)?()=>navigator.scheduling.isInputPending():null,V=p.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(I.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(I.state);e.tree==e.context.tree&&e.context.isDone(t.doc.length)||(this.working=q(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,r=i.field(I.state);if(r.tree==r.context.tree&&r.context.isDone(s+1e5))return;let n=Date.now()+Math.min(this.chunkBudget,100,t&&!R?Math.max(25,t.timeRemaining()-5):1e9),h=r.context.treeLen<s&&i.doc.length>s+1e3,l=r.context.work(()=>R&&R()||Date.now()>n,s+(h?0:1e5));this.chunkBudget-=Date.now()-e,(l||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:I.setState.of(new E(r.context))})),this.chunkBudget>0&&(!l||h)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(t=>v(this.view.state,t)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),W=l.define({combine:t=>t.length?t[0]:null,enables:t=>[I.state,V,m.contentAttributes.compute([t],e=>{let i=e.facet(t);return i&&i.name?{"data-language":i.name}:{}})]});class F{constructor(t,e=[]){this.language=t,this.support=e,this.extension=[t,e]}}class U{constructor(t,e,i,s,r,n=void 0){this.name=t,this.alias=e,this.extensions=i,this.filename=s,this.loadFunc=r,this.support=n,this.loading=null}load(){return this.loading||(this.loading=this.loadFunc().then(t=>this.support=t,t=>{throw this.loading=null,t}))}static of(t){let{load:e,support:i}=t;if(!e){if(!i)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");e=()=>Promise.resolve(i)}return new U(t.name,(t.alias||[]).concat(t.name).map(t=>t.toLowerCase()),t.extensions||[],t.filename,e,i)}static matchFilename(t,e){for(let s of t)if(s.filename&&s.filename.test(e))return s;let i=/\.([^.]+)$/.exec(e);if(i)for(let s of t)if(s.extensions.indexOf(i[1])>-1)return s;return null}static matchLanguageName(t,e,i=!0){e=e.toLowerCase();for(let s of t)if(s.alias.some(t=>t==e))return s;if(i)for(let s of t)for(let t of s.alias){let i=e.indexOf(t);if(i>-1&&(t.length>2||!/\w/.test(e[i-1])&&!/\w/.test(e[i+t.length])))return s}return null}}const $=l.define(),z=l.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function H(t){let e=t.facet(z);return 9==e.charCodeAt(0)?t.tabSize*e.length:e.length}function G(t,e){let i="",s=t.tabSize,r=t.facet(z)[0];if("\t"==r){for(;e>=s;)i+="\t",e-=s;r=" "}for(let n=0;n<e;n++)i+=r;return i}function J(t,e){t instanceof a&&(t=new Y(t));for(let s of t.state.facet($)){let i=s(t,e);if(void 0!==i)return i}let i=P(t.state);return i.length>=e?function(t,e,i){let s=e.resolveStack(i),r=e.resolveInner(i,-1).resolve(i,0).enterUnfinishedNodesBefore(i);if(r!=s.node){let t=[];for(let e=r;e&&!(e.from<s.node.from||e.to>s.node.to||e.from==s.node.from&&e.type==s.node.type);e=e.parent)t.push(e);for(let e=t.length-1;e>=0;e--)s={node:t[e],next:s}}return K(s,t,i)}(t,i,e):null}class Y{constructor(t,e={}){this.state=t,this.options=e,this.unit=H(t)}lineAt(t,e=1){let i=this.state.doc.lineAt(t),{simulateBreak:s,simulateDoubleBreak:r}=this.options;return null!=s&&s>=i.from&&s<=i.to?r&&s==t?{text:"",from:t}:(e<0?s<t:s<=t)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(t,e=1){if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(t,e);return i.slice(t-s,Math.min(i.length,t+100-s))}column(t,e=1){let{text:i,from:s}=this.lineAt(t,e),r=this.countColumn(i,t-s),n=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return n>-1&&(r+=n-this.countColumn(i,i.search(/\S|$/))),r}countColumn(t,e=t.length){return u(t,this.state.tabSize,e)}lineIndent(t,e=1){let{text:i,from:s}=this.lineAt(t,e),r=this.options.overrideIndentation;if(r){let t=r(s);if(t>-1)return t}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const _=new t;function K(t,e,i){for(let s=t;s;s=s.next){let t=Q(s.node);if(t)return t(Z.create(e,i,s))}return 0}function Q(e){let i=e.type.prop(_);if(i)return i;let s,r=e.firstChild;if(r&&(s=r.type.prop(t.closedBy))){let t=e.lastChild,i=t&&s.indexOf(t.name)>-1;return e=>it(e,!0,1,void 0,i&&!function(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}(e)?t.from:void 0)}return null==e.parent?X:null}function X(){return 0}class Z extends Y{constructor(t,e,i){super(t.state,t.options),this.base=t,this.pos=e,this.context=i}get node(){return this.context.node}static create(t,e,i){return new Z(t,e,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(t){let e=this.state.doc.lineAt(t.from);for(;;){let i=t.resolve(e.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(tt(i,t))break;e=this.state.doc.lineAt(i.from)}return this.lineIndent(e.from)}continue(){return K(this.context.next,this.base,this.pos)}}function tt(t,e){for(let i=e;i;i=i.parent)if(t==i)return!0;return!1}function et({closing:t,align:e=!0,units:i=1}){return s=>it(s,e,i,t)}function it(t,e,i,s,r){let n=t.textAfter,h=n.match(/^\s*/)[0].length,l=s&&n.slice(h,h+s.length)==s||r==t.pos+h,o=e?function(t){let e=t.node,i=e.childAfter(e.from),s=e.lastChild;if(!i)return null;let r=t.options.simulateBreak,n=t.state.doc.lineAt(i.from),h=null==r||r<=n.from?n.to:Math.min(n.to,r);for(let l=i.to;;){let t=e.childAfter(l);if(!t||t==s)return null;if(!t.type.isSkipped){if(t.from>=h)return null;let e=/^ */.exec(n.text.slice(i.to-n.from))[0].length;return{from:i.from,to:i.to+e}}l=t.to}}(t):null;return o?l?t.column(o.from):t.column(o.to):t.baseIndent+(l?0:t.unit*i)}const st=t=>t.baseIndent;function rt({except:t,units:e=1}={}){return i=>{let s=t&&t.test(i.textAfter);return i.baseIndent+(s?0:e*i.unit)}}const nt=l.define(),ht=new t;function lt(t){let e=t.firstChild,i=t.lastChild;return e&&e.to<i.from?{from:e.to,to:i.type.isError?t.to:i.from}:null}class ot{constructor(t,e){let i;function s(t){let e=j.newName();return(i||(i=Object.create(null)))["."+e]=t,e}this.specs=t;const r="string"==typeof e.all?e.all:e.all?s(e.all):void 0,n=e.scope;this.scope=n instanceof I?t=>t.prop(N)==n.data:n?t=>t==n:void 0,this.style=b(t.map(t=>({tag:t.tag,class:t.class||s(Object.assign({},t,{tag:null}))})),{all:r}).style,this.module=i?new j(i):null,this.themeType=e.themeType}static define(t,e){return new ot(t,e||{})}}const ut=l.define(),at=l.define({combine:t=>t.length?[t[0]]:null});function ft(t){let e=t.facet(ut);return e.length?e:t.facet(at)}function ct(t,e){let i,s=[mt];return t instanceof ot&&(t.module&&s.push(m.styleModule.of(t.module)),i=t.themeType),i?s.push(ut.computeN([m.darkTheme],e=>e.facet(m.darkTheme)==("dark"==i)?[t]:[])):s.push(ut.of(t)),s}class dt{constructor(t){this.markCache=Object.create(null),this.tree=P(t.state),this.decorations=this.buildDeco(t,ft(t.state)),this.decoratedTo=t.viewport.to}update(t){let e=P(t.state),i=ft(t.state),s=i!=ft(t.startState),{viewport:r}=t.view,n=t.changes.mapPos(this.decoratedTo,1);e.length<r.to&&!s&&e.type==this.tree.type&&n>=r.to?(this.decorations=this.decorations.map(t.changes),this.decoratedTo=n):(e!=this.tree||t.viewportChanged||s)&&(this.tree=e,this.decorations=this.buildDeco(t.view,i),this.decoratedTo=r.to)}buildDeco(t,e){if(!e||!this.tree.length)return g.none;let i=new f;for(let{from:s,to:r}of t.visibleRanges)k(this.tree,e,(t,e,s)=>{i.add(t,e,this.markCache[s]||(this.markCache[s]=g.mark({class:s})))},s,r);return i.finish()}}const mt=o.high(p.fromClass(dt,{decorations:t=>t.decorations})),pt=new t;function gt(e,i,s){let r=e.prop(i<0?t.openedBy:t.closedBy);if(r)return r;if(1==e.name.length){let t=s.indexOf(e.name);if(t>-1&&t%2==(i<0?1:0))return[s[t+i]]}return null}function vt(t){let e=t.type.prop(pt);return e?e(t.node):t}function wt(t,e,i,s={}){let r=s.maxScanDistance||1e4,n=s.brackets||"()[]{}",h=P(t),l=h.resolveInner(e,i);for(let o=l;o;o=o.parent){let t=gt(o.type,i,n);if(t&&o.from<o.to){let s=vt(o);if(s&&(i>0?e>=s.from&&e<s.to:e>s.from&&e<=s.to))return bt(0,0,i,o,s,t,n)}}return function(t,e,i,s,r,n,h){let l=i<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),o=h.indexOf(l);if(o<0||o%2==0!=i>0)return null;let u={from:i<0?e-1:e,to:i>0?e+1:e},a=t.doc.iterRange(e,i>0?t.doc.length:0),f=0;for(let c=0;!a.next().done&&c<=n;){let t=a.value;i<0&&(c+=t.length);let n=e+c*i;for(let e=i>0?0:t.length-1,l=i>0?t.length:-1;e!=l;e+=i){let l=h.indexOf(t[e]);if(!(l<0||s.resolveInner(n+e,1).type!=r))if(l%2==0==i>0)f++;else{if(1==f)return{start:u,end:{from:n+e,to:n+e+1},matched:l>>1==o>>1};f--}}i>0&&(c+=t.length)}return a.done?{start:u,matched:!1}:null}(t,e,i,h,l.type,r,n)}function bt(t,e,i,s,r,n,h){let l=s.parent,o={from:r.from,to:r.to},u=0,a=null==l?void 0:l.cursor();if(a&&(i<0?a.childBefore(s.from):a.childAfter(s.to)))do{if(i<0?a.to<=s.from:a.from>=s.to){if(0==u&&n.indexOf(a.type.name)>-1&&a.from<a.to){let t=vt(a);return{start:o,end:t?{from:t.from,to:t.to}:void 0,matched:!0}}if(gt(a.type,i,h))u++;else if(gt(a.type,-i,h)){if(0==u){let t=vt(a);return{start:o,end:t&&t.from<t.to?{from:t.from,to:t.to}:void 0,matched:!1}}u--}}}while(i<0?a.prevSibling():a.nextSibling());return{start:o,matched:!1}}function kt(t,e,i,s=0,r=0){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);let n=r;for(let h=s;h<e;h++)9==t.charCodeAt(h)?n+=i-n%i:n++;return n}class yt{constructor(t,e,i,s){this.string=t,this.tabSize=e,this.indentUnit=i,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return 0==this.pos}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,i=this.string.charAt(this.pos);if(e="string"==typeof t?i==t:i&&(t instanceof RegExp?t.test(i):t(i)),e)return++this.pos,i}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=kt(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var t;return null!==(t=this.overrideIndent)&&void 0!==t?t:kt(this.string,null,this.tabSize)}match(t,e,i){if("string"==typeof t){let s=t=>i?t.toLowerCase():t;return s(this.string.substr(this.pos,t.length))==s(t)?(!1!==e&&(this.pos+=t.length),!0):null}{let i=this.string.slice(this.pos).match(t);return i&&i.index>0?null:(i&&!1!==e&&(this.pos+=i[0].length),i)}}current(){return this.string.slice(this.start,this.pos)}}function xt(t){if("object"!=typeof t)return t;let e={};for(let i in t){let s=t[i];e[i]=s instanceof Array?s.slice():s}return e}const jt=new WeakMap;class At extends I{constructor(e){let i,n=S(e.languageData),h={name:(l=e).name||"",token:l.token,blankLine:l.blankLine||(()=>{}),startState:l.startState||(()=>!0),copyState:l.copyState||xt,indent:l.indent||(()=>null),languageData:l.languageData||{},tokenTable:l.tokenTable||Tt,mergeTokens:!1!==l.mergeTokens};var l;super(n,new class extends s{createParse(t,e,s){return new Dt(i,t,e,s)}},[],e.name),this.topNode=function(t,e){let i=r.define({id:Mt.length,name:"Document",props:[N.add(()=>t),_.add(()=>t=>e.getIndent(t))],top:!0});return Mt.push(i),i}(n,this),i=this,this.streamParser=h,this.stateAfter=new t({perNode:!0}),this.tokenTable=e.tokenTable?new Ct(h.tokenTable):Et}static define(t){return new At(t)}getIndent(t){let e,{overrideIndentation:i}=t.options;i&&(e=jt.get(t.state),null!=e&&e<t.pos-1e4&&(e=void 0));let s,r,n=Nt(this,t.node.tree,t.node.from,t.node.from,null!=e?e:t.pos);if(n?(r=n.state,s=n.pos+1):(r=this.streamParser.startState(t.unit),s=t.node.from),t.pos-s>1e4)return null;for(;s<t.pos;){let e=t.state.doc.lineAt(s),n=Math.min(t.pos,e.to);if(e.length){let s=i?i(e.from):-1,h=new yt(e.text,t.state.tabSize,t.unit,s<0?void 0:s);for(;h.pos<n-e.from;)It(this.streamParser.token,h,r)}else this.streamParser.blankLine(r,t.unit);if(n==t.pos)break;s=e.to+1}let h=t.lineAt(t.pos);return i&&null==e&&jt.set(t.state,h.from),this.streamParser.indent(r,/^\s*(.*)/.exec(h.text)[1],t)}get allowsNesting(){return!1}}function Nt(t,i,s,r,n){let h=s>=r&&s+i.length<=n&&i.prop(t.stateAfter);if(h)return{state:t.streamParser.copyState(h),pos:s+i.length};for(let l=i.children.length-1;l>=0;l--){let h=i.children[l],o=s+i.positions[l],u=h instanceof e&&o<n&&Nt(t,h,o,r,n);if(u)return u}return null}function St(t,i,s,r,n){if(n&&s<=0&&r>=i.length)return i;n||0!=s||i.type!=t.topNode||(n=!0);for(let h=i.children.length-1;h>=0;h--){let l,o=i.positions[h],u=i.children[h];if(o<r&&u instanceof e){if(!(l=St(t,u,s-o,r-o,n)))break;return n?new e(i.type,i.children.slice(0,h).concat(l),i.positions.slice(0,h+1),o+l.length):l}}return null}class Dt{constructor(t,i,s,r){this.lang=t,this.input=i,this.fragments=s,this.ranges=r,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=r[r.length-1].to;let n=L.get(),h=r[0].from,{state:l,tree:o}=function(t,i,s,r,n){for(let e of i){let i,n=e.from+(e.openStart?25:0),h=e.to-(e.openEnd?25:0),l=n<=s&&h>s&&Nt(t,e.tree,0-e.offset,s,h);if(l&&l.pos<=r&&(i=St(t,e.tree,s+e.offset,l.pos+e.offset,!1)))return{state:l.state,tree:i}}return{state:t.streamParser.startState(n?H(n):4),tree:e.empty}}(t,s,h,this.to,null==n?void 0:n.state);this.state=l,this.parsedPos=this.chunkStart=h+o.length;for(let e=0;e<o.children.length;e++)this.chunks.push(o.children[e]),this.chunkPos.push(o.positions[e]);n&&this.parsedPos<n.viewport.from-1e5&&r.some(t=>t.from<=n.viewport.from&&t.to>=n.viewport.from)&&(this.state=this.lang.streamParser.startState(H(n.state)),n.skipUntilInView(this.parsedPos,n.viewport.from),this.parsedPos=n.viewport.from),this.moveRangeIndex()}advance(){let t=L.get(),e=null==this.stoppedAt?this.to:Math.min(this.to,this.stoppedAt),i=Math.min(e,this.chunkStart+2048);for(t&&(i=Math.min(i,t.viewport.to));this.parsedPos<i;)this.parseLine(t);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=e?this.finish():t&&this.parsedPos>=t.viewport.to?(t.skipUntilInView(this.parsedPos,e),this.finish()):null}stopAt(t){this.stoppedAt=t}lineAfter(t){let e=this.input.chunk(t);if(this.input.lineChunks)"\n"==e&&(e="");else{let t=e.indexOf("\n");t>-1&&(e=e.slice(0,t))}return t+e.length<=this.to?e:e.slice(0,this.to-t)}nextLine(){let t=this.parsedPos,e=this.lineAfter(t),i=t+e.length;for(let s=this.rangeIndex;;){let t=this.ranges[s].to;if(t>=i)break;if(e=e.slice(0,t-(i-e.length)),s++,s==this.ranges.length)break;let r=this.ranges[s].from,n=this.lineAfter(r);e+=n,i=r+n.length}return{line:e,end:i}}skipGapsTo(t,e,i){for(;;){let s=this.ranges[this.rangeIndex].to,r=t+e;if(i>0?s>r:s>=r)break;e+=this.ranges[++this.rangeIndex].from-s}return e}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(t,e,i,s){let r=4;if(this.ranges.length>1){e+=s=this.skipGapsTo(e,s,1);let t=this.chunk.length;i+=s=this.skipGapsTo(i,s,-1),r+=this.chunk.length-t}let n=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&4==r&&n>=0&&this.chunk[n]==t&&this.chunk[n+2]==e?this.chunk[n+2]=i:this.chunk.push(t,e,i,r),s}parseLine(t){let{line:e,end:i}=this.nextLine(),s=0,{streamParser:r}=this.lang,n=new yt(e,t?t.state.tabSize:4,t?H(t.state):2);if(n.eol())r.blankLine(this.state,n.indentUnit);else for(;!n.eol();){let t=It(r.token,n,this.state);if(t&&(s=this.emitToken(this.lang.tokenTable.resolve(t),this.parsedPos+n.start,this.parsedPos+n.pos,s)),n.start>1e4)break}this.parsedPos=i,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let t=e.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:Pt,topID:0,maxBufferLength:2048,reused:this.chunkReused});t=new e(t.type,t.children,t.positions,t.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(t),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new e(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function It(t,e,i){e.start=e.pos;for(let s=0;s<10;s++){let s=t(e,i);if(e.pos>e.start)return s}throw new Error("Stream parser failed to advance stream.")}const Tt=Object.create(null),Mt=[r.none],Pt=new h(Mt),Ot=[],Bt=Object.create(null),Lt=Object.create(null);for(let[Vt,Wt]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Lt[Vt]=Rt(Tt,Wt);class Ct{constructor(t){this.extra=t,this.table=Object.assign(Object.create(null),Lt)}resolve(t){return t?this.table[t]||(this.table[t]=Rt(this.extra,t)):0}}const Et=new Ct(Tt);function qt(t,e){Ot.indexOf(t)>-1||Ot.push(t)}function Rt(t,e){let i=[];for(let r of e.split(" ")){let e=[];for(let i of r.split(".")){let s=t[i]||y[i];s?"function"==typeof s?e.length?e=e.map(s):qt(i):e.length?qt(i):e=Array.isArray(s)?s:[s]:qt(i)}for(let t of e)i.push(t)}if(!i.length)return 0;let s=e.replace(/ /g,"_"),n=s+" "+i.map(t=>t.id),h=Bt[n];if(h)return h.id;let l=Bt[n]=r.define({id:Mt.length,name:s,props:[x({[s]:i})]});return Mt.push(l),l.id}w.RTL,w.LTR;export{ot as H,Y as I,M as L,L as P,At as S,G as a,H as b,F as c,_ as d,rt as e,ht as f,J as g,et as h,z as i,st as j,lt as k,pt as l,wt as m,D as n,S as o,I as p,nt as q,N as r,P as s,U as t,ct as u};
